(()=>{var e={119:e=>{e.exports=function(){return{t:"https://chromewebstore.google.com/detail/"+chrome.runtime.id,i:"on_progress",_:"offscreen",l:1,h:2,u:"https://sites.google.com/view/video-downloader-mega",p:"create_dw",$:"create_dw_alt",m:"is_dw",v:"finish_dw",A:"cancel",R:"content",T:"pops",S:"keepalive-port",O:"start_dw",P:"merge_v_a",D:"close_offscreen",I:"enable_btn",L:"chrome_dw",G:"get_config"}}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e=n(119),t=n.n(e),r;!function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG"}(r||(r={}));const o=new Error("unknown message type"),a=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),i=new Error("called FFmpeg.terminate()"),s=(()=>{let e=0;return()=>e++})();class _{M=null;C={};k={};U=[];F=[];N=!1;W=()=>{this.M&&(this.M.onmessage=({data:{id:e,type:t,data:n}})=>{switch(t){case r.LOAD:this.N=!0,this.C[e](n);break;case r.EXEC:case r.WRITE_FILE:case r.READ_FILE:this.C[e](n);break;case r.LOG:this.U.forEach((e=>e(n)));break;case r.PROGRESS:this.F.forEach((e=>e(n)));break;case r.ERROR:this.k[e](n);break}delete this.C[e],delete this.k[e]})};j=({type:e,data:t},n=[],r)=>this.M?new Promise(((o,a)=>{const i=s();this.M&&this.M.postMessage({id:i,type:e,data:t},n),this.C[i]=o,this.k[i]=a,r?.addEventListener("abort",(()=>{a(new DOMException(`Message # ${i} was aborted`,"AbortError"))}),{once:!0})})):Promise.reject(a);V(e,t){"log"===e?this.U.push(t):"progress"===e&&this.F.push(t)}Y=({classWorkerURL:e,...t}={},{signal:n}={})=>(this.M||(this.M=new Worker(`chrome-extension://${chrome.runtime.id}/js/worker.js`),this.W()),this.j({type:r.LOAD,data:t},void 0,n));B=(e,t=-1,{signal:n}={})=>this.j({type:r.EXEC,data:{args:e,timeout:t}},void 0,n);H=()=>{const e=Object.keys(this.k);for(const t of e)this.k[t](i),delete this.k[t],delete this.C[t];this.M&&(this.M.terminate(),this.M=null,this.N=!1)};K=(e,t,{signal:n}={})=>{const o=[];return t instanceof Uint8Array&&o.push(t.buffer),this.j({type:r.WRITE_FILE,data:{path:e,data:t}},o,n)};X=(e,t="binary",{signal:n}={})=>this.j({type:r.READ_FILE,data:{path:e,encoding:t}},void 0,n)}chrome.runtime.onMessage.addListener(((e,n,r)=>{e.target===t()._&&("start"===e.action?l.q(e.data,e.process_id):"continue"===e.action?l.J(e.data):"stop"===e.action?l.Z():"cancel"===e.action&&l.ee())}));const l={te:null,ne:.5,re:[],oe:[],ae:[],ie:[],se:0,_e:!1,le:!1,ce(){this.te&&this.te.H(),this.te=null},Z(){this._e=!0},ee(){this._e=!0,this.le=!0},J(e){this.re=this.re.concat(e.partial_video_list),this.oe=this.oe.concat(e.partial_audio_list)},de(e){const t=chrome.runtime.connect({name:"offscreen"});let n=0;return function(r){if(r.percents){if(r.percents===n)return;n=r.percents}t.postMessage({action:"stream_download_step",process_id:e,details:r})}},q(e,n){const r=this;let o;const a=r.de(n);let i=e.filename||null;Promise.resolve().then((function(){return e.video_url&&e.audio_url?r.he(e,a):e.video_list&&e.audio_list?r.fe(e,a):e.partial_video_list&&e.partial_audio_list?r.ue(e,a):e.video_buffers&&e.audio_buffers?r.pe(e):void 0})).then((()=>e.audio_file&&e.audio_file.length?r.$e(e.video_file,e.audio_file,a):e.video_file)).then((e=>(o=URL.createObjectURL(new Blob([e],{type:"video/mp4"})),chrome.runtime.sendMessage({title:t().L,url:o,filename:i,process_id:n})))).finally((function(){r.ce(),o&&URL.revokeObjectURL(o)})).then((e=>{e.success?a({done:!0}):a({failed:!0})})).catch((function(e){a("cancelled"===e?{cancelled:!0}:{failed:!0})}))},he(e,t){const n=this;let r=0,o=0,a=!1;const i=function(e){if(!a)return;r+=e;let i=Math.ceil(r/o*n.ne*100);i>50&&(i=50),t({percents:i})},s=function(e){o+=e,o>e&&(a=!0)};return Promise.all([n.me(e.video_url,i,s,e.headers),n.me(e.audio_url,i,s,e.headers)]).then((function(t){e.video_file=t[0],e.audio_file=t[1]}))},pe(e){const t=[],n=[];let r=0,o=0;e.video_buffers.forEach((e=>{const n=new Uint8Array(e);r+=n.length,t.push(n)})),e.audio_buffers.forEach((e=>{const t=new Uint8Array(e);o+=t.length,n.push(t)}));const a=new Uint8Array(r);let i=0;for(let e of t)a.set(e,i),i+=e.length;const s=new Uint8Array(o);i=0;for(let e of n)s.set(e,i),i+=e.length;e.video_file=a,e.audio_file=s},fe(e,t){const n=this;let r=e.video_list.length;return e.audio_list.length&&(r+=e.audio_list.length/2),new Promise((async function(o,a){let i,s;for(e.video_buffers=[],e.audio_buffers=[];e.video_list.length||e.audio_list.length;){let o=e.video_list.shift(),_=e.audio_list.shift(),l=await n.we(o,_).catch((function(){}));if(!l)return a("failed");[i,s]=l,i&&e.video_buffers.push(i),s&&e.audio_buffers.push(s);let c=Math.ceil((r-e.video_list.length)/r*n.ne*100);c>50&&(c=50),t({percents:c})}n.pe(e),o()}))},ue(e,t){const n=this;return n.re=e.partial_video_list,n.oe=e.partial_audio_list,new Promise((function(r,o){let a=!1;const i=function(){if(n._e)return clearInterval(s),n.le?o("cancelled"):(e.video_buffers=n.ae,e.audio_buffers=n.ie,n.pe(e),r(),!0)};let s=setInterval((async function(){if(!a&&!i()&&(n.re.length||n.oe.length)){for(a=!0;n.re.length||n.oe.length;){if(i())return;let e=n.re.shift(),r=n.oe.shift(),a=await n.we(e,r).catch((function(){}));if(!a)return clearInterval(s),o();const[_,l]=a;_&&(n.ae.push(_),n.se+=_.byteLength),l&&(n.ie.push(l),n.se+=l.byteLength),t({bytes:n.se})}a=!1}}),2e3)}))},we(e,t){return Promise.all([!!e&&this.Ee(e),!!t&&this.Ee(t)])},Ee(e,t=0){const n=this;return fetch(e).then((function(e){return 200!==e.status?Promise.reject():e.arrayBuffer()})).catch((function(){return t<2?n.Ee(e,++t):Promise.reject(`download_fragment_failed ${e}`)}))},async me(e,t,n,r=null){let o=await fetch(e,{headers:r});n(parseInt(o.headers.get("content-length")));const a=o.body.getReader();let i=0,s=[];for(;;){const{done:e,value:n}=await a.read();if(e)break;s.push(n),i+=n.length,t(n.length)}let _=new Uint8Array(i),l=0;for(let e of s)_.set(e,l),l+=e.length;return _},async $e(e,t,n){const r=this;null===this.te&&(this.te=new _,this.te.V("progress",(({progress:e})=>{let t=100*r.ne+Math.ceil(e*(1-r.ne)*100);t>100&&(t=100),n({percents:t})})),await this.te.Y({coreURL:`chrome-extension://${chrome.runtime.id}/js/wasm/ffmpeg-core.js`,wasmURL:`chrome-extension://${chrome.runtime.id}/js/wasm/ffmpeg-core.wasm`})),await this.te.K("video.mp4",e),await this.te.K("audio.mp4",t),await this.te.B("-i video.mp4 -i audio.mp4 -map 0:v -map 1:a -c:v copy -y output.mp4".split(" "));const o=void 0;return(await this.te.X("output.mp4")).buffer}}})()})();