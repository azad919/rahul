(()=>{var t={119:t=>{t.exports=function(){return{u:"https://chromewebstore.google.com/detail/"+chrome.runtime.id,O:"on_progress",T:"offscreen",S:1,A:2,M:"https://sites.google.com/view/video-downloader-mega",D:"create_dw",L:"create_dw_alt",I:"is_dw",_:"finish_dw",R:"cancel",C:"content",N:"pops",P:"keepalive-port",U:"start_dw",F:"merge_v_a",B:"close_offscreen",$:"enable_btn",G:"chrome_dw",V:"get_config"}}()},68:t=>{t.exports=function(){return{X(t,i){i&&!Array.isArray(i)&&(i=[i]);for(var n=[],r={"{":0,"[":0},e={"}":"{","]":"["},s=/[{}\]\[":0-9.,-]/,h=/[\r\n\s\t]/,a="",o=0,u;u=t[o];o++)if('"'!==u)s.test(u)?(a+=u,"{"===u||"["===u?(r["{"]||r["["]||(a=u),r[u]++):"}"!==u&&"]"!==u||(r[e[u]]--,r["{"]||r["["]||n.push(a))):"t"===u&&"true"===t.substr(o,4)?(a+="true",o+=3):"f"===u&&"false"===t.substr(o,5)?(a+="false",o+=4):"n"===u&&"null"===t.substr(o,4)?(a+="null",o+=3):h.test(u)||(r["{"]=0,r["["]=0,a="");else{for(var f=o;-1!==f&&(f===o||"\\"===t[f-1]);)f=t.indexOf('"',f+1);-1===f&&(f=t.length-1),a+=t.substr(o,f-o+1),o=f}for(var c=[],o=0,l;l=n[o];o++)if("{}"!==l&&"[]"!==l)try{i?i.every((function(t){return t.test(l)}))&&c.push(JSON.parse(l)):c.push(JSON.parse(l))}catch(t){}return c},W:(t,i)=>parseInt(i.quality)-parseInt(t.quality),q(t){const i=1e3,n=1e6,r=1e9;return(t="string"==typeof t?parseInt(t):t)>=r?(t/r).toFixed(0)+" Gbps":t>=n?(t/n).toFixed(0)+" Mbps":t>=i?(t/i).toFixed(0)+" Kbps":t+" bps"},K(t){const i=t/1073741824,n=t/1048576;return i>=1?i.toFixed(2)+" GB":n<=1?n.toFixed(2)+" MB":n.toFixed(0)+" MB"},H(t){const i=void 0,n=void 0,r=t.replace(/[^a-zA-Z0-9\s\p{L}\-_.]/gu,"_").trim().replace(/\s+/g,"_").substring(0,255),e=void 0;return["CON","PRN","AUX","NUL","COM1","LPT1"].includes(r.toUpperCase())?`_${r}`:r},Y:t=>new Promise(((i,n)=>(chrome.runtime.sendMessage(t,(function(t){let n=chrome.runtime.lastError;i(t)})),!0))),J(){let t;if(null!==document.querySelector("div[data-player]"))t=null!==document.querySelector("div[data-clip-id]")?document.querySelector("div[data-player]").getAttribute("data-clip-id"):document.querySelector("div[data-player]").id;else if(null!==document.querySelector("[class*=VideoName__ViewTitle]")){let i=document.querySelector("[class*=VideoName__ViewTitle]");t=i&&i.href||"",t=t.match(/(\d+)/),t=t[0]||null}else t=location.href.match(/(\d+)/),t=t[0]||null;return t},Z(){function t(t,i){return Math.floor(Math.random()*(1+i-t))+t}return t(1,9e9)},tt(t,i){let n,r=t.split("?")[0],e=i.split("/"),s=1,h=[];for(let t=0;t<e.length;t++)".."===e[t]?s++:h.push(e[t]);let a=r.split("/"),o;return s>0&&a.splice(-s,s),o=a.join("/"),h=h.join("/"),o+="/"+h,o},it:()=>new Promise((t=>{chrome.tabs.query({active:!0,currentWindow:!0},(i=>{t(i[0].id)}))}))}}()},319:function(t){"undefined"!=typeof window&&function(i,n){t.exports=n()}(this,(function(){return function(t){var i={};function n(r){if(i[r])return i[r].exports;var e=i[r]={i:r,l:!1,exports:{}};return t[r].call(e.exports,e,e.exports,n),e.l=!0,e.exports}return n.m=t,n.c=i,n.d=function(t,i,r){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)n.d(r,e,function(i){return t[i]}.bind(null,e));return r},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="/dist/",n(n.s=20)}([function(t,i,n){var r;n.d(i,"a",(function(){return r})),function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"}(r||(r={}))},function(t,i,n){n.d(i,"a",(function(){return a})),n.d(i,"b",(function(){return o}));var r=function(){},e={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=e;function h(t){var i=self.console[t];return i?i.bind(self.console,"["+t+"] >"):r}function a(t){if(self.console&&!0===t||"object"==typeof t){!function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];n.forEach((function(i){s[i]=t[i]?t[i].bind(t):h(i)}))}(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=e}}else s=e}var o=e},function(t,i,n){var r,e;n.d(i,"b",(function(){return r})),n.d(i,"a",(function(){return e})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(r||(r={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown"}(e||(e={}))},function(t,i,n){n.d(i,"a",(function(){return r}));var r=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)};Number.MAX_SAFE_INTEGER},function(t,i,n){var r,e;n.d(i,"a",(function(){return r})),n.d(i,"b",(function(){return e})),function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(r||(r={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(e||(e={}))},function(t,i,n){n.d(i,"a",(function(){return o})),n.d(i,"c",(function(){return d})),n.d(i,"k",(function(){return p})),n.d(i,"h",(function(){return m})),n.d(i,"e",(function(){return b})),n.d(i,"d",(function(){return g})),n.d(i,"f",(function(){return w})),n.d(i,"l",(function(){return k})),n.d(i,"b",(function(){return O})),n.d(i,"j",(function(){return T})),n.d(i,"i",(function(){return S})),n.d(i,"g",(function(){return A}));var r=n(9),e=n(6),s=n(7),h=Math.pow(2,32)-1,a=[].push,o={video:1,audio:2,id3:3,text:4};function u(t){return String.fromCharCode.apply(null,t)}function f(t,i){var n=t[i]<<8|t[i+1];return n<0?65536+n:n}function c(t,i){var n=l(t,i);return n<0?4294967296+n:n}function l(t,i){return t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]}function v(t,i,n){t[i]=n>>24,t[i+1]=n>>16&255,t[i+2]=n>>8&255,t[i+3]=255&n}function d(t,i){var n=[];if(!i.length)return n;for(var r=t.byteLength,e=0;e<r;){var s=c(t,e),h=s>1?e+s:r;if(u(t.subarray(e+4,e+8))===i[0])if(1===i.length)n.push(t.subarray(e+8,h));else{var o=d(t.subarray(e+8,h),i.slice(1));o.length&&a.apply(n,o)}e=h}return n}function p(t){var i=[],n=t[0],r=8,e=c(t,r);r+=4,r+=0===n?8:16,r+=2;var s=t.length+0,h=f(t,r);r+=2;for(var a=0;a<h;a++){var o=r,u=c(t,o),l=2147483647&u;if(1==(2147483648&u)>>>31)return null;var v=c(t,o+=4);o+=4,i.push({referenceSize:l,subsegmentDuration:v,info:{duration:v/e,start:s,end:s+l-1}}),s+=l,r=o+=4}return{earliestPresentationTime:0,timescale:e,version:n,referencesCount:h,references:i}}function m(t){for(var i=[],n=d(t,["moov","trak"]),r=0;r<n.length;r++){var s=n[r],h=d(s,["tkhd"])[0];if(h){var a=h[0],o=0===a?12:20,f=c(h,o),l=d(s,["mdia","mdhd"])[0];if(l){var v=c(l,o=0===(a=l[0])?12:20),p=d(s,["mdia","hdlr"])[0];if(p){var m=u(p.subarray(8,12)),b={soun:e.a.AUDIO,vide:e.a.VIDEO}[m];if(b){var g=d(s,["mdia","minf","stbl","stsd"])[0],y=void 0;g&&(y=u(g.subarray(12,16))),i[f]={timescale:v,type:b},i[b]={timescale:v,id:f,codec:y}}}}}}return d(t,["moov","mvex","trex"]).forEach((function(t){var n=c(t,4),r=i[n];r&&(r.default={duration:c(t,12),flags:c(t,20)})})),i}function b(t,i){return d(i,["moof","traf"]).reduce((function(i,n){var r=d(n,["tfdt"])[0],e=r[0],s=d(n,["tfhd"]).reduce((function(i,n){var s=c(n,4),h=t[s];if(h){var a=c(r,4);1===e&&(a*=Math.pow(2,32),a+=c(r,8));var o=a/(h.timescale||9e4);if(isFinite(o)&&(null===i||o<i))return o}return i}),null);return null!==s&&isFinite(s)&&(null===i||s<i)?s:i}),null)||0}function g(t,i){for(var n=0,r=0,s=0,h=d(t,["moof","traf"]),a=0;a<h.length;a++){var o=h[a],u=d(o,["tfhd"])[0],f=i[c(u,4)];if(f){var l=f.default,v=c(u,0)|(null==l?void 0:l.flags),m=null==l?void 0:l.duration;8&v&&(m=c(u,2&v?12:8));for(var b=f.timescale||9e4,g=d(o,["trun"]),w=0;w<g.length;w++)!(n=y(g[w]))&&m&&(n=m*c(g[w],4)),f.type===e.a.VIDEO?r+=n/b:f.type===e.a.AUDIO&&(s+=n/b)}}if(0===r&&0===s){for(var k=0,O=d(t,["sidx"]),T=0;T<O.length;T++){var E=p(O[T]);null!=E&&E.references&&(k+=E.references.reduce((function(t,i){return t+i.info.duration||0}),0))}return k}return r||s}function y(t){var i=c(t,0),n=8;1&i&&(n+=4),4&i&&(n+=4);for(var r=0,e=c(t,4),s=0;s<e;s++)256&i&&(r+=c(t,n),n+=4),512&i&&(n+=4),1024&i&&(n+=4),2048&i&&(n+=4);return r}function w(t,i,n){d(i,["moof","traf"]).forEach((function(i){d(i,["tfhd"]).forEach((function(r){var e=c(r,4),s=t[e];if(s){var a=s.timescale||9e4;d(i,["tfdt"]).forEach((function(t){var i=t[0],r=c(t,4);if(0===i)r-=n*a,v(t,4,r=Math.max(r,0));else{r*=Math.pow(2,32),r+=c(t,8),r-=n*a,r=Math.max(r,0);var e=Math.floor(r/(h+1)),s=Math.floor(r%(h+1));v(t,4,e),v(t,8,s)}}))}}))}))}function k(t){var i={valid:null,remainder:null},n=d(t,["moof"]);if(!n)return i;if(n.length<2)return i.remainder=t,i;var e=n[n.length-1];return i.valid=Object(r.a)(t,0,e.byteOffset-8),i.remainder=Object(r.a)(t,e.byteOffset-8),i}function O(t,i){var n=new Uint8Array(t.length+i.length);return n.set(t),n.set(i,t.length),n}function T(t,i){var n=[],r=i.samples,s=i.timescale,h=i.id,a=!1;return d(r,["moof"]).map((function(o){var u=o.byteOffset-8;d(o,["traf"]).map((function(o){var f=d(o,["tfdt"]).map((function(t){var i=t[0],n=c(t,4);return 1===i&&(n*=Math.pow(2,32),n+=c(t,8)),n/s}))[0];return void 0!==f&&(t=f),d(o,["tfhd"]).map((function(f){var v=c(f,4),p=16777215&c(f,0),m=0,b=!!(16&p),g=0,y=!!(32&p),w=8;v===h&&(!!(1&p)&&(w+=8),!!(2&p)&&(w+=4),!!(8&p)&&(m=c(f,w),w+=4),b&&(g=c(f,w),w+=4),y&&(w+=4),"video"===i.type&&(a=function(t){if(!t)return!1;var i=t.indexOf("."),n=i<0?t:t.substring(0,i);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}(i.codec)),d(o,["trun"]).map((function(h){var o=h[0],f=16777215&c(h,0),v=!!(1&f),d=0,p=!!(4&f),b=!!(256&f),y=0,w=!!(512&f),k=0,O=!!(1024&f),T=!!(2048&f),A=0,M=c(h,4),j=8;v&&(d=c(h,j),j+=4),p&&(j+=4);for(var D=d+u,x=0;x<M;x++){if(b?(y=c(h,j),j+=4):y=m,w?(k=c(h,j),j+=4):k=g,O&&(j+=4),T&&(A=0===o?c(h,j):l(h,j),j+=4),i.type===e.a.VIDEO)for(var L=0;L<k;){var I=c(r,D),_=31&r[D+=4];E(a,_)&&S(r.subarray(D,D+I),t+A/s,n),D+=I,L+=I+4}t+=y/s}})))}))}))})),n}function E(t,i){return t?39===i||40===i:6===i}function S(t,i,n){var r=function(t){for(var i=t.byteLength,n=[],r=1;r<i-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return t;var e=i-n.length,s=new Uint8Array(e),h=0;for(r=0;r<e;h++,r++)h===n[0]&&(h++,n.shift()),s[r]=t[h];return s}(t),e=0;e++;for(var h=0,a=0,o=!1,u=0;e<r.length;){h=0;do{if(e>=r.length)break;h+=u=r[e++]}while(255===u);a=0;do{if(e>=r.length)break;a+=u=r[e++]}while(255===u);var l=r.length-e;if(!o&&4===h&&e<r.length){if(o=!0,181===r[e++]){var v=f(r,e);if(e+=2,49===v){var d=c(r,e);if(e+=4,1195456820===d){var p=r[e++];if(3===p){var m=r[e++],b=64&m,g=b?2+3*(31&m):0,y=new Uint8Array(g);if(b){y[0]=m;for(var w=1;w<g;w++)y[w]=r[e++]}n.push({type:p,payloadType:h,pts:i,bytes:y})}}}}}else if(5===h&&a<l){if(o=!0,a>16){for(var k=[],O=0;O<16;O++){var T=r[e++].toString(16);k.push(1==T.length?"0"+T:T),3!==O&&5!==O&&7!==O&&9!==O||k.push("-")}for(var E=a-16,S=new Uint8Array(E),A=0;A<E;A++)S[A]=r[e++];n.push({payloadType:h,pts:i,uuid:k.join(""),userData:Object(s.f)(S),userDataBytes:S})}}else if(a<l)e+=a;else if(a>l)break}}function A(t){var i=t[0],n="",r="",e=0,s=0,h=0,a=0,o=0,f=0;if(0===i){for(;"\0"!==u(t.subarray(f,f+1));)n+=u(t.subarray(f,f+1)),f+=1;for(n+=u(t.subarray(f,f+1)),f+=1;"\0"!==u(t.subarray(f,f+1));)r+=u(t.subarray(f,f+1)),f+=1;r+=u(t.subarray(f,f+1)),f+=1,e=c(t,12),s=c(t,16),a=c(t,20),o=c(t,24),f=28}else if(1===i){e=c(t,f+=4);var l=c(t,f+=4),v=c(t,f+=4);for(f+=4,h=Math.pow(2,32)*l+v,Number.isSafeInteger(h)||(h=Number.MAX_SAFE_INTEGER),a=c(t,f),o=c(t,f+=4),f+=4;"\0"!==u(t.subarray(f,f+1));)n+=u(t.subarray(f,f+1)),f+=1;for(n+=u(t.subarray(f,f+1)),f+=1;"\0"!==u(t.subarray(f,f+1));)r+=u(t.subarray(f,f+1)),f+=1;r+=u(t.subarray(f,f+1)),f+=1}return{schemeIdUri:n,value:r,timeScale:e,presentationTime:h,presentationTimeDelta:s,eventDuration:a,id:o,payload:t.subarray(f,t.byteLength)}}},function(t,i,n){n.d(i,"a",(function(){return r})),n.d(i,"b",(function(){return d})),n.d(i,"c",(function(){return p}));var r,e=n(3),s=n(12),h=n(1),a=n(17),o=n(14);function u(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,f(t,i)}function f(t,i){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function c(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,i,n){return i&&c(t.prototype,i),n&&c(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"}(r||(r={}));var v=function(){function t(t){var i;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((i={})[r.AUDIO]=null,i[r.VIDEO]=null,i[r.AUDIOVIDEO]=null,i),this.baseurl=t}return t.prototype.setByteRange=function(t,i){var n=t.split("@",2),r=[];1===n.length?r[0]=i?i.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},l(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),d=function(t){function i(i,n){var r;return(r=t.call(this,n)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new o.a,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=i,r}u(i,t);var n=i.prototype;return n.createInitializationVector=function(t){for(var i=new Uint8Array(16),n=12;n<16;n++)i[n]=t>>8*(15-n)&255;return i},n.setDecryptDataFromLevelKey=function(t,i){var n=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((n=a.a.fromURI(t.uri)).method=t.method,n.iv=this.createInitializationVector(i),n.keyFormat="identity"),n},n.setElementaryStreamInfo=function(t,i,n,r,e,s){void 0===s&&(s=!1);var h=this.elementaryStreams,a=h[t];a?(a.startPTS=Math.min(a.startPTS,i),a.endPTS=Math.max(a.endPTS,n),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,e)):h[t]={startPTS:i,endPTS:n,startDTS:r,endDTS:e,partial:s}},n.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null},l(i,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&h.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(e.a)(this.programDateTime))return null;var t=Object(e.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),i}(v),p=function(t){function i(i,n,r,e,s){var h;(h=t.call(this,r)||this).fragOffset=0,h.duration=0,h.gap=!1,h.independent=!1,h.relurl=void 0,h.fragment=void 0,h.index=void 0,h.stats=new o.a,h.duration=i.decimalFloatingPoint("DURATION"),h.gap=i.bool("GAP"),h.independent=i.bool("INDEPENDENT"),h.relurl=i.enumeratedString("URI"),h.fragment=n,h.index=e;var a=i.enumeratedString("BYTERANGE");return a&&h.setByteRange(a,s),s&&(h.fragOffset=s.fragOffset+s.duration),h}return u(i,t),l(i,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),i}(v)},function(t,i,n){n.d(i,"b",(function(){return h})),n.d(i,"a",(function(){return o})),n.d(i,"d",(function(){return u})),n.d(i,"e",(function(){return f})),n.d(i,"c",(function(){return l})),n.d(i,"f",(function(){return g}));var r,e=function(t,i){return i+10<=t.length&&73===t[i]&&68===t[i+1]&&51===t[i+2]&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},s=function(t,i){return i+10<=t.length&&51===t[i]&&68===t[i+1]&&73===t[i+2]&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},h=function(t,i){for(var n=i,r=0;e(t,i);)r+=10,r+=a(t,i+6),s(t,i+10)&&(r+=10),i+=r;if(r>0)return t.subarray(n,n+r)},a=function(t,i){var n=0;return n=(127&t[i])<<21,n|=(127&t[i+1])<<14,n|=(127&t[i+2])<<7,n|=127&t[i+3]},o=function(t,i){return e(t,i)&&a(t,i+6)+10<=t.length-i},u=function(t){for(var i=l(t),n=0;n<i.length;n++){var r=i[n];if(f(r))return b(r)}},f=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},c=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),n=a(t,4);return{type:i,size:n,data:t.subarray(10,10+n)}},l=function(t){for(var i=0,n=[];e(t,i);){for(var r=a(t,i+6),h=(i+=10)+r;i+8<h;){var o=c(t.subarray(i)),u=v(o);u&&n.push(u),i+=o.size+10}s(t,i)&&(i+=10)}return n},v=function(t){return"PRIV"===t.type?d(t):"W"===t.type[0]?m(t):p(t)},d=function(t){if(!(t.size<2)){var i=g(t.data,!0),n=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:n.buffer}}},p=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,n=g(t.data.subarray(i),!0);i+=n.length+1;var r=g(t.data.subarray(i));return{key:t.type,info:n,data:r}}var e=g(t.data.subarray(1));return{key:t.type,data:e}}},m=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,n=g(t.data.subarray(i),!0);i+=n.length+1;var r=g(t.data.subarray(i));return{key:t.type,info:n,data:r}}var e=g(t.data);return{key:t.type,data:e}},b=function(t){if(8===t.data.byteLength){var i=new Uint8Array(t.data),n=1&i[3],r=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},g=function(t,i){void 0===i&&(i=!1);var n=y();if(n){var r=n.decode(t);if(i){var e=r.indexOf("\0");return-1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}for(var s,h,a,o=t.length,u="",f=0;f<o;){if(0===(s=t[f++])&&i)return u;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:h=t[f++],u+=String.fromCharCode((31&s)<<6|63&h);break;case 14:h=t[f++],a=t[f++],u+=String.fromCharCode((15&s)<<12|(63&h)<<6|63&a)}}return u};function y(){return r||void 0===self.TextDecoder||(r=new self.TextDecoder("utf-8")),r}},function(t,i,n){var r;n.d(i,"a",(function(){return r})),function(t){t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3"}(r||(r={}))},function(t,i,n){function r(t,i,n){return Uint8Array.prototype.slice?t.slice(i,n):new Uint8Array(Array.prototype.slice.call(t,i,n))}n.d(i,"a",(function(){return r}))},function(t,i,n){n.d(i,"c",(function(){return nt})),n.d(i,"d",(function(){return et})),n.d(i,"a",(function(){return st})),n.d(i,"b",(function(){return ht}));var r=n(0),e=n(2),s=n(16),h=n(3),a=n(7),o=n(8);function u(t,i){return void 0===t&&(t=""),void 0===i&&(i=9e4),{type:t,id:-1,pid:-1,inputTimeScale:i,sequenceNumber:-1,samples:[],dropped:0}}var f=n(5),c=n(9),l=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var i=t.prototype;return i.resetInitSegment=function(t,i,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},i.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},i.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},i.canParse=function(t,i){return!1},i.appendFrame=function(t,i,n){},i.demux=function(t,i){this.cachedData&&(t=Object(f.b)(this.cachedData,t),this.cachedData=null);var n,r,e=a.b(t,0),s=e?e.length:0,l=this._audioTrack,d=this._id3Track,p=e?a.d(e):void 0,m=t.length;for((null===this.basePTS||0===this.frameIndex&&Object(h.a)(p))&&(this.basePTS=v(p,i,this.initPTS)),e&&e.length>0&&d.samples.push({pts:this.basePTS,dts:this.basePTS,data:e,type:o.a.audioId3}),r=this.basePTS;s<m;){if(this.canParse(t,s)){var b=this.appendFrame(l,t,s);b?(this.frameIndex++,r=b.sample.pts,n=s+=b.length):s=m}else a.a(t,s)?(e=a.b(t,s),d.samples.push({pts:r,dts:r,data:e,type:o.a.audioId3}),n=s+=e.length):s++;if(s===m&&n!==m){var g=Object(c.a)(t,n);this.cachedData?this.cachedData=Object(f.b)(this.cachedData,g):this.cachedData=g}}return{audioTrack:l,videoTrack:u(),id3Track:d,textTrack:u()}},i.demuxSampleAes=function(t,i,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},i.flush=function(t){var i=this.cachedData;return i&&(this.cachedData=null,this.demux(i,0)),{audioTrack:this._audioTrack,videoTrack:u(),id3Track:this._id3Track,textTrack:u()}},i.destroy=function(){},t}(),v=function(t,i,n){return Object(h.a)(t)?90*t:9e4*i+(n||0)},d=l,p=n(1);function m(t,i){return 255===t[i]&&240==(246&t[i+1])}function b(t,i){return 1&t[i+1]?7:9}function g(t,i){return(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>>5}function y(t,i){return i+1<t.length&&m(t,i)}function w(t,i){if(y(t,i)){var n=b(t,i);if(i+n>=t.length)return!1;var r=g(t,i);if(r<=n)return!1;var e=i+r;return e===t.length||y(t,e)}return!1}function k(t,i,n,s,h){if(!t.samplerate){var a=function(t,i,n,s){var h,a,o,u,f=navigator.userAgent.toLowerCase(),c=s,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];h=1+((192&i[n+2])>>>6);var v=(60&i[n+2])>>>2;if(!(v>l.length-1))return o=(1&i[n+2])<<2,o|=(192&i[n+3])>>>6,p.b.log("manifest codec:"+s+", ADTS type:"+h+", samplingIndex:"+v),/firefox/i.test(f)?v>=6?(h=5,u=new Array(4),a=v-3):(h=2,u=new Array(2),a=v):-1!==f.indexOf("android")?(h=2,u=new Array(2),a=v):(h=5,u=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&v>=6?a=v-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(v>=6&&1===o||/vivaldi/i.test(f))||!s&&1===o)&&(h=2,u=new Array(2)),a=v)),u[0]=h<<3,u[0]|=(14&v)>>1,u[1]|=(1&v)<<7,u[1]|=o<<3,5===h&&(u[1]|=(14&a)>>1,u[2]=(1&a)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:l[v],channelCount:o,codec:"mp4a.40."+h,manifestCodec:c};t.trigger(r.a.ERROR,{type:e.b.MEDIA_ERROR,details:e.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v})}(i,n,s,h);if(!a)return;t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,p.b.log("parsed codec:"+t.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function O(t){return 9216e4/t}function T(t,i,n,r,e){var s,h=r+e*O(t.samplerate),a=function(t,i){var n=b(t,i);if(i+n<=t.length){var r=g(t,i)-n;if(r>0)return{headerLength:n,frameLength:r}}}(i,n);if(a){var o=a.frameLength,u=a.headerLength,f=u+o,c=Math.max(0,n+f-i.length);c?(s=new Uint8Array(f-u)).set(i.subarray(n+u,i.length),0):s=i.subarray(n+u,n+f);var l={unit:s,pts:h};return c||t.samples.push(l),{sample:l,length:f,missing:c}}var v=i.length-n;return(s=new Uint8Array(v)).set(i.subarray(n,i.length),0),{sample:{unit:s,pts:h},length:v,missing:-1}}function E(t,i){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var S=function(t){var i,n;function r(i,n){var r;return(r=t.call(this)||this).observer=void 0,r.config=void 0,r.observer=i,r.config=n,r}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,E(i,n);var e=r.prototype;return e.resetInitSegment=function(i,n,r,e){t.prototype.resetInitSegment.call(this,i,n,r,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:e,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var i=(a.b(t,0)||[]).length,n=t.length;i<n;i++)if(w(t,i))return p.b.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,i){return function(t,i){return function(t,i){return i+5<t.length}(t,i)&&m(t,i)&&g(t,i)<=t.length-i}(t,i)},e.appendFrame=function(t,i,n){k(t,this.observer,i,n,t.manifestCodec);var r=T(t,i,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r},r}(d),A=/\/emsg[-/]ID3/i,M=function(){function t(t,i){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=i}var i=t.prototype;return i.resetTimeStamp=function(){},i.resetInitSegment=function(t,i,n,r){var e=Object(f.h)(t),s=this.videoTrack=u("video",1),h=this.audioTrack=u("audio",1),a=this.txtTrack=u("text",1);if(this.id3Track=u("id3",1),this.timeOffset=0,e.video){var o=e.video,c=o.id,l=o.timescale,v=o.codec;s.id=c,s.timescale=a.timescale=l,s.codec=v}if(e.audio){var d=e.audio,p=d.id,m=d.timescale,b=d.codec;h.id=p,h.timescale=m,h.codec=b}a.id=f.a.text,s.sampleDuration=0,s.duration=h.duration=r},i.resetContiguity=function(){},t.probe=function(t){return t=t.length>16384?t.subarray(0,16384):t,Object(f.c)(t,["moof"]).length>0},i.demux=function(t,i){this.timeOffset=i;var n=t,r=this.videoTrack,e=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Object(f.b)(this.remainderData,t));var s=Object(f.l)(n);this.remainderData=s.remainder,r.samples=s.valid||new Uint8Array}else r.samples=n;var h=this.extractID3Track(r,i);return e.samples=Object(f.j)(i,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:h,textTrack:this.txtTrack}},i.flush=function(){var t=this.timeOffset,i=this.videoTrack,n=this.txtTrack;i.samples=this.remainderData||new Uint8Array,this.remainderData=null;var r=this.extractID3Track(i,this.timeOffset);return n.samples=Object(f.j)(t,i),{videoTrack:i,audioTrack:u(),id3Track:r,textTrack:u()}},i.extractID3Track=function(t,i){var n=this.id3Track;if(t.samples.length){var r=Object(f.c)(t.samples,["emsg"]);r&&r.forEach((function(t){var r=Object(f.g)(t);if(A.test(r.schemeIdUri)){var e=Object(h.a)(r.presentationTime)?r.presentationTime/r.timeScale:i+r.presentationTimeDelta/r.timeScale,s=r.payload;n.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:o.a.emsg})}}))}return n},i.demuxSampleAes=function(t,i,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},i.destroy=function(){},t}(),j=null,D=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],x=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],L=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function _(t,i,n,r,e){if(!(n+24>i.length)){var s=R(i,n);if(s&&n+s.frameLength<=i.length){var h=r+e*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:i.subarray(n,n+s.frameLength),pts:h,dts:h};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}}function R(t,i){var n=t[i+1]>>3&3,r=t[i+1]>>1&3,e=t[i+2]>>4&15,s=t[i+2]>>2&3;if(1!==n&&0!==e&&15!==e&&3!==s){var h=t[i+2]>>1&1,a=t[i+3]>>6,o=1e3*D[14*(3===n?3-r:3===r?3:4)+e-1],u=x[3*(3===n?0:2===n?1:2)+s],f=3===a?1:2,c=L[n][r],l=I[r],v=8*c*l,d=Math.floor(c*o/u+h)*l;if(null===j){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);j=p?parseInt(p[1]):0}return!!j&&j<=87&&2===r&&o>=224e3&&0===a&&(t[i+3]=128|t[i+3]),{sampleRate:u,channelCount:f,frameLength:d,samplesPerFrame:v}}}function C(t,i){return!(255!==t[i]||224&~t[i+1]||!(6&t[i+1]))}function N(t,i){return i+1<t.length&&C(t,i)}function P(t,i){if(i+1<t.length&&C(t,i)){var n=R(t,i),r=4;null!=n&&n.frameLength&&(r=n.frameLength);var e=i+r;return e===t.length||N(t,e)}return!1}var U=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var i=t.prototype;return i.loadWord=function(){var t=this.data,i=this.bytesAvailable,n=t.byteLength-i,r=new Uint8Array(4),e=Math.min(4,i);if(0===e)throw new Error("no bytes available");r.set(t.subarray(n,n+e)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},i.skipBits=function(t){var i;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(i=t>>3)>>3,this.bytesAvailable-=i,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},i.readBits=function(t){var i=Math.min(this.bitsAvailable,t),n=this.word>>>32-i;return t>32&&p.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),(i=t-i)>0&&this.bitsAvailable?n<<i|this.readBits(i):n},i.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},i.skipUEG=function(){this.skipBits(1+this.skipLZ())},i.skipEG=function(){this.skipBits(1+this.skipLZ())},i.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},i.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},i.readBoolean=function(){return 1===this.readBits(1)},i.readUByte=function(){return this.readBits(8)},i.readUShort=function(){return this.readBits(16)},i.readUInt=function(){return this.readBits(32)},i.skipScalingList=function(t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},i.readSPS=function(){var t,i,n,r=0,e=0,s=0,h=0,a=this.readUByte.bind(this),o=this.readBits.bind(this),u=this.readUEG.bind(this),f=this.readBoolean.bind(this),c=this.skipBits.bind(this),l=this.skipEG.bind(this),v=this.skipUEG.bind(this),d=this.skipScalingList.bind(this);a();var p=a();if(o(5),c(3),a(),v(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var m=u();if(3===m&&c(1),v(),v(),c(1),f())for(i=3!==m?8:12,n=0;n<i;n++)f()&&d(n<6?16:64)}v();var b=u();if(0===b)u();else if(1===b)for(c(1),l(),l(),t=u(),n=0;n<t;n++)l();v(),c(1);var g=u(),y=u(),w=o(1);0===w&&c(1),c(1),f()&&(r=u(),e=u(),s=u(),h=u());var k=[1,1];if(f()&&f())switch(a()){case 1:k=[1,1];break;case 2:k=[12,11];break;case 3:k=[10,11];break;case 4:k=[16,11];break;case 5:k=[40,33];break;case 6:k=[24,11];break;case 7:k=[20,11];break;case 8:k=[32,11];break;case 9:k=[80,33];break;case 10:k=[18,11];break;case 11:k=[15,11];break;case 12:k=[64,33];break;case 13:k=[160,99];break;case 14:k=[4,3];break;case 15:k=[3,2];break;case 16:k=[2,1];break;case 255:k=[a()<<8|a(),a()<<8|a()]}return{width:Math.ceil(16*(g+1)-2*r-2*e),height:(2-w)*(y+1)*16-(w?2:4)*(s+h),pixelRatio:k}},i.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),F=function(){function t(t,i,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new s.a(t,i,{removePKCS7Padding:!1})}var i=t.prototype;return i.decryptBuffer=function(t,i){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,i)},i.decryptAacSample=function(t,i,n,r){var e=t[i].unit;if(!(e.length<=16)){var s=e.subarray(16,e.length-e.length%16),h=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this.decryptBuffer(h,(function(s){var h=new Uint8Array(s);e.set(h,16),r||a.decryptAacSamples(t,i+1,n)}))}},i.decryptAacSamples=function(t,i,n){for(;;i++){if(i>=t.length)return void n();if(!(t[i].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,i,n,r),!r)return}}},i.getAvcEncryptedData=function(t){for(var i=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(i),r=0,e=32;e<t.length-16;e+=160,r+=16)n.set(t.subarray(e,e+16),r);return n},i.getAvcDecryptedUnit=function(t,i){for(var n=new Uint8Array(i),r=0,e=32;e<t.length-16;e+=160,r+=16)t.set(n.subarray(r,r+16),e);return t},i.decryptAvcSample=function(t,i,n,r,e,s){var h=q(e.data),a=this.getAvcEncryptedData(h),o=this;this.decryptBuffer(a.buffer,(function(a){e.data=o.getAvcDecryptedUnit(h,a),s||o.decryptAvcSamples(t,i,n+1,r)}))},i.decryptAvcSamples=function(t,i,n,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,n=0){if(i>=t.length)return void r();for(var e=t[i].units;!(n>=e.length);n++){var s=e[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var h=this.decrypter.isSync();if(this.decryptAvcSample(t,i,n,r,s,h),!h)return}}}},t}();function B(){return(B=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function $(t,i,n,r){return{key:t,frame:!1,pts:i,dts:n,units:[],debug:r,length:0}}function G(t,i){return(31&t[i+10])<<8|t[i+11]}function V(t,i,n,r){var e={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=i+3+((15&t[i+1])<<8|t[i+2])-4;for(i+=12+((15&t[i+10])<<8|t[i+11]);i<s;){var h=(31&t[i+1])<<8|t[i+2];switch(t[i]){case 207:if(!r){p.b.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===e.audio&&(e.audio=h);break;case 21:-1===e.id3&&(e.id3=h);break;case 219:if(!r){p.b.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===e.avc&&(e.avc=h);break;case 3:case 4:!0!==n.mpeg&&!0!==n.mp3?p.b.log("MPEG audio found, not supported in this browser"):-1===e.audio&&(e.audio=h,e.segmentCodec="mp3");break;case 36:p.b.warn("Unsupported HEVC stream type found")}i+=5+((15&t[i+3])<<8|t[i+4])}return e}function X(t){var i,n,r,e,s,h=0,a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&a.length>1;){var o=new Uint8Array(a[0].length+a[1].length);o.set(a[0]),o.set(a[1],a[0].length),a[0]=o,a.splice(1,1)}if(1===((i=a[0])[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>t.size-6)return null;var u=i[7];192&u&&(e=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,64&u?e-(s=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>54e5&&(p.b.warn(Math.round((e-s)/9e4)+"s delta between PTS and DTS, align them"),e=s):s=e);var f=(r=i[8])+9;if(t.size<=f)return null;t.size-=f;for(var c=new Uint8Array(t.size),l=0,v=a.length;l<v;l++){var d=(i=a[l]).byteLength;if(f){if(f>d){f-=d;continue}i=i.subarray(f),d-=f,f=0}c.set(i,h),h+=d}return n&&(n-=r+3),{data:c,pts:e,dts:s,len:n}}return null}function W(t,i){if(t.units.length&&t.frame){if(void 0===t.pts){var n=i.samples,r=n.length;if(!r)return void i.dropped++;var e=n[r-1];t.pts=e.pts,t.dts=e.dts}i.samples.push(t)}t.debug.length&&p.b.log(t.pts+"/"+t.dts+":"+t.debug)}function q(t){for(var i=t.byteLength,n=[],r=1;r<i-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return t;var e=i-n.length,s=new Uint8Array(e),h=0;for(r=0;r<e;h++,r++)h===n[0]&&(h++,n.shift()),s[r]=t[h];return s}var K=function(){function t(t,i,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=i,this.typeSupported=n}t.probe=function(t){return 71===t[0]&&71===t[188]},t.createTrack=function(t,i){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:f.a[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?i:void 0}};var i=t.prototype;return i.resetInitSegment=function(i,n,r,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video"),this._audioTrack=t.createTrack("audio",e),this._id3Track=t.createTrack("id3"),this._txtTrack=t.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=r,this._duration=e},i.resetTimeStamp=function(){},i.resetContiguity=function(){var t=this._audioTrack,i=this._avcTrack,n=this._id3Track;t&&(t.pesData=null),i&&(i.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null},i.demux=function(t,i,n,s){var h;void 0===n&&(n=!1),void 0===s&&(s=!1),n||(this.sampleAes=null);var a=this._avcTrack,o=this._audioTrack,u=this._id3Track,c=this._txtTrack,l=a.pid,v=a.pesData,d=o.pid,m=u.pid,b=o.pesData,g=u.pesData,y=null,w=this.pmtParsed,k=this._pmtId,O=t.length;if(this.remainderData&&(O=(t=Object(f.b)(this.remainderData,t)).length,this.remainderData=null),O<188&&!s)return this.remainderData=t,{audioTrack:o,videoTrack:a,id3Track:u,textTrack:c};(O-=O%188)<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,O,t.buffer.byteLength-O));for(var T=0,E=0;E<O;E+=188)if(71===t[E]){var S=!!(64&t[E+1]),A=((31&t[E+1])<<8)+t[E+2],M=void 0;if((48&t[E+3])>>4>1){if((M=E+5+t[E+4])===E+188)continue}else M=E+4;switch(A){case l:S&&(v&&(h=X(v))&&this.parseAVCPES(a,c,h,!1),v={data:[],size:0}),v&&(v.data.push(t.subarray(M,E+188)),v.size+=E+188-M);break;case d:if(S){if(b&&(h=X(b)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,h);break;case"mp3":this.parseMPEGPES(o,h)}b={data:[],size:0}}b&&(b.data.push(t.subarray(M,E+188)),b.size+=E+188-M);break;case m:S&&(g&&(h=X(g))&&this.parseID3PES(u,h),g={data:[],size:0}),g&&(g.data.push(t.subarray(M,E+188)),g.size+=E+188-M);break;case 0:S&&(M+=t[M]+1),k=this._pmtId=G(t,M);break;case k:S&&(M+=t[M]+1);var j=V(t,M,this.typeSupported,n);(l=j.avc)>0&&(a.pid=l),(d=j.audio)>0&&(o.pid=d,o.segmentCodec=j.segmentCodec),(m=j.id3)>0&&(u.pid=m),null===y||w||(p.b.log("unknown PID '"+y+"' in TS found"),y=null),w=this.pmtParsed=!0;break;case 17:case 8191:break;default:y=A}}else T++;T>0&&this.observer.emit(r.a.ERROR,r.a.ERROR,{type:e.b.MEDIA_ERROR,details:e.a.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+T+" TS packet/s that do not start with 0x47"}),a.pesData=v,o.pesData=b,u.pesData=g;var D={audioTrack:o,videoTrack:a,id3Track:u,textTrack:c};return s&&this.extractRemainingSamples(D),D},i.flush=function(){var t,i=this.remainderData;return this.remainderData=null,t=i?this.demux(i,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},i.extractRemainingSamples=function(t){var i,n=t.audioTrack,r=t.videoTrack,e=t.id3Track,s=t.textTrack,h=r.pesData,a=n.pesData,o=e.pesData;if(h&&(i=X(h))?(this.parseAVCPES(r,s,i,!0),r.pesData=null):r.pesData=h,a&&(i=X(a))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,i);break;case"mp3":this.parseMPEGPES(n,i)}n.pesData=null}else null!=a&&a.size&&p.b.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=a;o&&(i=X(o))?(this.parseID3PES(e,i),e.pesData=null):e.pesData=o},i.demuxSampleAes=function(t,i,n){var r=this.demux(t,n,!0,!this.config.progressive),e=this.sampleAes=new F(this.observer,this.config,i);return this.decrypt(r,e)},i.decrypt=function(t,i){return new Promise((function(n){var r=t.audioTrack,e=t.videoTrack;r.samples&&"aac"===r.segmentCodec?i.decryptAacSamples(r.samples,0,(function(){e.samples?i.decryptAvcSamples(e.samples,0,0,(function(){n(t)})):n(t)})):e.samples&&i.decryptAvcSamples(e.samples,0,0,(function(){n(t)}))}))},i.destroy=function(){this._duration=0},i.parseAVCPES=function(t,i,n,r){var e,s=this,h=this.parseAVCNALu(t,n.data),a=this.avcSample,o=!1;n.data=null,a&&h.length&&!t.audFound&&(W(a,t),a=this.avcSample=$(!1,n.pts,n.dts,"")),h.forEach((function(r){switch(r.type){case 1:e=!0,a||(a=s.avcSample=$(!0,n.pts,n.dts,"")),a.frame=!0;var h=r.data;if(o&&h.length>4){var u=new U(h).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(a.key=!0)}break;case 5:e=!0,a||(a=s.avcSample=$(!0,n.pts,n.dts,"")),a.key=!0,a.frame=!0;break;case 6:e=!0,Object(f.i)(q(r.data),n.pts,i.samples);break;case 7:if(e=!0,o=!0,!t.sps){var c=new U(r.data).readSPS();t.width=c.width,t.height=c.height,t.pixelRatio=c.pixelRatio,t.sps=[r.data],t.duration=s._duration;for(var l=r.data.subarray(1,4),v="avc1.",d=0;d<3;d++){var p=l[d].toString(16);p.length<2&&(p="0"+p),v+=p}t.codec=v}break;case 8:e=!0,t.pps||(t.pps=[r.data]);break;case 9:e=!1,t.audFound=!0,a&&W(a,t),a=s.avcSample=$(!1,n.pts,n.dts,"");break;case 12:e=!0;break;default:e=!1,a&&(a.debug+="unknown NAL "+r.type+" ")}a&&e&&a.units.push(r)})),r&&a&&(W(a,t),this.avcSample=null)},i.getLastNalUnit=function(t){var i,n,r=this.avcSample;if(r&&0!==r.units.length||(r=t[t.length-1]),null!==(i=r)&&void 0!==i&&i.units){var e=r.units;n=e[e.length-1]}return n},i.parseAVCNALu=function(t,i){var n,r,e=i.byteLength,s=t.naluState||0,h=s,a=[],o=0,u=-1,f=0;for(-1===s&&(u=0,f=31&i[0],s=0,o=1);o<e;)if(n=i[o++],s)if(1!==s)if(n)if(1===n){if(u>=0){var c={data:i.subarray(u,o-s-1),type:f};a.push(c)}else{var l=this.getLastNalUnit(t.samples);if(l&&(h&&o<=4-h&&l.state&&(l.data=l.data.subarray(0,l.data.byteLength-h)),(r=o-s-1)>0)){var v=new Uint8Array(l.data.byteLength+r);v.set(l.data,0),v.set(i.subarray(0,r),l.data.byteLength),l.data=v,l.state=0}}o<e?(u=o,f=31&i[o],s=0):s=-1}else s=0;else s=3;else s=n?0:2;else s=n?0:1;if(u>=0&&s>=0){var d={data:i.subarray(u,e),type:f,state:s};a.push(d)}if(0===a.length){var p=this.getLastNalUnit(t.samples);if(p){var m=new Uint8Array(p.data.byteLength+i.byteLength);m.set(p.data,0),m.set(i,p.data.byteLength),p.data=m}}return t.naluState=s,a},i.parseAACPES=function(t,i){var n,s,h,a,o,u=0,f=this.aacOverFlow,c=i.data;if(f){this.aacOverFlow=null;var l=f.missing,v=f.sample.unit.byteLength;if(-1===l){var d=new Uint8Array(v+c.byteLength);d.set(f.sample.unit,0),d.set(c,v),c=d}else{var m=v-l;f.sample.unit.set(c.subarray(0,l),m),t.samples.push(f.sample),u=f.missing}}for(n=u,s=c.length;n<s-1&&!y(c,n);n++);if(n===u||(n<s-1?(h="AAC PES did not start with ADTS header,offset:"+n,a=!1):(h="no ADTS header found in AAC PES",a=!0),p.b.warn("parsing error:"+h),this.observer.emit(r.a.ERROR,r.a.ERROR,{type:e.b.MEDIA_ERROR,details:e.a.FRAG_PARSING_ERROR,fatal:a,reason:h}),!a)){if(k(t,this.observer,c,n,this.audioCodec),void 0!==i.pts)o=i.pts;else{if(!f)return void p.b.warn("[tsdemuxer]: AAC PES unknown PTS");var b=O(t.samplerate);o=f.sample.pts+b}for(var g,w=0;n<s;){if(n+=(g=T(t,c,n,o,w)).length,g.missing){this.aacOverFlow=g;break}for(w++;n<s-1&&!y(c,n);n++);}}},i.parseMPEGPES=function(t,i){var n=i.data,r=n.length,e=0,s=0,h=i.pts;if(void 0!==h)for(;s<r;)if(N(n,s)){var a=_(t,n,s,h,e);if(!a)break;s+=a.length,e++}else s++;else p.b.warn("[tsdemuxer]: MPEG PES unknown PTS")},i.parseID3PES=function(t,i){if(void 0!==i.pts){var n=B({},i,{type:this._avcTrack?o.a.emsg:o.a.audioId3});t.samples.push(n)}else p.b.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function z(t,i){return(z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var H=function(t){var i,n;function r(){return t.apply(this,arguments)||this}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,z(i,n);var e=r.prototype;return e.resetInitSegment=function(i,n,r,e){t.prototype.resetInitSegment.call(this,i,n,r,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:e,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var i=(a.b(t,0)||[]).length,n=t.length;i<n;i++)if(P(t,i))return p.b.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,i){return function(t,i){return C(t,i)&&4<=t.length-i}(t,i)},e.appendFrame=function(t,i,n){if(null!==this.basePTS)return _(t,i,n,this.basePTS,this.frameIndex)},r}(d),Y=n(13),J=n(6);function Q(t,i){var n=null==t?void 0:t.codec;return n&&n.length>4?n:"hvc1"===n||"hev1"===n?"hvc1.1.c.L120.90":"av01"===n?"av01.0.04M.08":"avc1"===n||i===J.a.VIDEO?"avc1.42e01e":"mp4a.40.5"}var Z,tt=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var i=t.prototype;return i.destroy=function(){},i.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},i.resetNextTimestamp=function(){this.lastEndTime=null},i.resetInitSegment=function(t,i,n){this.audioCodec=i,this.videoCodec=n,this.generateInitSegment(t),this.emitInitSegment=!0},i.generateInitSegment=function(t){var i=this.audioCodec,n=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var r=this.initData=Object(f.h)(t);i||(i=Q(r.audio,J.a.AUDIO)),n||(n=Q(r.video,J.a.VIDEO));var e={};r.audio&&r.video?e.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:t,id:"main"}:r.audio?e.audio={container:"audio/mp4",codec:i,initSegment:t,id:"audio"}:r.video?e.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:p.b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},i.remux=function(t,i,n,r,e){var s,a=this.initPTS,o=this.lastEndTime,u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Object(h.a)(o)||(o=this.lastEndTime=e||0);var c=i.samples;if(!c||!c.length)return u;var l={initPTS:void 0,timescale:1},v=this.initData;if(v&&v.length||(this.generateInitSegment(c),v=this.initData),!v||!v.length)return p.b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(l.tracks=this.initTracks,this.emitInitSegment=!1);var d=Object(f.e)(v,c);Object(h.a)(a)||(this.initPTS=l.initPTS=a=d-e);var m=Object(f.d)(c,v),b=t?d-a:o,g=b+m;Object(f.f)(v,c,a),m>0?this.lastEndTime=g:(p.b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!v.audio,w=!!v.video,k="";y&&(k+="audio"),w&&(k+="video");var O={data1:c,startPTS:b,startDTS:b,endPTS:g,endDTS:g,type:k,hasAudio:y,hasVideo:w,nb:1,dropped:0};u.audio="audio"===O.type?O:void 0,u.video="audio"!==O.type?O:void 0,u.initSegment=l;var T=null!=(s=this.initPTS)?s:0;return u.id3=Object(Y.b)(n,e,T,T),r.samples.length&&(u.text=Object(Y.c)(r,e,T)),u},t}();try{Z=self.performance.now.bind(self.performance)}catch(t){p.b.debug("Unable to use Performance API on this environment"),Z=self.Date.now}var it=[{demux:K,remux:Y.a},{demux:M,remux:tt},{demux:S,remux:Y.a},{demux:H,remux:Y.a}],nt=function(){function t(t,i,n,r,e){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=i,this.config=n,this.vendor=r,this.id=e}var i=t.prototype;return i.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},i.push=function(t,i,n,r){var e=this,s=n.transmuxing;s.executeStart=Z();var h=new Uint8Array(t),a=this.config,o=this.currentTransmuxState,u=this.transmuxConfig;r&&(this.currentTransmuxState=r);var f=r||o,c=f.contiguous,l=f.discontinuity,v=f.trackSwitch,d=f.accurateTimeOffset,p=f.timeOffset,m=f.initSegmentChange,b=u.audioCodec,g=u.videoCodec,y=u.defaultInitPts,w=u.duration,k=u.initSegmentData;(l||v||m)&&this.resetInitSegment(k,b,g,w),(l||m)&&this.resetInitialTimestamp(y),c||this.resetContiguity();var O=function(t,i){var n=null;return t.byteLength>0&&null!=i&&null!=i.key&&null!==i.iv&&null!=i.method&&(n=i),n}(h,i);if(O&&"AES-128"===O.method){var T=this.getDecrypter();if(!a.enableSoftwareAES)return this.decryptionPromise=T.webCryptoDecrypt(h,O.key.buffer,O.iv.buffer).then((function(t){var i=e.push(t,null,n);return e.decryptionPromise=null,i})),this.decryptionPromise;var E=T.softwareDecrypt(h,O.key.buffer,O.iv.buffer);if(!E)return s.executeEnd=Z(),rt(n);h=new Uint8Array(E)}this.needsProbing(h,l,v)&&this.configureTransmuxer(h,u);var S=this.transmux(h,O,p,d,n),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Z(),S},i.flush=function(t){var i=this,n=t.transmuxing;n.executeStart=Z();var s=this.decrypter,h=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return i.flush(t)}));var o=[],u=h.timeOffset;if(s){var f=s.flush();f&&o.push(this.push(f,null,t))}var c=this.demuxer,l=this.remuxer;if(!c||!l)return this.observer.emit(r.a.ERROR,r.a.ERROR,{type:e.b.MEDIA_ERROR,details:e.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=Z(),[rt(t)];var v=c.flush(u);return et(v)?v.then((function(n){return i.flushRemux(o,n,t),o})):(this.flushRemux(o,v,t),o)},i.flushRemux=function(t,i,n){var r=i.audioTrack,e=i.videoTrack,s=i.id3Track,h=i.textTrack,a=this.currentTransmuxState,o=a.accurateTimeOffset,u=a.timeOffset;p.b.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var f=this.remuxer.remux(r,e,s,h,u,o,!0,this.id);t.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=Z()},i.resetInitialTimestamp=function(t){var i=this.demuxer,n=this.remuxer;i&&n&&(i.resetTimeStamp(t),n.resetTimeStamp(t))},i.resetContiguity=function(){var t=this.demuxer,i=this.remuxer;t&&i&&(t.resetContiguity(),i.resetNextTimestamp())},i.resetInitSegment=function(t,i,n,r){var e=this.demuxer,s=this.remuxer;e&&s&&(e.resetInitSegment(t,i,n,r),s.resetInitSegment(t,i,n))},i.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},i.transmux=function(t,i,n,r,e){return i&&"SAMPLE-AES"===i.method?this.transmuxSampleAes(t,i,n,r,e):this.transmuxUnencrypted(t,n,r,e)},i.transmuxUnencrypted=function(t,i,n,r){var e=this.demuxer.demux(t,i,!1,!this.config.progressive),s=e.audioTrack,h=e.videoTrack,a=e.id3Track,o=e.textTrack;return{remuxResult:this.remuxer.remux(s,h,a,o,i,n,!1,this.id),chunkMeta:r}},i.transmuxSampleAes=function(t,i,n,r,e){var s=this;return this.demuxer.demuxSampleAes(t,i,n).then((function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,n,r,!1,s.id),chunkMeta:e}}))},i.configureTransmuxer=function(t,i){for(var n,r=this.config,e=this.observer,s=this.typeSupported,h=this.vendor,a=i.audioCodec,o=i.defaultInitPts,u=i.duration,f=i.initSegmentData,c=i.videoCodec,l=0,v=it.length;l<v;l++)if(it[l].demux.probe(t)){n=it[l];break}n||(p.b.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:M,remux:tt});var d=this.demuxer,m=this.remuxer,b=n.remux,g=n.demux;m&&m instanceof b||(this.remuxer=new b(e,r,s,h)),d&&d instanceof g||(this.demuxer=new g(e,r,s),this.probe=g.probe),this.resetInitSegment(f,a,c,u),this.resetInitialTimestamp(o)},i.needsProbing=function(t,i,n){return!this.demuxer||!this.remuxer||i||n},i.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new s.a(this.observer,this.config)),t},t}(),rt=function(t){return{remuxResult:{},chunkMeta:t}};function et(t){return"then"in t&&t.then instanceof Function}var st=function(t,i,n,r,e){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=i,this.initSegmentData=n,this.duration=r,this.defaultInitPts=e},ht=function(t,i,n,r,e,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=i,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=e,this.initSegmentChange=s}},function(t,i,n){function r(t,i,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var e=t*i*n;return r?Math.round(e):e}function e(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=!1),r(t,i,1/n,e)}function s(t,i){return void 0===i&&(i=!1),r(t,1e3,1/9e4,i)}function h(t,i){return void 0===i&&(i=1),r(t,9e4,1/i)}n.d(i,"c",(function(){return e})),n.d(i,"b",(function(){return s})),n.d(i,"a",(function(){return h}))},function(t,i,n){var r,e,s,h,a;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,i,n){if(n=n||{},t=t.trim(),!(i=i.trim())){if(!n.alwaysNormalize)return t;var r=a.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var s=a.parseURL(i);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return n.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):i;var h=a.parseURL(t);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var o=e.exec(h.path);h.netLoc=o[1],h.path=o[2]}h.netLoc&&!h.path&&(h.path="/");var u={scheme:h.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=h.netLoc,"/"!==s.path[0]))if(s.path){var f=h.path,c=f.substring(0,f.lastIndexOf("/")+1)+s.path;u.path=a.normalizePath(c)}else u.path=h.path,s.params||(u.params=h.params,s.query||(u.query=h.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(u)},parseURL:function(t){var i=r.exec(t);return i?{scheme:i[1]||"",netLoc:i[2]||"",path:i[3]||"",params:i[4]||"",query:i[5]||"",fragment:i[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(s,"");t.length!==(t=t.replace(h,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=a},function(t,i,n){n.d(i,"a",(function(){return m})),n.d(i,"d",(function(){return b})),n.d(i,"b",(function(){return g})),n.d(i,"c",(function(){return y}));var r=n(3),e=function(){function t(){}return t.getSilentFrame=function(t,i){switch(t){case"mp4a.40.2":if(1===i)return new Uint8Array([0,200,0,128,35,128]);if(2===i)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===i)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}(),s=Math.pow(2,32)-1,h=function(){function t(){}return t.init=function(){var i;for(i in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(i)&&(t.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,h,o,h,a),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,e))},t.box=function(t){for(var i=8,n=arguments.length,r=new Array(n>1?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];for(var s=r.length,h=s;s--;)i+=r[s].byteLength;var a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(t,4),s=0,i=8;s<h;s++)a.set(r[s],i),i+=r[s].byteLength;return a},t.hdlr=function(i){return t.box(t.types.hdlr,t.HDLR_TYPES[i])},t.mdat=function(i){return t.box(t.types.mdat,i)},t.mdhd=function(i,n){n*=i;var r=Math.floor(n/(s+1)),e=Math.floor(n%(s+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},t.mdia=function(i){return t.box(t.types.mdia,t.mdhd(i.timescale,i.duration),t.hdlr(i.type),t.minf(i))},t.mfhd=function(i){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]))},t.minf=function(i){return"audio"===i.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(i)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(i))},t.moof=function(i,n,r){return t.box(t.types.moof,t.mfhd(i),t.traf(r,n))},t.moov=function(i){for(var n=i.length,r=[];n--;)r[n]=t.trak(i[n]);return t.box.apply(null,[t.types.moov,t.mvhd(i[0].timescale,i[0].duration)].concat(r).concat(t.mvex(i)))},t.mvex=function(i){for(var n=i.length,r=[];n--;)r[n]=t.trex(i[n]);return t.box.apply(null,[t.types.mvex].concat(r))},t.mvhd=function(i,n){n*=i;var r=Math.floor(n/(s+1)),e=Math.floor(n%(s+1)),h=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,h)},t.sdtp=function(i){var n,r,e=i.samples||[],s=new Uint8Array(4+e.length);for(n=0;n<e.length;n++)r=e[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(i){return t.box(t.types.stbl,t.stsd(i),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(i){var n,r,e,s=[],h=[];for(n=0;n<i.sps.length;n++)e=(r=i.sps[n]).byteLength,s.push(e>>>8&255),s.push(255&e),s=s.concat(Array.prototype.slice.call(r));for(n=0;n<i.pps.length;n++)e=(r=i.pps[n]).byteLength,h.push(e>>>8&255),h.push(255&e),h=h.concat(Array.prototype.slice.call(r));var a=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|i.sps.length].concat(s).concat([i.pps.length]).concat(h))),o=i.width,u=i.height,f=i.pixelRatio[0],c=i.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,c>>24,c>>16&255,c>>8&255,255&c])))},t.esds=function(t){var i=t.config.length;return new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t.config).concat([6,1,2]))},t.mp4a=function(i){var n=i.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(i)))},t.mp3=function(i){var n=i.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(i){return"audio"===i.type?"mp3"===i.segmentCodec&&"mp3"===i.codec?t.box(t.types.stsd,t.STSD,t.mp3(i)):t.box(t.types.stsd,t.STSD,t.mp4a(i)):t.box(t.types.stsd,t.STSD,t.avc1(i))},t.tkhd=function(i){var n=i.id,r=i.duration*i.timescale,e=i.width,h=i.height,a=Math.floor(r/(s+1)),o=Math.floor(r%(s+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,h>>8&255,255&h,0,0]))},t.traf=function(i,n){var r=t.sdtp(i),e=i.id,h=Math.floor(n/(s+1)),a=Math.floor(n%(s+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(i,r.length+16+20+8+16+8+8),r)},t.trak=function(i){return i.duration=i.duration||4294967295,t.box(t.types.trak,t.tkhd(i),t.mdia(i))},t.trex=function(i){var n=i.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(i,n){var r,e,s,h,a,o,u=i.samples||[],f=u.length,c=12+16*f,l=new Uint8Array(c);for(n+=8+c,l.set(["video"===i.type?1:0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,255&f,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<f;r++)s=(e=u[r]).duration,h=e.size,a=e.flags,o=e.cts,l.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,h>>>24&255,h>>>16&255,h>>>8&255,255&h,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*r);return t.box(t.types.trun,l)},t.initSegment=function(i){t.types||t.init();var n=t.moov(i),r=new Uint8Array(t.FTYP.byteLength+n.byteLength);return r.set(t.FTYP),r.set(n,t.FTYP.byteLength),r},t}();h.types=void 0,h.HDLR_TYPES=void 0,h.STTS=void 0,h.STSC=void 0,h.STCO=void 0,h.STSZ=void 0,h.VMHD=void 0,h.SMHD=void 0,h.STSD=void 0,h.FTYP=void 0,h.DINF=void 0;var a=h,o=n(0),u=n(2),f=n(1),c=n(4),l=n(11);function v(){return(v=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var d=null,p=null,m=function(){function t(t,i,n,r){if(void 0===r&&(r=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=i,this.typeSupported=n,this.ISGenerated=!1,null===d){var e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=e?parseInt(e[1]):0}if(null===p){var s=navigator.userAgent.match(/Safari\/(\d+)/i);p=s?parseInt(s[1]):0}}var i=t.prototype;return i.destroy=function(){},i.resetTimeStamp=function(t){f.b.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},i.resetNextTimestamp=function(){f.b.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},i.resetInitSegment=function(){f.b.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},i.getVideoStartPts=function(t){var i=!1,n=t.reduce((function(t,n){var r=n.pts-t;return r<-4294967296?(i=!0,b(t,n.pts)):r>0?t:n.pts}),t[0].pts);return i&&f.b.debug("PTS rollover detected"),n},i.remux=function(t,i,n,r,e,s,h,a){var o,u,l,v,d,p,m=e,w=e,k=t.pid>-1,O=i.pid>-1,T=i.samples.length,E=t.samples.length>0,S=h&&T>0||T>1;if((!k||E)&&(!O||S)||this.ISGenerated||h){this.ISGenerated||(l=this.generateIS(t,i,e));var A,M=this.isVideoContiguous,j=-1;if(S&&(j=function(t){for(var i=0;i<t.length;i++)if(t[i].key)return i;return-1}(i.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,j>0){f.b.warn("[mp4-remuxer]: Dropped "+j+" out of "+T+" video samples due to a missing keyframe");var D=this.getVideoStartPts(i.samples);i.samples=i.samples.slice(j),i.dropped+=j,A=w+=(i.samples[0].pts-D)/i.inputTimeScale}else-1===j&&(f.b.warn("[mp4-remuxer]: No keyframe found out of "+T+" video samples"),p=!1);if(this.ISGenerated){if(E&&S){var x=this.getVideoStartPts(i.samples),L=(b(t.samples[0].pts,x)-x)/i.inputTimeScale;m+=Math.max(0,L),w+=Math.max(0,-L)}if(E){if(t.samplerate||(f.b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),l=this.generateIS(t,i,e)),u=this.remuxAudio(t,m,this.isAudioContiguous,s,O||S||a===c.b.AUDIO?w:void 0),S){var I=u?u.endPTS-u.startPTS:0;i.inputTimeScale||(f.b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),l=this.generateIS(t,i,e)),o=this.remuxVideo(i,w,M,I)}}else S&&(o=this.remuxVideo(i,w,M,0));o&&(o.firstKeyFrame=j,o.independent=-1!==j,o.firstKeyFramePTS=A)}}return this.ISGenerated&&(n.samples.length&&(d=g(n,e,this._initPTS,this._initDTS)),r.samples.length&&(v=y(r,e,this._initPTS))),{audio:u,video:o,initSegment:l,independent:p,text:v,id3:d}},i.generateIS=function(t,i,n){var e,s,h,o=t.samples,u=i.samples,f=this.typeSupported,c={},l=!Object(r.a)(this._initPTS),v="audio/mp4";if(l&&(e=s=1/0),t.config&&o.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":f.mpeg?(v="audio/mpeg",t.codec=""):f.mp3&&(t.codec="mp3")}c.audio={id:"audio",container:v,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&f.mpeg?new Uint8Array(0):a.initSegment([t]),metadata:{channelCount:t.channelCount}},l&&(h=t.inputTimeScale,e=s=o[0].pts-Math.round(h*n))}if(i.sps&&i.pps&&u.length&&(i.timescale=i.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:i.codec,initSegment:a.initSegment([i]),metadata:{width:i.width,height:i.height}},l)){h=i.inputTimeScale;var d=this.getVideoStartPts(u),p=Math.round(h*n);s=Math.min(s,b(u[0].dts,d)-p),e=Math.min(e,d-p)}if(Object.keys(c).length)return this.ISGenerated=!0,l&&(this._initPTS=e,this._initDTS=s),{tracks:c,initPTS:e,timescale:h}},i.remuxVideo=function(t,i,n,r){var e,s,h=t.inputTimeScale,c=t.samples,m=[],g=c.length,y=this._initPTS,k=this.nextAvcDts,O=8,T=this.videoSampleDuration,E=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,A=!1;n&&null!==k||(k=i*h-(c[0].pts-b(c[0].dts,c[0].pts)));for(var M=0;M<g;M++){var j=c[M];j.pts=b(j.pts-y,k),j.dts=b(j.dts-y,k),j.dts<c[M>0?M-1:M].dts&&(A=!0)}A&&c.sort((function(t,i){var n=t.dts-i.dts,r=t.pts-i.pts;return n||r})),e=c[0].dts;var D=(s=c[c.length-1].dts)-e,x=D?Math.round(D/(g-1)):T||t.inputTimeScale/30;if(n){var L=e-k,I=L>x;if(I||L<-1){I?f.b.warn("AVC: "+Object(l.b)(L,!0)+" ms ("+L+"dts) hole between fragments detected, filling it"):f.b.warn("AVC: "+Object(l.b)(-L,!0)+" ms ("+L+"dts) overlapping between fragments detected"),e=k;var _=c[0].pts-L;c[0].dts=e,c[0].pts=_,f.b.log("Video: First PTS/DTS adjusted: "+Object(l.b)(_,!0)+"/"+Object(l.b)(e,!0)+", delta: "+Object(l.b)(L,!0)+" ms")}}e=Math.max(0,e);for(var R=0,C=0,N=0;N<g;N++){for(var P=c[N],U=P.units,F=U.length,B=0,$=0;$<F;$++)B+=U[$].data.length;C+=B,R+=F,P.length=B,P.dts=Math.max(P.dts,e),E=Math.min(P.pts,E),S=Math.max(P.pts,S)}s=c[g-1].dts;var G,V=C+4*R+8;try{G=new Uint8Array(V)}catch(t){return void this.observer.emit(o.a.ERROR,o.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating video mdat "+V})}var X=new DataView(G.buffer);X.setUint32(0,V),G.set(a.types.mdat,4);for(var W=!1,q=Number.POSITIVE_INFINITY,K=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,H=Number.NEGATIVE_INFINITY,Y=0;Y<g;Y++){for(var J=c[Y],Q=J.units,Z=0,tt=0,it=Q.length;tt<it;tt++){var nt=Q[tt],rt=nt.data,et=nt.data.byteLength;X.setUint32(O,et),O+=4,G.set(rt,O),O+=et,Z+=4+et}var st=void 0;if(Y<g-1)T=c[Y+1].dts-J.dts,st=c[Y+1].pts-J.pts;else{var ht=this.config,at=Y>0?J.dts-c[Y-1].dts:x;if(st=Y>0?J.pts-c[Y-1].pts:x,ht.stretchShortVideoTrack&&null!==this.nextAudioPts){var ot=Math.floor(ht.maxBufferHole*h),ut=(r?E+r*h:this.nextAudioPts)-J.pts;ut>ot?((T=ut-at)<0?T=at:W=!0,f.b.log("[mp4-remuxer]: It is approximately "+ut/90+" ms to the next segment; using duration "+T/90+" ms for the last video frame.")):T=at}else T=at}var ft=Math.round(J.pts-J.dts);q=Math.min(q,T),z=Math.max(z,T),K=Math.min(K,st),H=Math.max(H,st),m.push(new w(J.key,T,Z,ft))}if(m.length)if(d){if(d<70){var ct=m[0].flags;ct.dependsOn=2,ct.isNonSync=0}}else if(p&&H-K<z-q&&x/z<.025&&0===m[0].cts){f.b.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var lt=e,vt=0,dt=m.length;vt<dt;vt++){var pt=lt+m[vt].duration,mt=lt+m[vt].cts;if(vt<dt-1){var bt=pt+m[vt+1].cts;m[vt].duration=bt-mt}else m[vt].duration=vt?m[vt-1].duration:x;m[vt].cts=0,lt=pt}}T=W||!T?x:T,this.nextAvcDts=k=s+T,this.videoSampleDuration=T,this.isVideoContiguous=!0;var gt={data1:a.moof(t.sequenceNumber++,e,v({},t,{samples:m})),data2:G,startPTS:E/h,endPTS:(S+T)/h,startDTS:e/h,endDTS:k/h,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:t.dropped};return t.samples=[],t.dropped=0,gt},i.remuxAudio=function(t,i,n,r,s){var h=t.inputTimeScale,c=h/(t.samplerate?t.samplerate:h),l="aac"===t.segmentCodec?1024:1152,d=l*c,p=this._initPTS,m="mp3"===t.segmentCodec&&this.typeSupported.mpeg,g=[],y=void 0!==s,k=t.samples,O=m?0:8,T=this.nextAudioPts||-1,E=i*h;if(this.isAudioContiguous=n=n||k.length&&T>0&&(r&&Math.abs(E-T)<9e3||Math.abs(b(k[0].pts-p,E)-T)<20*d),k.forEach((function(t){t.pts=b(t.pts-p,E)})),!n||T<0){if(!(k=k.filter((function(t){return t.pts>=0}))).length)return;T=0===s?0:r&&!y?Math.max(0,E):k[0].pts}if("aac"===t.segmentCodec)for(var S=this.config.maxAudioFramesDrift,A=0,M=T;A<k.length;A++){var j=k[A],D=j.pts,x=D-M,L=Math.abs(1e3*x/h);if(x<=-S*d&&y)0===A&&(f.b.warn("Audio frame @ "+(D/h).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*x/h)+" ms."),this.nextAudioPts=T=M=D);else if(x>=S*d&&L<1e4&&y){var I=Math.round(x/d);(M=D-I*d)<0&&(I--,M+=d),0===A&&(this.nextAudioPts=T=M),f.b.warn("[mp4-remuxer]: Injecting "+I+" audio frame @ "+(M/h).toFixed(3)+"s due to "+Math.round(1e3*x/h)+" ms gap.");for(var _=0;_<I;_++){var R=Math.max(M,0),C=e.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);C||(f.b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),C=j.unit.subarray()),k.splice(A,0,{unit:C,pts:R}),M+=d,A++}}j.pts=M,M+=d}for(var N,P=null,U=null,F=0,B=k.length;B--;)F+=k[B].unit.byteLength;for(var $=0,G=k.length;$<G;$++){var V=k[$],X=V.unit,W=V.pts;if(null!==U)g[$-1].duration=Math.round((W-U)/c);else{if(n&&"aac"===t.segmentCodec&&(W=T),P=W,!(F>0))return;F+=O;try{N=new Uint8Array(F)}catch(t){return void this.observer.emit(o.a.ERROR,o.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:F,reason:"fail allocating audio mdat "+F})}m||(new DataView(N.buffer).setUint32(0,F),N.set(a.types.mdat,4))}N.set(X,O);var q=X.byteLength;O+=q,g.push(new w(!0,l,q,0)),U=W}var K=g.length;if(K){var z=g[g.length-1];this.nextAudioPts=T=U+c*z.duration;var H=m?new Uint8Array(0):a.moof(t.sequenceNumber++,P/c,v({},t,{samples:g}));t.samples=[];var Y=P/h,J=T/h,Q={data1:H,data2:N,startPTS:Y,endPTS:J,startDTS:Y,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:K};return this.isAudioContiguous=!0,Q}},i.remuxEmptyAudio=function(t,i,n,r){var s=t.inputTimeScale,h=s/(t.samplerate?t.samplerate:s),a=this.nextAudioPts,o=(null!==a?a:r.startDTS*s)+this._initDTS,u=r.endDTS*s+this._initDTS,c=1024*h,l=Math.ceil((u-o)/c),v=e.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(f.b.warn("[mp4-remuxer]: remux empty Audio"),v){for(var d=[],p=0;p<l;p++){var m=o+p*c;d.push({unit:v,pts:m,dts:m})}return t.samples=d,this.remuxAudio(t,i,n,!1)}f.b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t}();function b(t,i){var n;if(null===i)return t;for(n=i<t?-8589934592:8589934592;Math.abs(t-i)>4294967296;)t+=n;return t}function g(t,i,n,r){var e=t.samples.length;if(e){for(var s=t.inputTimeScale,h=0;h<e;h++){var a=t.samples[h];a.pts=b(a.pts-n,i*s)/s,a.dts=b(a.dts-r,i*s)/s}var o=t.samples;return t.samples=[],{samples:o}}}function y(t,i,n){var r=t.samples.length;if(r){for(var e=t.inputTimeScale,s=0;s<r;s++){var h=t.samples[s];h.pts=b(h.pts-n,i*e)/e}t.samples.sort((function(t,i){return t.pts-i.pts}));var a=t.samples;return t.samples=[],{samples:a}}}var w=function(t,i,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=i,this.size=n,this.cts=r,this.flags=new k(t)},k=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},function(t,i,n){n.d(i,"a",(function(){return r}));var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},function(t,i,n){var r=Object.prototype.hasOwnProperty,e="~";function s(){}function h(t,i,n){this.fn=t,this.context=i,this.once=n||!1}function a(t,i,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new h(n,r||t,s),o=e?e+i:i;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],a]:t._events[o].push(a):(t._events[o]=a,t._eventsCount++),t}function o(t,i){0==--t._eventsCount?t._events=new s:delete t._events[i]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(e=!1)),u.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)r.call(t,i)&&n.push(e?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},u.prototype.listeners=function(t){var i=e?e+t:t,n=this._events[i];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,h=new Array(s);r<s;r++)h[r]=n[r].fn;return h},u.prototype.listenerCount=function(t){var i=e?e+t:t,n=this._events[i];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,i,n,r,s,h){var a=e?e+t:t;if(!this._events[a])return!1;var o,u,f=this._events[a],c=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),c){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,i),!0;case 3:return f.fn.call(f.context,i,n),!0;case 4:return f.fn.call(f.context,i,n,r),!0;case 5:return f.fn.call(f.context,i,n,r,s),!0;case 6:return f.fn.call(f.context,i,n,r,s,h),!0}for(u=1,o=new Array(c-1);u<c;u++)o[u-1]=arguments[u];f.fn.apply(f.context,o)}else{var l,v=f.length;for(u=0;u<v;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),c){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,i);break;case 3:f[u].fn.call(f[u].context,i,n);break;case 4:f[u].fn.call(f[u].context,i,n,r);break;default:if(!o)for(l=1,o=new Array(c-1);l<c;l++)o[l-1]=arguments[l];f[u].fn.apply(f[u].context,o)}}return!0},u.prototype.on=function(t,i,n){return a(this,t,i,n,!1)},u.prototype.once=function(t,i,n){return a(this,t,i,n,!0)},u.prototype.removeListener=function(t,i,n,r){var s=e?e+t:t;if(!this._events[s])return this;if(!i)return o(this,s),this;var h=this._events[s];if(h.fn)h.fn!==i||r&&!h.once||n&&h.context!==n||o(this,s);else{for(var a=0,u=[],f=h.length;a<f;a++)(h[a].fn!==i||r&&!h[a].once||n&&h[a].context!==n)&&u.push(h[a]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},u.prototype.removeAllListeners=function(t){var i;return t?(i=e?e+t:t,this._events[i]&&o(this,i)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,t.exports=u},function(t,i,n){n.d(i,"a",(function(){return u}));var r=function(){function t(t,i){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=i}return t.prototype.decrypt=function(t,i){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},i,t)},t}(),e=function(){function t(t,i){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=i}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),s=n(9),h=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var i=t.prototype;return i.uint8ArrayToUint32Array_=function(t){for(var i=new DataView(t),n=new Uint32Array(4),r=0;r<4;r++)n[r]=i.getUint32(4*r);return n},i.initTable=function(){var t=this.sBox,i=this.invSBox,n=this.subMix,r=n[0],e=n[1],s=n[2],h=n[3],a=this.invSubMix,o=a[0],u=a[1],f=a[2],c=a[3],l=new Uint32Array(256),v=0,d=0,p=0;for(p=0;p<256;p++)l[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=d^d<<1^d<<2^d<<3^d<<4;m=m>>>8^255&m^99,t[v]=m,i[m]=v;var b=l[v],g=l[b],y=l[g],w=257*l[m]^16843008*m;r[v]=w<<24|w>>>8,e[v]=w<<16|w>>>16,s[v]=w<<8|w>>>24,h[v]=w,w=16843009*y^65537*g^257*b^16843008*v,o[m]=w<<24|w>>>8,u[m]=w<<16|w>>>16,f[m]=w<<8|w>>>24,c[m]=w,v?(v=b^l[l[l[y^b]]],d^=l[l[d]]):v=d=1}},i.expandKey=function(t){for(var i=this.uint8ArrayToUint32Array_(t),n=!0,r=0;r<i.length&&n;)n=i[r]===this.key[r],r++;if(!n){this.key=i;var e=this.keySize=i.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var s,h,a,o,u=this.ksRows=4*(e+6+1),f=this.keySchedule=new Uint32Array(u),c=this.invKeySchedule=new Uint32Array(u),l=this.sBox,v=this.rcon,d=this.invSubMix,p=d[0],m=d[1],b=d[2],g=d[3];for(s=0;s<u;s++)s<e?a=f[s]=i[s]:(o=a,s%e==0?(o=l[(o=o<<8|o>>>24)>>>24]<<24|l[o>>>16&255]<<16|l[o>>>8&255]<<8|l[255&o],o^=v[s/e|0]<<24):e>6&&s%e==4&&(o=l[o>>>24]<<24|l[o>>>16&255]<<16|l[o>>>8&255]<<8|l[255&o]),f[s]=a=(f[s-e]^o)>>>0);for(h=0;h<u;h++)s=u-h,o=3&h?f[s]:f[s-4],c[h]=h<4||s<=4?o:p[l[o>>>24]]^m[l[o>>>16&255]]^b[l[o>>>8&255]]^g[l[255&o]],c[h]=c[h]>>>0}},i.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},i.decrypt=function(t,i,n){for(var r,e,s,h,a,o,u,f,c,l,v,d,p,m,b=this.keySize+6,g=this.invKeySchedule,y=this.invSBox,w=this.invSubMix,k=w[0],O=w[1],T=w[2],E=w[3],S=this.uint8ArrayToUint32Array_(n),A=S[0],M=S[1],j=S[2],D=S[3],x=new Int32Array(t),L=new Int32Array(x.length),I=this.networkToHostOrderSwap;i<x.length;){for(c=I(x[i]),l=I(x[i+1]),v=I(x[i+2]),d=I(x[i+3]),a=c^g[0],o=d^g[1],u=v^g[2],f=l^g[3],p=4,m=1;m<b;m++)r=k[a>>>24]^O[o>>16&255]^T[u>>8&255]^E[255&f]^g[p],e=k[o>>>24]^O[u>>16&255]^T[f>>8&255]^E[255&a]^g[p+1],s=k[u>>>24]^O[f>>16&255]^T[a>>8&255]^E[255&o]^g[p+2],h=k[f>>>24]^O[a>>16&255]^T[o>>8&255]^E[255&u]^g[p+3],a=r,o=e,u=s,f=h,p+=4;r=y[a>>>24]<<24^y[o>>16&255]<<16^y[u>>8&255]<<8^y[255&f]^g[p],e=y[o>>>24]<<24^y[u>>16&255]<<16^y[f>>8&255]<<8^y[255&a]^g[p+1],s=y[u>>>24]<<24^y[f>>16&255]<<16^y[a>>8&255]<<8^y[255&o]^g[p+2],h=y[f>>>24]<<24^y[a>>16&255]<<16^y[o>>8&255]<<8^y[255&u]^g[p+3],L[i]=I(r^A),L[i+1]=I(h^M),L[i+2]=I(s^j),L[i+3]=I(e^D),A=c,M=l,j=v,D=d,i+=4}return L.buffer},t}(),a=n(1),o=n(5),u=function(){function t(t,i,n){var r=(void 0===n?{}:n).removePKCS7Padding,e=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=i,this.removePKCS7Padding=e,e)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var i=t.prototype;return i.destroy=function(){this.observer=null},i.isSync=function(){return this.config.enableSoftwareAES},i.flush=function(){var t=this.currentResult;if(t){var i,n,r,e=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?(r=(n=(i=e).byteLength)&&new DataView(i.buffer).getUint8(n-1))?Object(s.a)(i,0,n-r):i:e}this.reset()},i.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},i.decrypt=function(t,i,n,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),i,n);var e=this.flush();e&&r(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),i,n).then(r)},i.softwareDecrypt=function(t,i,n){var r=this.currentIV,e=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(t=Object(o.b)(a,t),this.remainderData=null);var u=this.getValidChunk(t);if(!u.length)return null;r&&(n=r);var f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new h),f.expandKey(i);var c=e;return this.currentResult=f.decrypt(u.buffer,0,n),this.currentIV=Object(s.a)(u,-16).buffer,c||null},i.webCryptoDecrypt=function(t,i,n){var s=this,h=this.subtle;return this.key===i&&this.fastAesKey||(this.key=i,this.fastAesKey=new e(h,i)),this.fastAesKey.expandKey().then((function(i){return h?new r(h,n).decrypt(t.buffer,i):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return s.onWebCryptoError(r,t,i,n)}))},i.onWebCryptoError=function(t,i,n,r){return a.b.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(i,n,r)},i.getValidChunk=function(t){var i=t,n=t.length-t.length%16;return n!==t.length&&(i=Object(s.a)(t,0,n),this.remainderData=Object(s.a)(t,n)),i},i.logOnce=function(t){this.logEnabled&&(a.b.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},function(t,i,n){n.d(i,"a",(function(){return s}));var r=n(12);function e(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(t,i){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=i?Object(r.buildAbsoluteURL)(t,i,{alwaysNormalize:!0}):t}var i,n,s;return t.fromURL=function(i,n){return new t(i,n)},t.fromURI=function(i){return new t(i)},i=t,(n=[{key:"uri",get:function(){return this._uri}}])&&e(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}()},function(t,i,n){function r(t){var i={};function n(r){if(i[r])return i[r].exports;var e=i[r]={i:r,l:!1,exports:{}};return t[r].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=t,n.c=i,n.i=function(t){return t},n.d=function(t,i,r){n.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="/",n.oe=function(t){throw t};var r=n(n.s=ENTRY_MODULE);return r.default||r}function e(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,i,r){var s={};s[r]=[];var h=i.toString(),a=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return s;for(var o,u=a[1],f=new RegExp("(\\\\n|\\W)"+e(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");o=f.exec(h);)"dll-reference"!==o[3]&&s[r].push(o[3]);for(f=new RegExp("\\("+e(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");o=f.exec(h);)t[o[2]]||(s[r].push(o[1]),t[o[2]]=n(o[1]).m),s[o[2]]=s[o[2]]||[],s[o[2]].push(o[4]);for(var c,l=Object.keys(s),v=0;v<l.length;v++)for(var d=0;d<s[l[v]].length;d++)c=s[l[v]][d],isNaN(1*c)||(s[l[v]][d]=1*s[l[v]][d]);return s}function h(t){return Object.keys(t).reduce((function(i,n){return i||t[n].length>0}),!1)}t.exports=function(t,i){i=i||{};var e={main:n.m},a=i.all?{main:Object.keys(e.main)}:function(t,i){for(var n={main:[i]},r={main:[]},e={main:{}};h(n);)for(var a=Object.keys(n),o=0;o<a.length;o++){var u=a[o],f=n[u].pop();if(e[u]=e[u]||{},!e[u][f]&&t[u][f]){e[u][f]=!0,r[u]=r[u]||[],r[u].push(f);for(var c=s(t,t[u][f],u),l=Object.keys(c),v=0;v<l.length;v++)n[l[v]]=n[l[v]]||[],n[l[v]]=n[l[v]].concat(c[l[v]])}}return r}(e,t),o="";Object.keys(a).filter((function(t){return"main"!==t})).forEach((function(t){for(var i=0;a[t][i];)i++;a[t].push(i),e[t][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+a[t].map((function(i){return JSON.stringify(i)+": "+e[t][i].toString()})).join(",")+"});\n"})),o=o+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map((function(t){return JSON.stringify(t)+": "+e.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([o],{type:"text/javascript"});if(i.bare)return u;var f=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),c=new window.Worker(f);return c.objectURL=f,c}},function(t,i,n){n.r(i),n.d(i,"default",(function(){return a}));var r=n(10),e=n(0),s=n(1),h=n(15);function a(t){var i=new h.EventEmitter,n=function(i,n){t.postMessage({event:i,data:n})};i.on(e.a.FRAG_DECRYPTED,n),i.on(e.a.ERROR,n),t.addEventListener("message",(function(e){var h=e.data;switch(h.cmd){case"init":var a=JSON.parse(h.config);t.transmuxer=new r.c(i,h.typeSupported,a,h.vendor,h.id),Object(s.a)(a.debug),function(){var t=function(t){s.b[t]=function(i){n("workerLog",{logType:t,message:i})}};for(var i in s.b)t(i)}(),n("init",null);break;case"configure":t.transmuxer.configure(h.config);break;case"demux":var u=t.transmuxer.push(h.data,h.decryptdata,h.chunkMeta,h.state);Object(r.d)(u)?u.then((function(i){o(t,i)})):o(t,u);break;case"flush":var c=h.chunkMeta,l=t.transmuxer.flush(c);Object(r.d)(l)?l.then((function(i){f(t,i,c)})):f(t,l,c)}}))}function o(t,i){if(!((n=i.remuxResult).audio||n.video||n.text||n.id3||n.initSegment))return!1;var n,r=[],e=i.remuxResult,s=e.audio,h=e.video;return s&&u(r,s),h&&u(r,h),t.postMessage({event:"transmuxComplete",data:i},r),!0}function u(t,i){i.data1&&t.push(i.data1.buffer),i.data2&&t.push(i.data2.buffer)}function f(t,i,n){i.reduce((function(i,n){return o(t,n)||i}),!1)||t.postMessage({event:"transmuxComplete",data:i[0]}),t.postMessage({event:"flush",data:n})}},function(t,i,n){n.r(i),n.d(i,"default",(function(){return vr}));var r,e=n(12),s=n(3),h=n(0),a=n(2),o=n(1),u=n(5),f=/^(\d+)x(\d+)$/,c=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,l=function(){function t(i){for(var n in"string"==typeof i&&(i=t.parseAttrList(i)),i)i.hasOwnProperty(n)&&(this[n]=i[n])}var i=t.prototype;return i.decimalInteger=function(t){var i=parseInt(this[t],10);return i>Number.MAX_SAFE_INTEGER?1/0:i},i.hexadecimalInteger=function(t){if(this[t]){var i=(this[t]||"0x").slice(2);i=(1&i.length?"0":"")+i;for(var n=new Uint8Array(i.length/2),r=0;r<i.length/2;r++)n[r]=parseInt(i.slice(2*r,2*r+2),16);return n}return null},i.hexadecimalIntegerAsNumber=function(t){var i=parseInt(this[t],16);return i>Number.MAX_SAFE_INTEGER?1/0:i},i.decimalFloatingPoint=function(t){return parseFloat(this[t])},i.optionalFloat=function(t,i){var n=this[t];return n?parseFloat(n):i},i.enumeratedString=function(t){return this[t]},i.bool=function(t){return"YES"===this[t]},i.decimalResolution=function(t){var i=f.exec(this[t]);if(null!==i)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}},t.parseAttrList=function(t){var i,n={};for(c.lastIndex=0;null!==(i=c.exec(t));){var r=i[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[i[1]]=r}return n},t}();function v(){return(v=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function d(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.ID="ID",t.CLASS="CLASS",t.START_DATE="START-DATE",t.DURATION="DURATION",t.END_DATE="END-DATE",t.END_ON_NEXT="END-ON-NEXT",t.PLANNED_DURATION="PLANNED-DURATION",t.SCTE35_OUT="SCTE35-OUT",t.SCTE35_IN="SCTE35-IN"}(r||(r={}));var p=function(){function t(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var e in n)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==n[e]){o.b.warn('DATERANGE tag attribute: "'+e+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=e;break}t=v(new l({}),n,t)}if(this.attr=t,this._startDate=new Date(t[r.START_DATE]),r.END_DATE in this.attr){var h=new Date(this.attr[r.END_DATE]);Object(s.a)(h.getTime())&&(this._endDate=h)}}var i,n,e;return i=t,(n=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(r.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(r.DURATION);if(Object(s.a)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return r.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(r.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(r.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(s.a)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&d(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(),m=n(6);function b(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var g=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var i,n,r;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||0===i&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},i=t,(n=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(s.a)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&b(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(),y=n(17),w={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function k(t,i){return MediaSource.isTypeSupported((i||"video")+'/mp4;codecs="'+t+'"')}var O=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,E=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),S=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),A=/\.(mp4|m4s|m4v|m4a)$/i,M=function(){function t(){}return t.findGroup=function(t,i){for(var n=0;n<t.length;n++){var r=t[n];if(r.id===i)return r}},t.convertAVC1ToAVCOTI=function(t){var i=t.split(".");if(i.length>2){var n=i.shift()+".";return n+=parseInt(i.shift()).toString(16),n+=("000"+parseInt(i.shift()).toString(16)).slice(-4)}return t},t.resolve=function(t,i){return e.buildAbsoluteURL(i,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(i,n){var r,e=[],s={},h=!1;for(O.lastIndex=0;null!=(r=O.exec(i));)if(r[1]){var a=new l(r[1]),o={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:t.resolve(r[2],n)},u=a.decimalResolution("RESOLUTION");u&&(o.width=u.width,o.height=u.height),j((a.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=t.convertAVC1ToAVCOTI(o.videoCodec)),e.push(o)}else if(r[3]){var f=new l(r[3]);f["DATA-ID"]&&(h=!0,s[f["DATA-ID"]]=f)}return{levels:e,sessionData:h?s:null}},t.parseMasterPlaylistMedia=function(i,n,r,e){var s;void 0===e&&(e=[]);var h=[],a=0;for(T.lastIndex=0;null!==(s=T.exec(i));){var o=new l(s[1]);if(o.TYPE===r){var u={attrs:o,bitrate:0,id:a++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:r,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?t.resolve(o.URI,n):""};if(e.length){var f=t.findGroup(e,u.groupId)||e[0];D(u,f,"audioCodec"),D(u,f,"textCodec")}h.push(u)}}return h},t.parseLevelPlaylist=function(t,i,n,r,h){var a,u,f,c=new g(i),v=c.fragments,d=null,b=0,w=0,k=0,O=0,T=null,M=new m.b(r,i),j=-1,D=!1;for(E.lastIndex=0,c.m3u8=t;null!==(a=E.exec(t));){D&&(D=!1,(M=new m.b(r,i)).start=k,M.sn=b,M.cc=O,M.level=n,d&&(M.initSegment=d,M.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var I=a[1];if(I){M.duration=parseFloat(I);var _=(" "+a[2]).slice(1);M.title=_||null,M.tagList.push(_?["INF",I,_]:["INF",I])}else if(a[3])Object(s.a)(M.duration)&&(M.start=k,f&&(M.levelkey=f),M.sn=b,M.level=n,M.cc=O,M.urlId=h,v.push(M),M.relurl=(" "+a[3]).slice(1),x(M,T),T=M,k+=M.duration,b++,w=0,D=!0);else if(a[4]){var R=(" "+a[4]).slice(1);T?M.setByteRange(R,T):M.setByteRange(R)}else if(a[5])M.rawProgramDateTime=(" "+a[5]).slice(1),M.tagList.push(["PROGRAM-DATE-TIME",M.rawProgramDateTime]),-1===j&&(j=v.length);else{if(!(a=a[0].match(S))){o.b.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<a.length&&void 0===a[u];u++);var C=(" "+a[u]).slice(1),N=(" "+a[u+1]).slice(1),P=a[u+2]?(" "+a[u+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":c.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":b=c.startSN=parseInt(N);break;case"SKIP":var U=new l(N),F=U.decimalInteger("SKIPPED-SEGMENTS");if(Object(s.a)(F)){c.skippedSegments=F;for(var B=F;B--;)v.unshift(null);b+=F}var $=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");$&&(c.recentlyRemovedDateranges=$.split("\t"));break;case"TARGETDURATION":c.targetduration=parseFloat(N);break;case"VERSION":c.version=parseInt(N);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(N||P)&&M.tagList.push(P?[N,P]:[N]);break;case"DISCONTINUITY":O++,M.tagList.push(["DIS"]);break;case"GAP":M.tagList.push([C]);break;case"BITRATE":M.tagList.push([C,N]);break;case"DATERANGE":var G=new l(N),V=new p(G,c.dateRanges[G.ID]);V.isValid||c.skippedSegments?c.dateRanges[V.id]=V:o.b.warn('Ignoring invalid DATERANGE tag: "'+N+'"'),M.tagList.push(["EXT-X-DATERANGE",N]);break;case"DISCONTINUITY-SEQUENCE":O=parseInt(N);break;case"KEY":var X,W=new l(N),q=W.enumeratedString("METHOD"),K=W.URI,z=W.hexadecimalInteger("IV"),H=W.enumeratedString("KEYFORMATVERSIONS"),Y=W.enumeratedString("KEYID"),J=null!=(X=W.enumeratedString("KEYFORMAT"))?X:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(J)>-1){o.b.warn("Keyformat "+J+" is not supported from the manifest");continue}if("identity"!==J)continue;q&&(f=y.a.fromURL(i,K),K&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(q)>=0&&(f.method=q,f.keyFormat=J,Y&&(f.keyID=Y),H&&(f.keyFormatVersions=H),f.iv=z));break;case"START":var Q=new l(N).decimalFloatingPoint("TIME-OFFSET");Object(s.a)(Q)&&(c.startTimeOffset=Q);break;case"MAP":var Z=new l(N);if(M.duration){var tt=new m.b(r,i);L(tt,Z,n,f),d=tt,M.initSegment=d,d.rawProgramDateTime&&!M.rawProgramDateTime&&(M.rawProgramDateTime=d.rawProgramDateTime)}else L(M,Z,n,f),d=M,D=!0;break;case"SERVER-CONTROL":var it=new l(N);c.canBlockReload=it.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=it.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&it.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=it.optionalFloat("PART-HOLD-BACK",0),c.holdBack=it.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var nt=new l(N);c.partTarget=nt.decimalFloatingPoint("PART-TARGET");break;case"PART":var rt=c.partList;rt||(rt=c.partList=[]);var et=w>0?rt[rt.length-1]:void 0,st=w++,ht=new m.c(new l(N),M,i,st,et);rt.push(ht),M.duration+=ht.duration;break;case"PRELOAD-HINT":var at=new l(N);c.preloadHint=at;break;case"RENDITION-REPORT":var ot=new l(N);c.renditionReports=c.renditionReports||[],c.renditionReports.push(ot);break;default:o.b.warn("line parsed but not handled: "+a)}}}T&&!T.relurl?(v.pop(),k-=T.duration,c.partList&&(c.fragmentHint=T)):c.partList&&(x(M,T),M.cc=O,c.fragmentHint=M);var ut=v.length,ft=v[0],ct=v[ut-1];if((k+=c.skippedSegments*c.targetduration)>0&&ut&&ct){c.averagetargetduration=k/ut;var lt=ct.sn;c.endSN="initSegment"!==lt?lt:0,ft&&(c.startCC=ft.cc,ft.initSegment||c.fragments.every((function(t){return t.relurl&&(i=t.relurl,A.test(null!=(n=null===(r=e.parseURL(i))||void 0===r?void 0:r.path)?n:""));var i,n,r}))&&(o.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(M=new m.b(r,i)).relurl=ct.relurl,M.level=n,M.sn="initSegment",ft.initSegment=M,c.needSidxRanges=!0))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(k+=c.fragmentHint.duration),c.totalduration=k,c.endCC=O,j>0&&function(t,i){for(var n=t[i],r=i;r--;){var e=t[r];if(!e)return;e.programDateTime=n.programDateTime-1e3*e.duration,n=e}}(v,j),c},t}();function j(t,i){["video","audio","text"].forEach((function(n){var r=t.filter((function(t){return function(t,i){var n=w[i];return!!n&&!0===n[t.slice(0,4)]}(t,n)}));if(r.length){var e=r.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));i[n+"Codec"]=e.length>0?e[0]:r[0],t=t.filter((function(t){return-1===r.indexOf(t)}))}})),i.unknownCodecs=t}function D(t,i,n){var r=i[n];r&&(t[n]=r)}function x(t,i){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=i&&i.programDateTime&&(t.programDateTime=i.endProgramDateTime),Object(s.a)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function L(t,i,n,r){t.relurl=i.URI,i.BYTERANGE&&t.setByteRange(i.BYTERANGE),t.level=n,t.sn="initSegment",r&&(t.levelkey=r),t.initSegment=null}var I=n(4);function _(t,i){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=i.url),n}var R=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var i=t.prototype;return i.startLoad=function(t){},i.stopLoad=function(){this.destroyInternalLoaders()},i.registerListeners=function(){var t=this.hls;t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(h.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(h.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},i.unregisterListeners=function(){var t=this.hls;t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(h.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(h.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},i.createInternalLoader=function(t){var i=this.hls.config,n=i.pLoader,r=i.loader,e=new(n||r)(i);return t.loader=e,this.loaders[t.type]=e,e},i.getInternalLoader=function(t){return this.loaders[t.type]},i.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},i.destroyInternalLoaders=function(){for(var t in this.loaders){var i=this.loaders[t];i&&i.destroy(),this.resetInternalLoader(t)}},i.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},i.onManifestLoading=function(t,i){var n=i.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:I.a.MANIFEST,url:n,deliveryDirectives:null})},i.onLevelLoading=function(t,i){var n=i.id,r=i.level,e=i.url,s=i.deliveryDirectives;this.load({id:n,groupId:null,level:r,responseType:"text",type:I.a.LEVEL,url:e,deliveryDirectives:s})},i.onAudioTrackLoading=function(t,i){var n=i.id,r=i.groupId,e=i.url,s=i.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:I.a.AUDIO_TRACK,url:e,deliveryDirectives:s})},i.onSubtitleTrackLoading=function(t,i){var n=i.id,r=i.groupId,e=i.url,s=i.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:I.a.SUBTITLE_TRACK,url:e,deliveryDirectives:s})},i.load=function(t){var i,n,r,e,s,h,a=this.hls.config,u=this.getInternalLoader(t);if(u){var f=u.context;if(f&&f.url===t.url)return void o.b.trace("[playlist-loader]: playlist request ongoing");o.b.log("[playlist-loader]: aborting previous loader for type: "+t.type),u.abort()}switch(t.type){case I.a.MANIFEST:n=a.manifestLoadingMaxRetry,r=a.manifestLoadingTimeOut,e=a.manifestLoadingRetryDelay,s=a.manifestLoadingMaxRetryTimeout;break;case I.a.LEVEL:case I.a.AUDIO_TRACK:case I.a.SUBTITLE_TRACK:n=0,r=a.levelLoadingTimeOut;break;default:n=a.levelLoadingMaxRetry,r=a.levelLoadingTimeOut,e=a.levelLoadingRetryDelay,s=a.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(t),null!==(i=t.deliveryDirectives)&&void 0!==i&&i.part&&(t.type===I.a.LEVEL&&null!==t.level?h=this.hls.levels[t.level].details:t.type===I.a.AUDIO_TRACK&&null!==t.id?h=this.hls.audioTracks[t.id].details:t.type===I.a.SUBTITLE_TRACK&&null!==t.id&&(h=this.hls.subtitleTracks[t.id].details),h)){var c=h.partTarget,l=h.targetduration;c&&l&&(r=Math.min(1e3*Math.max(3*c,.8*l),r))}var v={timeout:r,maxRetry:n,retryDelay:e,maxRetryDelay:s,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(t,v,d)},i.loadsuccess=function(t,i,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this.handleSidxRequest(t,n),void this.handlePlaylistLoaded(t,i,n,r);this.resetInternalLoader(n.type);var e=t.data;0===e.indexOf("#EXTM3U")?(i.parsing.start=performance.now(),e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,i,n,r):this.handleMasterPlaylist(t,i,n,r)):this.handleManifestParsingError(t,n,"no EXTM3U delimiter",r)},i.loaderror=function(t,i,n){void 0===n&&(n=null),this.handleNetworkError(i,n,!1,t)},i.loadtimeout=function(t,i,n){void 0===n&&(n=null),this.handleNetworkError(i,n,!0)},i.handleMasterPlaylist=function(t,i,n,r){var e=this.hls,s=t.data,a=_(t,n),u=M.parseMasterPlaylist(s,a),f=u.levels,c=u.sessionData;if(f.length){var v=f.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),d=f.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),p=M.parseMasterPlaylistMedia(s,a,"AUDIO",v),m=M.parseMasterPlaylistMedia(s,a,"SUBTITLES",d),b=M.parseMasterPlaylistMedia(s,a,"CLOSED-CAPTIONS");p.length&&(p.some((function(t){return!t.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(o.b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new l({}),bitrate:0,url:""}))),e.trigger(h.a.MANIFEST_LOADED,{levels:f,audioTracks:p,subtitles:m,captions:b,url:a,stats:i,networkDetails:r,sessionData:c})}else this.handleManifestParsingError(t,n,"no level found in manifest",r)},i.handleTrackOrLevelPlaylist=function(t,i,n,r){var e=this.hls,o=n.id,u=n.level,f=n.type,c=_(t,n),v=Object(s.a)(o)?o:0,d=Object(s.a)(u)?u:v,p=function(t){switch(t.type){case I.a.AUDIO_TRACK:return I.b.AUDIO;case I.a.SUBTITLE_TRACK:return I.b.SUBTITLE;default:return I.b.MAIN}}(n),m=M.parseLevelPlaylist(t.data,c,d,p,v);if(m.fragments.length){if(f===I.a.MANIFEST){var b={attrs:new l({}),bitrate:0,details:m,name:"",url:c};e.trigger(h.a.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:c,stats:i,networkDetails:r,sessionData:null})}if(i.parsing.end=performance.now(),m.needSidxRanges){var g,y=null===(g=m.fragments[0].initSegment)||void 0===g?void 0:g.url;this.load({url:y,isSidxRequest:!0,type:f,level:u,levelDetails:m,id:o,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=m,this.handlePlaylistLoaded(t,i,n,r)}else e.trigger(h.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.LEVEL_EMPTY_ERROR,fatal:!1,url:c,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},i.handleSidxRequest=function(t,i){var n=new Uint8Array(t.data),r=Object(u.c)(n,["sidx"])[0];if(r){var e=Object(u.k)(r);if(e){var s=e.references,h=i.levelDetails;s.forEach((function(t,i){var r=t.info,e=h.fragments[i];if(0===e.byteRange.length&&e.setByteRange(String(1+r.end-r.start)+"@"+String(r.start)),e.initSegment){var s=Object(u.c)(n,["moov"])[0],a=s?s.length:null;e.initSegment.setByteRange(String(a)+"@0")}}))}}},i.handleManifestParsingError=function(t,i,n,r){this.hls.trigger(h.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.MANIFEST_PARSING_ERROR,fatal:i.type===I.a.MANIFEST,url:t.url,reason:n,response:t,context:i,networkDetails:r})},i.handleNetworkError=function(t,i,n,r){void 0===n&&(n=!1),o.b.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var e=a.a.UNKNOWN,s=!1,u=this.getInternalLoader(t);switch(t.type){case I.a.MANIFEST:e=n?a.a.MANIFEST_LOAD_TIMEOUT:a.a.MANIFEST_LOAD_ERROR,s=!0;break;case I.a.LEVEL:e=n?a.a.LEVEL_LOAD_TIMEOUT:a.a.LEVEL_LOAD_ERROR,s=!1;break;case I.a.AUDIO_TRACK:e=n?a.a.AUDIO_TRACK_LOAD_TIMEOUT:a.a.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case I.a.SUBTITLE_TRACK:e=n?a.a.SUBTITLE_TRACK_LOAD_TIMEOUT:a.a.SUBTITLE_LOAD_ERROR,s=!1}u&&this.resetInternalLoader(t.type);var f={type:a.b.NETWORK_ERROR,details:e,fatal:s,url:t.url,loader:u,context:t,networkDetails:i};r&&(f.response=r),this.hls.trigger(h.a.ERROR,f)},i.handlePlaylistLoaded=function(t,i,n,r){var e=n.type,s=n.level,a=n.id,o=n.groupId,u=n.loader,f=n.levelDetails,c=n.deliveryDirectives;if(null!=f&&f.targetduration){if(u)switch(f.live&&(u.getCacheAge&&(f.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(f.ageHeader)||(f.ageHeader=0)),e){case I.a.MANIFEST:case I.a.LEVEL:this.hls.trigger(h.a.LEVEL_LOADED,{details:f,level:s||0,id:a||0,stats:i,networkDetails:r,deliveryDirectives:c});break;case I.a.AUDIO_TRACK:this.hls.trigger(h.a.AUDIO_TRACK_LOADED,{details:f,id:a||0,groupId:o||"",stats:i,networkDetails:r,deliveryDirectives:c});break;case I.a.SUBTITLE_TRACK:this.hls.trigger(h.a.SUBTITLE_TRACK_LOADED,{details:f,id:a||0,groupId:o||"",stats:i,networkDetails:r,deliveryDirectives:c})}}else this.handleManifestParsingError(t,n,"invalid target duration",r)},t}(),C=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this.registerListeners()}var i=t.prototype;return i.startLoad=function(t){},i.stopLoad=function(){this.destroyInternalLoaders()},i.registerListeners=function(){this.hls.on(h.a.KEY_LOADING,this.onKeyLoading,this)},i.unregisterListeners=function(){this.hls.off(h.a.KEY_LOADING,this.onKeyLoading)},i.destroyInternalLoaders=function(){for(var t in this.loaders){var i=this.loaders[t];i&&i.destroy()}this.loaders={}},i.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},i.onKeyLoading=function(t,i){var n=i.frag,r=n.type,e=this.loaders[r];if(n.decryptdata){var s=n.decryptdata.uri;if(s!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;if(e&&(o.b.warn("abort previous key loader for type:"+r),e.abort()),!s)return void o.b.warn("key uri is falsy");var u=a.loader,f=n.loader=this.loaders[r]=new u(a);this.decrypturl=s,this.decryptkey=null;var c={url:s,frag:n,responseType:"arraybuffer"},l={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(c,l,v)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(h.a.KEY_LOADED,{frag:n}))}else o.b.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(t,i,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(h.a.KEY_LOADED,{frag:r})):o.b.error("after key load, decryptdata unset")},i.loaderror=function(t,i){var n=i.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(h.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},i.loadtimeout=function(t,i){var n=i.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(h.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},t}();function N(t,i){var n;try{n=new Event("addtrack")}catch(t){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,i.dispatchEvent(n)}function P(t,i){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(i.id))try{if(t.addCue(i),!t.cues.getCueById(i.id))throw new Error("addCue is failed for: "+i)}catch(n){o.b.debug("[texttrack-utils]: "+n);var r=new self.TextTrackCue(i.startTime,i.endTime,i.text);r.id=i.id,t.addCue(r)}"disabled"===n&&(t.mode=n)}function U(t){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues)for(var n=t.cues.length;n--;)t.removeCue(t.cues[n]);"disabled"===i&&(t.mode=i)}function F(t,i,n,r){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var s=function(t,i,n){var r=[],e=function(t,i){if(i<t[0].startTime)return 0;var n=t.length-1;if(i>t[n].endTime)return-1;for(var r=0,e=n;r<=e;){var s=Math.floor((e+r)/2);if(i<t[s].startTime)e=s-1;else{if(!(i>t[s].startTime&&r<n))return s;r=s+1}}return t[r].startTime-i<i-t[e].startTime?r:e}(t,i);if(e>-1)for(var s=e,h=t.length;s<h;s++){var a=t[s];if(a.startTime>=i&&a.endTime<=n)r.push(a);else if(a.startTime>n)return r}return r}(t.cues,i,n),h=0;h<s.length;h++)r&&!r(s[h])||t.removeCue(s[h]);"disabled"===e&&(t.mode=e)}var B=n(7),$=n(8);function G(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function V(t,i){return t.getTime()/1e3-i}var X=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var i=t.prototype;return i.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},i._registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(h.a.LEVEL_UPDATED,this.onLevelUpdated,this)},i._unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(h.a.LEVEL_UPDATED,this.onLevelUpdated,this)},i.onMediaAttached=function(t,i){this.media=i.media},i.onMediaDetaching=function(){this.id3Track&&(U(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},i.onManifestLoading=function(){this.dateRangeCuesAppended={}},i.createTrack=function(t){var i=this.getID3Track(t.textTracks);return i.mode="hidden",i},i.getID3Track=function(t){if(this.media){for(var i=0;i<t.length;i++){var n=t[i];if("metadata"===n.kind&&"id3"===n.label)return N(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},i.onFragParsingMetadata=function(t,i){if(this.media){var n=this.hls.config,r=n.enableEmsgMetadataCues,e=n.enableID3MetadataCues;if(r||e){var s=i.frag,h=i.samples,a=i.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=a.edge||s.end,u=G(),f=!1,c={},l=0;l<h.length;l++){var v=h[l].type;if((v!==$.a.emsg||r)&&e){var d=B.c(h[l].data);if(d){var p=h[l].pts,m=o;m-p<=0&&(m=p+.25);for(var b=0;b<d.length;b++){var g=d[b];if(!B.e(g)){var y=new u(p,m,"");y.value=g,v&&(y.type=v),this.id3Track.addCue(y),c[g.key]=null,f=!0}}}}}f&&this.updateId3CueEnds(c)}}},i.updateId3CueEnds=function(t){var i,n=null===(i=this.id3Track)||void 0===i?void 0:i.cues;if(n)for(var r=n.length;r--;){var e,s=n[r],h=null===(e=s.value)||void 0===e?void 0:e.key;if(h&&h in t){var a=t[h];a&&s.endTime!==a&&(s.endTime=a),t[h]=s.startTime}}},i.onBufferFlushing=function(t,i){var n=i.startOffset,r=i.endOffset,e=i.type,s=this.id3Track,h=this.hls;if(h){var a=h.config,o=a.enableEmsgMetadataCues,u=a.enableID3MetadataCues;s&&(o||u)&&F(s,n,r,"audio"===e?function(t){return t.type===$.a.audioId3&&u}:"video"===e?function(t){return t.type===$.a.emsg&&o}:function(t){return t.type===$.a.audioId3&&u||t.type===$.a.emsg&&o})}},i.onLevelUpdated=function(t,i){var n=this,e=i.details;if(this.media&&e.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var h=this.dateRangeCuesAppended,a=this.id3Track,o=e.dateRanges,u=Object.keys(o);if(a)for(var f=Object.keys(h).filter((function(t){return!u.includes(t)})),c=function(t){var i=f[t];Object.keys(h[i].cues).forEach((function(t){a.removeCue(h[i].cues[t])})),delete h[i]},l=f.length;l--;)c(l);var v=e.fragments[e.fragments.length-1];if(0!==u.length&&Object(s.a)(null==v?void 0:v.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var d=v.programDateTime/1e3-v.start,p=e.edge||v.end,m=G(),b=function(t){var i=u[t],e=o[i],s=h[i],a=(null==s?void 0:s.cues)||{},f=(null==s?void 0:s.durationKnown)||!1,c=V(e.startDate,d),l=p,v=e.endDate;if(v)l=V(v,d),f=!0;else if(e.endOnNext&&!f){var b=u.reduce((function(t,i){var n=o[i];return n.class===e.class&&n.id!==i&&n.startDate>e.startDate&&t.push(n),t}),[]).sort((function(t,i){return t.startDate.getTime()-i.startDate.getTime()}))[0];b&&(l=V(b.startDate,d),f=!0)}for(var g,y=Object.keys(e.attr),w=0;w<y.length;w++){var k=y[w];if(k!==r.ID&&k!==r.CLASS&&k!==r.START_DATE&&k!==r.DURATION&&k!==r.END_DATE&&k!==r.END_ON_NEXT){var O=a[k];if(O)f&&!s.durationKnown&&(O.endTime=l);else{var T=e.attr[k];O=new m(c,l,""),k!==r.SCTE35_OUT&&k!==r.SCTE35_IN||(g=T,T=Uint8Array.from(g.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),O.value={key:k,data:T},O.type=$.a.dateRange,n.id3Track.addCue(O),a[k]=O}}}h[i]={cues:a,dateRange:e,durationKnown:f}},g=0;g<u.length;g++)b(g)}}},t}();function W(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var q,K=function(){function t(t){var i=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return i.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var i,n,r,e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},e.registerListeners=function(){this.hls.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(h.a.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(h.a.ERROR,this.onError,this)},e.unregisterListeners=function(){this.hls.off(h.a.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(h.a.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(h.a.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(h.a.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(h.a.ERROR,this.onError)},e.onMediaAttached=function(t,i){this.media=i.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},e.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},e.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},e.onLevelUpdated=function(t,i){var n=i.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},e.onError=function(t,i){i.details===a.a.BUFFER_STALLED_ERROR&&(this.stallCount++,o.b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},e.timeupdate=function(){var t=this.media,i=this.levelDetails;if(t&&i){this.currentTime=t.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var r=this.config,e=r.lowLatencyMode,s=r.maxLiveSyncPlaybackRate;if(e&&1!==s){var h=this.targetLatency;if(null!==h){var a=n-h,o=a<Math.min(this.maxLatency,h+i.targetduration);if(i.live&&o&&a>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,s)),f=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;t.playbackRate=Math.min(u,Math.max(1,f))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},e.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},e.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},i=t,(n=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,i=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:i?t.liveMaxLatencyDurationCount*i.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var i=t.holdBack,n=t.partHoldBack,r=t.targetduration,e=this.config,s=e.liveSyncDuration,h=e.liveSyncDurationCount,a=e.lowLatencyMode,o=this.hls.userConfig,u=a&&n||i;(o.liveSyncDuration||o.liveSyncDurationCount||0===u)&&(u=void 0!==s?s:h*r);var f=r;return u+Math.min(1*this.stallCount,f)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),i=this.targetLatency,n=this.levelDetails;if(null===t||null===i||null===n)return null;var r=n.edge,e=t-i-this.edgeStalled,s=r-n.totalduration,h=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,e),h)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var i=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-i,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,i=this.levelDetails;if(!t||!i)return 0;var n=t.buffered.length;return(n?t.buffered.end(n-1):i.edge)-this.currentTime}}])&&W(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function z(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.No="",t.Yes="YES",t.v2="v2"}(q||(q={}));var H=function(){function t(t,i,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=i,this.skip=n}return t.prototype.addDirectives=function(t){var i=new self.URL(t);return void 0!==this.msn&&i.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&i.searchParams.set("_HLS_part",this.part.toString()),this.skip&&i.searchParams.set("_HLS_skip",this.skip),i.toString()},t}(),Y=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var i,n,r;return i=t,(n=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&z(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function J(){return(J=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Q(t,i,n){switch(i){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function Z(t){var i={};t.forEach((function(t){var n=t.groupId||"";t.id=i[n]=i[n]||0,i[n]++}))}function tt(t,i){var n=i.startPTS;if(Object(s.a)(n)){var r,e=0;i.sn>t.sn?(e=n-t.start,r=t):(e=t.start-n,r=i),r.duration!==e&&(r.duration=e)}else i.sn>t.sn?t.cc===i.cc&&t.minEndPTS?i.start=t.start+(t.minEndPTS-t.start):i.start=t.start+t.duration:i.start=Math.max(t.start-i.duration,0)}function it(t,i,n,r,e,h){r-n<=0&&(o.b.warn("Fragment should have a positive duration",i),r=n+i.duration,h=e+i.duration);var a=n,u=r,f=i.startPTS,c=i.endPTS;if(Object(s.a)(f)){var l=Math.abs(f-n);Object(s.a)(i.deltaPTS)?i.deltaPTS=Math.max(l,i.deltaPTS):i.deltaPTS=l,a=Math.max(n,f),n=Math.min(n,f),e=Math.min(e,i.startDTS),u=Math.min(r,c),r=Math.max(r,c),h=Math.max(h,i.endDTS)}i.duration=r-n;var v=n-i.start;i.appendedPTS=r,i.start=i.startPTS=n,i.maxStartPTS=a,i.startDTS=e,i.endPTS=r,i.minEndPTS=u,i.endDTS=h;var d,p=i.sn;if(!t||p<t.startSN||p>t.endSN)return 0;var m=p-t.startSN,b=t.fragments;for(b[m]=i,d=m;d>0;d--)tt(b[d],b[d-1]);for(d=m;d<b.length-1;d++)tt(b[d],b[d+1]);return t.fragmentHint&&tt(b[b.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,v}function nt(t,i){for(var n=null,r=t.fragments,e=r.length-1;e>=0;e--){var h=r[e].initSegment;if(h){n=h;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var a,u=0;if(function(t,i,n){for(var r=i.skippedSegments,e=Math.max(t.startSN,i.startSN)-i.startSN,s=(t.fragmentHint?1:0)+(r?i.endSN:Math.min(t.endSN,i.endSN))-i.startSN,h=i.startSN-t.startSN,a=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e;u<=s;u++){var f=o[h+u],c=a[u];r&&!c&&u<r&&(c=i.fragments[u]=f),f&&c&&n(f,c)}}(t,i,(function(t,r){t.relurl&&(u=t.cc-r.cc),Object(s.a)(t.startPTS)&&Object(s.a)(t.endPTS)&&(r.start=r.startPTS=t.startPTS,r.startDTS=t.startDTS,r.appendedPTS=t.appendedPTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.duration=t.endPTS-t.startPTS,r.duration&&(a=r),i.PTSKnown=i.alignedSliding=!0),r.elementaryStreams=t.elementaryStreams,r.loader=t.loader,r.stats=t.stats,r.urlId=t.urlId,t.initSegment&&(r.initSegment=t.initSegment,n=t.initSegment)})),n&&(i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments).forEach((function(t){var i;t.initSegment&&t.initSegment.relurl!==(null===(i=n)||void 0===i?void 0:i.relurl)||(t.initSegment=n)})),i.skippedSegments)if(i.deltaUpdateFailed=i.fragments.some((function(t){return!t})),i.deltaUpdateFailed){o.b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=i.skippedSegments;f--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}else i.canSkipDateRanges&&(i.dateRanges=function(t,i,n){var r=J({},t);return n&&n.forEach((function(t){delete r[t]})),Object.keys(i).forEach((function(t){var n=new p(i[t].attr,r[t]);n.isValid?r[t]=n:o.b.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(i[t].attr)+'"')})),r}(t.dateRanges,i.dateRanges,i.recentlyRemovedDateranges));var c=i.fragments;if(u){o.b.warn("discontinuity sliding from playlist, take drift into account");for(var l=0;l<c.length;l++)c[l].cc+=u}i.skippedSegments&&(i.startCC=i.fragments[0].cc),function(t,i,n){if(t&&i)for(var r=0,e=0,s=t.length;e<=s;e++){var h=t[e],a=i[e+r];h&&a&&h.index===a.index&&h.fragment.sn===a.fragment.sn?n(h,a):r--}}(t.partList,i.partList,(function(t,i){i.elementaryStreams=t.elementaryStreams,i.stats=t.stats})),a?it(i,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):rt(t,i),c.length&&(i.totalduration=i.edge-c[0].start),i.driftStartTime=t.driftStartTime,i.driftStart=t.driftStart;var v=i.advancedDateTime;if(i.advanced&&v){var d=i.edge;i.driftStart||(i.driftStartTime=v,i.driftStart=d),i.driftEndTime=v,i.driftEnd=d}else i.driftEndTime=t.driftEndTime,i.driftEnd=t.driftEnd,i.advancedDateTime=t.advancedDateTime}function rt(t,i){var n=i.startSN+i.skippedSegments-t.startSN,r=t.fragments;n<0||n>=r.length||et(i,r[n].start)}function et(t,i){if(i){for(var n=t.fragments,r=t.skippedSegments;r<n.length;r++)n[r].start+=i;t.fragmentHint&&(t.fragmentHint.start+=i)}}var st=function(){function t(t,i){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=o.b.log.bind(o.b,i+":"),this.warn=o.b.warn.bind(o.b,i+":"),this.hls=t}var i=t.prototype;return i.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},i.onError=function(t,i){i.fatal&&i.type===a.b.NETWORK_ERROR&&this.clearTimer()},i.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},i.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},i.stopLoad=function(){this.canLoad=!1,this.clearTimer()},i.switchParams=function(t,i){var n=null==i?void 0:i.renditionReports;if(n)for(var r=0;r<n.length;r++){var e=n[r],h=""+e.URI;if(h===t.slice(-h.length)){var a=parseInt(e["LAST-MSN"]),o=parseInt(e["LAST-PART"]);if(i&&this.hls.config.lowLatencyMode){var u=Math.min(i.age-i.partTarget,i.targetduration);void 0!==o&&u>i.partTarget&&(o+=1)}if(Object(s.a)(a))return new H(a,Object(s.a)(o)?o:void 0,q.No)}}},i.loadPlaylist=function(t){},i.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},i.playlistLoaded=function(t,i,n){var r=this,e=i.details,s=i.stats,h=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(e.advancedDateTime=Date.now()-h,e.live||null!=n&&n.live){if(e.reloaded(n),n&&this.log("live playlist "+t+" "+(e.advanced?"REFRESHED "+e.lastPartSn+"-"+e.lastPartIndex:"MISSED")),n&&e.fragments.length>0&&nt(n,e),!this.canLoad||!e.live)return;var a,o=void 0,u=void 0;if(e.canBlockReload&&e.endSN&&e.advanced){var f=this.hls.config.lowLatencyMode,c=e.lastPartSn,l=e.endSN,v=e.lastPartIndex,d=c===l;-1!==v?(o=d?l+1:c,u=d?f?0:v:v+1):o=l+1;var p=e.age,m=p+e.ageHeader,b=Math.min(m-e.partTarget,1.5*e.targetduration);if(b>0){if(n&&b>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+b+" with playlist age: "+e.age),b=0;else{var g=Math.floor(b/e.targetduration);o+=g,void 0!==u&&(u+=Math.round(b%e.targetduration/e.partTarget)),this.log("CDN Tune-in age: "+e.ageHeader+"s last advanced "+p.toFixed(2)+"s goal: "+b+" skip sn "+g+" to part "+u)}e.tuneInGoal=b}if(a=this.getDeliveryDirectives(e,i.deliveryDirectives,o,u),f||!d)return void this.loadPlaylist(a)}else a=this.getDeliveryDirectives(e,i.deliveryDirectives,o,u);var y=function(t,i){var n,r=1e3*t.levelTargetDuration,e=r/2,s=t.age,h=s>0&&s<3*r,a=i.loading.end-i.loading.start,o=t.availabilityDelay;if(!1===t.updated)if(h){var u=333*t.misses;n=Math.max(Math.min(e,2*a),u),t.availabilityDelay=(t.availabilityDelay||0)+n}else n=e;else h?(o=Math.min(o||r/2,s),t.availabilityDelay=o,n=o+r-s):n=r-a;return Math.round(n)}(e,s);void 0!==o&&e.canBlockReload&&(y-=e.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(y)+" ms"),this.timer=self.setTimeout((function(){return r.loadPlaylist(a)}),y)}else this.clearTimer()},i.getDeliveryDirectives=function(t,i,n,r){var e=function(t,i){var n=t.canSkipUntil,r=t.canSkipDateRanges,e=t.endSN;return n&&(void 0!==i?i-e:0)<n?r?q.v2:q.Yes:q.No}(t,n);return null!=i&&i.skip&&t.deltaUpdateFailed&&(n=i.msn,r=i.part,e=q.No),new H(n,r,e)},i.retryLoadingOrFail=function(t){var i,n=this,r=this.hls.config,e=this.retryCount<r.levelLoadingMaxRetry;if(e)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(i=t.context)&&void 0!==i&&i.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return n.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return e},t}();function ht(){return(ht=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function at(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ot(t,i){return(ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var ut,ft=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),ct=function(t){var i,n;function r(i){var n;return(n=t.call(this,i,"[level-controller]")||this)._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,ot(i,n);var e,s,o,u=r.prototype;return u._registerListeners=function(){var t=this.hls;t.on(h.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(h.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(h.a.FRAG_LOADED,this.onFragLoaded,this),t.on(h.a.ERROR,this.onError,this)},u._unregisterListeners=function(){var t=this.hls;t.off(h.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(h.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(h.a.FRAG_LOADED,this.onFragLoaded,this),t.off(h.a.ERROR,this.onError,this)},u.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},u.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},u.onManifestLoaded=function(t,i){var n,r,e=[],s=[],o=[],u={},f=!1,c=!1,l=!1;if(i.levels.forEach((function(t){var i=t.attrs;f=f||!(!t.width||!t.height),c=c||!!t.videoCodec,l=l||!!t.audioCodec,ft&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var n=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(r=u[n])?r.url.push(t.url):(r=new Y(t),u[n]=r,e.push(r)),i&&(i.AUDIO&&Q(r,"audio",i.AUDIO),i.SUBTITLES&&Q(r,"text",i.SUBTITLES))})),(f||c)&&l&&(e=e.filter((function(t){var i=t.videoCodec,n=t.width,r=t.height;return!!i||!(!n||!r)}))),e=e.filter((function(t){var i=t.audioCodec,n=t.videoCodec;return(!i||k(i,"audio"))&&(!n||k(n,"video"))})),i.audioTracks&&Z(s=i.audioTracks.filter((function(t){return!t.audioCodec||k(t.audioCodec,"audio")}))),i.subtitles&&Z(o=i.subtitles),e.length>0){n=e[0].bitrate,e.sort((function(t,i){return t.bitrate-i.bitrate})),this._levels=e;for(var v=0;v<e.length;v++)if(e[v].bitrate===n){this._firstLevel=v,this.log("manifest loaded, "+e.length+" level(s) found, first bitrate: "+n);break}var d=l&&!c,p={levels:e,audioTracks:s,subtitleTracks:o,firstLevel:this._firstLevel,stats:i.stats,audio:l,video:c,altAudio:!d&&s.some((function(t){return!!t.url}))};this.hls.trigger(h.a.MANIFEST_PARSED,p),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})},u.onError=function(i,n){var r;if(t.prototype.onError.call(this,i,n),!n.fatal){var e=n.context,s=this._levels[this.currentLevelIndex];if(e&&(e.type===I.a.AUDIO_TRACK&&s.audioGroupIds&&e.groupId===s.audioGroupIds[s.urlId]||e.type===I.a.SUBTITLE_TRACK&&s.textGroupIds&&e.groupId===s.textGroupIds[s.urlId]))this.redundantFailover(this.currentLevelIndex);else{var h,o=!1,u=!0;switch(n.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:if(n.frag){var f=n.frag.type===I.b.MAIN?n.frag.level:this.currentLevelIndex,c=this._levels[f];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(h=f)):h=f}break;case a.a.LEVEL_LOAD_ERROR:case a.a.LEVEL_LOAD_TIMEOUT:e&&(e.deliveryDirectives&&(u=!1),h=e.level),o=!0;break;case a.a.REMUX_ALLOC_ERROR:h=null!=(r=n.level)?r:this.currentLevelIndex,o=!0}void 0!==h&&this.recoverLevel(n,h,o,u)}}},u.recoverLevel=function(t,i,n,r){var e=t.details,s=this._levels[i];if(s.loadError++,n){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(r){var h=s.url.length;if(h>1&&s.loadError<h)t.levelRetry=!0,this.redundantFailover(i);else if(-1===this.manualLevelIndex){for(var a=-1,o=this._levels,u=o.length;u--;){var f=(u+this.currentLevelIndex)%o.length;if(f!==this.currentLevelIndex&&0===o[f].loadError){a=f;break}}a>-1&&this.currentLevelIndex!==a&&(this.warn(e+": switch to "+a),t.levelRetry=!0,this.hls.nextAutoLevel=a)}}},u.redundantFailover=function(t){var i=this._levels[t],n=i.url.length;if(n>1){var r=(i.urlId+1)%n;this.warn("Switching to redundant URL-id "+r),this._levels.forEach((function(t){t.urlId=r})),this.level=t}},u.onFragLoaded=function(t,i){var n=i.frag;if(void 0!==n&&n.type===I.b.MAIN){var r=this._levels[n.level];void 0!==r&&(r.fragmentError=0,r.loadError=0)}},u.onLevelLoaded=function(t,i){var n,r,e=i.level,s=i.details,h=this._levels[e];if(!h)return this.warn("Invalid level index "+e),void(null!==(r=i.deliveryDirectives)&&void 0!==r&&r.skip&&(s.deltaUpdateFailed=!0));e===this.currentLevelIndex?(0===h.fragmentError&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(e,i,h.details)):null!==(n=i.deliveryDirectives)&&void 0!==n&&n.skip&&(s.deltaUpdateFailed=!0)},u.onAudioTrackSwitched=function(t,i){var n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,e=this.hls.audioTracks[i.id].groupId,s=0;s<n.audioGroupIds.length;s++)if(n.audioGroupIds[s]===e){r=s;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},u.loadPlaylist=function(t){var i=this.currentLevelIndex,n=this._levels[i];if(this.canLoad&&n&&n.url.length>0){var r=n.urlId,e=n.url[r];if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+i+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+r+" "+e),this.clearTimer(),this.hls.trigger(h.a.LEVEL_LOADING,{url:e,level:i,id:r,deliveryDirectives:t||null})}},u.removeLevel=function(t,i){var n=function(t,n){return n!==i},r=this._levels.filter((function(r,e){return e!==t||r.url.length>1&&void 0!==i&&(r.url=r.url.filter(n),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(n)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(n)),r.urlId=0,!0)})).map((function(t,i){var n=t.details;return null!=n&&n.fragments&&n.fragments.forEach((function(t){t.level=i})),t}));this._levels=r,this.hls.trigger(h.a.LEVELS_UPDATED,{levels:r})},e=r,(s=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var i,n=this._levels;if(0!==n.length&&(this.currentLevelIndex!==t||null===(i=n[t])||void 0===i||!i.details)){if(t<0||t>=n.length){var r=t<0;if(this.hls.trigger(h.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.LEVEL_SWITCH_ERROR,level:t,fatal:r,reason:"invalid level idx"}),r)return;t=Math.min(t,n.length-1)}this.clearTimer();var e=this.currentLevelIndex,s=n[e],o=n[t];this.log("switching to level "+t+" from "+e),this.currentLevelIndex=t;var u=ht({},o,{level:t,maxBitrate:o.maxBitrate,uri:o.uri,urlId:o.urlId});delete u._urlId,this.hls.trigger(h.a.LEVEL_SWITCHING,u);var f=o.details;if(!f||f.live){var c=this.switchParams(o.uri,null==s?void 0:s.details);this.loadPlaylist(c)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&at(e.prototype,s),Object.defineProperty(e,"prototype",{writable:!1}),r}(st);!function(t){t.NOT_LOADED="NOT_LOADED",t.APPENDING="APPENDING",t.PARTIAL="PARTIAL",t.OK="OK"}(ut||(ut={}));var lt=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var i=t.prototype;return i._registerListeners=function(){var t=this.hls;t.on(h.a.BUFFER_APPENDED,this.onBufferAppended,this),t.on(h.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(h.a.FRAG_LOADED,this.onFragLoaded,this)},i._unregisterListeners=function(){var t=this.hls;t.off(h.a.BUFFER_APPENDED,this.onBufferAppended,this),t.off(h.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(h.a.FRAG_LOADED,this.onFragLoaded,this)},i.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},i.getAppendedFrag=function(t,i){if(i===I.b.MAIN){var n=this.activeFragment,r=this.activeParts;if(!n)return null;if(r)for(var e=r.length;e--;){var s=r[e],h=s?s.end:n.appendedPTS;if(s.start<=t&&void 0!==h&&t<=h)return e>9&&(this.activeParts=r.slice(e-9)),s}else if(n.start<=t&&void 0!==n.appendedPTS&&t<=n.appendedPTS)return n}return this.getBufferedFrag(t,i)},i.getBufferedFrag=function(t,i){for(var n=this.fragments,r=Object.keys(n),e=r.length;e--;){var s=n[r[e]];if((null==s?void 0:s.body.type)===i&&s.buffered){var h=s.body;if(h.start<=t&&t<=h.end)return h}}return null},i.detectEvictedFragments=function(t,i,n){var r=this;Object.keys(this.fragments).forEach((function(e){var s=r.fragments[e];if(s)if(s.buffered){var h=s.range[t];h&&h.time.some((function(t){var n=!r.isTimeBuffered(t.startPTS,t.endPTS,i);return n&&r.removeFragment(s.body),n}))}else s.body.type===n&&r.removeFragment(s.body)}))},i.detectPartialFragments=function(t){var i=this,n=this.timeRanges,r=t.frag,e=t.part;if(n&&"initSegment"!==r.sn){var s=dt(r),h=this.fragments[s];h&&(Object.keys(n).forEach((function(t){var s=r.elementaryStreams[t];if(s){var a=n[t],o=null!==e||!0===s.partial;h.range[t]=i.getBufferedTimes(r,e,o,a)}})),h.loaded=null,Object.keys(h.range).length?h.buffered=!0:this.removeFragment(h.body))}},i.fragBuffered=function(t){var i=dt(t),n=this.fragments[i];n&&(n.loaded=null,n.buffered=!0)},i.getBufferedTimes=function(t,i,n,r){for(var e={time:[],partial:n},s=i?i.start:t.start,h=i?i.end:t.end,a=t.minEndPTS||h,o=t.maxStartPTS||s,u=0;u<r.length;u++){var f=r.start(u)-this.bufferPadding,c=r.end(u)+this.bufferPadding;if(o>=f&&a<=c){e.time.push({startPTS:Math.max(s,r.start(u)),endPTS:Math.min(h,r.end(u))});break}if(s<c&&h>f)e.partial=!0,e.time.push({startPTS:Math.max(s,r.start(u)),endPTS:Math.min(h,r.end(u))});else if(h<=f)break}return e},i.getPartialFragment=function(t){var i,n,r,e=null,s=0,h=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach((function(o){var u=a[o];u&&vt(u)&&(n=u.body.start-h,r=u.body.end+h,t>=n&&t<=r&&(i=Math.min(t-n,r-t),s<=i&&(e=u.body,s=i)))})),e},i.getState=function(t){var i=dt(t),n=this.fragments[i];return n?n.buffered?vt(n)?ut.PARTIAL:ut.OK:ut.APPENDING:ut.NOT_LOADED},i.isTimeBuffered=function(t,i,n){for(var r,e,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,e=n.end(s)+this.bufferPadding,t>=r&&i<=e)return!0;if(i<=r)return!1}return!1},i.onFragLoaded=function(t,i){var n=i.frag,r=i.part;if("initSegment"!==n.sn&&!n.bitrateTest&&!r){var e=dt(n);this.fragments[e]={body:n,loaded:i,buffered:!1,range:Object.create(null)}}},i.onBufferAppended=function(t,i){var n=this,r=i.frag,e=i.part,s=i.timeRanges;if(r.type===I.b.MAIN)if(this.activeFragment=r,e){var h=this.activeParts;h||(this.activeParts=h=[]),h.push(e)}else this.activeParts=null;this.timeRanges=s,Object.keys(s).forEach((function(t){var i=s[t];if(n.detectEvictedFragments(t,i),!e)for(var h=0;h<i.length;h++)r.appendedPTS=Math.max(i.end(h),r.appendedPTS||0)}))},i.onFragBuffered=function(t,i){this.detectPartialFragments(i)},i.hasFragment=function(t){var i=dt(t);return!!this.fragments[i]},i.removeFragmentsInRange=function(t,i,n){var r=this;Object.keys(this.fragments).forEach((function(e){var s=r.fragments[e];if(s&&s.buffered){var h=s.body;h.type===n&&h.start<i&&h.end>t&&r.removeFragment(h)}}))},i.removeFragment=function(t){var i=dt(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[i]},i.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function vt(t){var i,n;return t.buffered&&((null===(i=t.range.video)||void 0===i?void 0:i.partial)||(null===(n=t.range.audio)||void 0===n?void 0:n.partial))}function dt(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}var pt=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var i=t.prototype;return i.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.onHandlerDestroyed=function(){},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},i.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},i.doTick=function(){},t}(),mt={length:0,start:function(){return 0},end:function(){return 0}},bt=function(){function t(){}return t.isBuffered=function(i,n){try{if(i)for(var r=t.getBuffered(i),e=0;e<r.length;e++)if(n>=r.start(e)&&n<=r.end(e))return!0}catch(t){}return!1},t.bufferInfo=function(i,n,r){try{if(i){var e,s=t.getBuffered(i),h=[];for(e=0;e<s.length;e++)h.push({start:s.start(e),end:s.end(e)});return this.bufferedInfo(h,n,r)}}catch(t){}return{len:0,start:n,end:n,nextStart:void 0}},t.bufferedInfo=function(t,i,n){i=Math.max(0,i),t.sort((function(t,i){var n;return t.start-i.start||i.end-t.end}));var r=[];if(n)for(var e=0;e<t.length;e++){var s=r.length;if(s){var h=r[s-1].end;t[e].start-h<n?t[e].end>h&&(r[s-1].end=t[e].end):r.push(t[e])}else r.push(t[e])}else r=t;for(var a,o=0,u=i,f=i,c=0;c<r.length;c++){var l=r[c].start,v=r[c].end;if(i+n>=l&&i<v)u=l,o=(f=v)-i;else if(i+n<l){a=l;break}}return{len:o,start:u||0,end:f||0,nextStart:a}},t.getBuffered=function(t){try{return t.buffered}catch(t){return o.b.log("failed to get media.buffered",t),mt}},t}(),gt=function(t,i,n,r,e,s){void 0===r&&(r=0),void 0===e&&(e=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=i,this.id=n,this.size=r,this.part=e,this.partial=s};function yt(t,i){if(t){var n=t.start+i;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function wt(t,i){for(var n=i.fragments,r=0,e=n.length;r<e;r++)yt(n[r],t);i.fragmentHint&&yt(i.fragmentHint,t),i.alignedSliding=!0}function kt(t,i,n){i&&(function(t,i,n){if(function(t,i,n){return!(!i.details||!(n.endCC>n.startCC||t&&t.cc<n.startCC))}(t,n,i)){var r=function(t,i){var n=t.fragments,r=i.fragments;if(r.length&&n.length){var e=function(t,i){for(var n=null,r=0,e=t.length;r<e;r++){var s=t[r];if(s&&s.cc===i){n=s;break}}return n}(n,r[0].cc);if(e&&(!e||e.startPTS))return e;o.b.log("No frag in previous level to align on")}else o.b.log("No fragments to align")}(n.details,i);r&&Object(s.a)(r.start)&&(o.b.log("Adjusting PTS using last level due to CC increase within current level "+i.url),wt(r.start,i))}}(t,n,i),!n.alignedSliding&&i.details&&function(t,i){if(i.fragments.length&&t.hasProgramDateTime&&i.hasProgramDateTime){var n=i.fragments[0].programDateTime,r=t.fragments[0].programDateTime,e=(r-n)/1e3+i.fragments[0].start;e&&Object(s.a)(e)&&(o.b.log("Adjusting PTS using programDateTime delta "+(r-n)+"ms, sliding:"+e.toFixed(3)+" "+t.url+" "),wt(e,t))}}(n,i.details),n.alignedSliding||!i.details||n.skippedSegments||rt(i.details,n))}function Ot(t,i){var n=t.programDateTime;if(n){var r=(n-i)/1e3;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function Tt(t,i){if(i.fragments.length&&t.hasProgramDateTime&&i.hasProgramDateTime){var n=i.fragments[0].programDateTime-1e3*i.fragments[0].start;t.fragments.forEach((function(t){Ot(t,n)})),t.fragmentHint&&Ot(t.fragmentHint,n),t.alignedSliding=!0}}var Et=function(t,i){for(var n=0,r=t.length-1,e=null,s=null;n<=r;){var h=i(s=t[e=(n+r)/2|0]);if(h>0)n=e+1;else{if(!(h<0))return s;r=e-1}}return null};function St(t,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var e=null,s;return t?e=i[t.sn-i[0].sn+1]||null:0===n&&0===i[0].start&&(e=i[0]),e&&0===At(n,r,e)?e:Et(i,At.bind(null,n,r))||e}function At(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0);var r=Math.min(i,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function Mt(t,i,n){var r=1e3*Math.min(i,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>t}function jt(t){var i="function"==typeof Map?new Map:void 0;return(jt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return Dt(t,arguments,It(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Lt(r,t)})(t)}function Dt(t,i,n){return(Dt=xt()?Reflect.construct.bind():function(t,i,n){var r=[null];r.push.apply(r,i);var e=new(Function.bind.apply(t,r));return n&&Lt(e,n.prototype),e}).apply(null,arguments)}function xt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Lt(t,i){return(Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function It(t){return(It=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _t=Math.pow(2,17),Rt=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var i=t.prototype;return i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i.abort=function(){this.loader&&this.loader.abort()},i.load=function(t,i){var n=this,r=t.url;if(!r)return Promise.reject(new Nt({type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var e=this.config,s=e.fLoader,h=e.loader;return new Promise((function(r,o){n.loader&&n.loader.destroy();var u=n.loader=t.loader=s?new s(e):new h(e),f=Ct(t),c={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===t.sn?1/0:_t};t.stats=u.stats,u.load(f,c,{onSuccess:function(i,e,s,h){n.resetLoader(t,u),r({frag:t,part:null,payload:i.data,networkDetails:h})},onError:function(i,r,e){n.resetLoader(t,u),o(new Nt({type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:i,networkDetails:e}))},onAbort:function(i,r,e){n.resetLoader(t,u),o(new Nt({type:a.b.NETWORK_ERROR,details:a.a.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:e}))},onTimeout:function(i,r,e){n.resetLoader(t,u),o(new Nt({type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:e}))},onProgress:function(n,r,e,s){i&&i({frag:t,part:null,payload:e,networkDetails:s})}})}))},i.loadPart=function(t,i,n){var r=this;this.abort();var e=this.config,s=e.fLoader,h=e.loader;return new Promise((function(o,u){r.loader&&r.loader.destroy();var f=r.loader=t.loader=s?new s(e):new h(e),c=Ct(t,i),l={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:_t};i.stats=f.stats,f.load(c,l,{onSuccess:function(e,s,h,a){r.resetLoader(t,f),r.updateStatsFromPart(t,i);var u={frag:t,part:i,payload:e.data,networkDetails:a};n(u),o(u)},onError:function(n,e,s){r.resetLoader(t,f),u(new Nt({type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:i,response:n,networkDetails:s}))},onAbort:function(n,e,s){t.stats.aborted=i.stats.aborted,r.resetLoader(t,f),u(new Nt({type:a.b.NETWORK_ERROR,details:a.a.INTERNAL_ABORTED,fatal:!1,frag:t,part:i,networkDetails:s}))},onTimeout:function(n,e,s){r.resetLoader(t,f),u(new Nt({type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:i,networkDetails:s}))}})}))},i.updateStatsFromPart=function(t,i){var n=t.stats,r=i.stats,e=r.total;if(n.loaded+=r.loaded,e){var s=Math.round(t.duration/i.duration),h=Math.min(Math.round(n.loaded/e),s),a=(s-h)*Math.round(n.loaded/h);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);var o=n.loading,u=r.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end},i.resetLoader=function(t,i){t.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},t}();function Ct(t,i){void 0===i&&(i=null);var n=i||t,r={frag:t,part:i,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},e=n.byteRangeStartOffset,h=n.byteRangeEndOffset;return Object(s.a)(e)&&Object(s.a)(h)&&(r.rangeStart=e,r.rangeEnd=h),r}var Nt=function(t){var i,n;function r(i){for(var n,r=arguments.length,e=new Array(r>1?r-1:0),s=1;s<r;s++)e[s-1]=arguments[s];return(n=t.call.apply(t,[this].concat(e))||this).data=void 0,n.data=i,n}return n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,Lt(i,n),r}(jt(Error)),Pt=n(16),Ut=function(t){for(var i="",n=t.length,r=0;r<n;r++)i+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return i};function Ft(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $t(t,i){return($t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var Gt="STOPPED",Vt="IDLE",Xt="KEY_LOADING",Wt="FRAG_LOADING",qt="FRAG_LOADING_WAITING_RETRY",Kt="WAITING_TRACK",zt="PARSING",Ht="PARSED",Yt="ENDED",Jt="ERROR",Qt="WAITING_INIT_PTS",Zt="WAITING_LEVEL",ti=function(t){var i,n;function r(i,n,r){var e;return(e=t.call(this)||this).hls=void 0,e.fragPrevious=null,e.fragCurrent=null,e.fragmentTracker=void 0,e.transmuxer=null,e._state=Gt,e.media=null,e.mediaBuffer=null,e.config=void 0,e.bitrateTest=!1,e.lastCurrentTime=0,e.nextLoadPosition=0,e.startPosition=0,e.loadedmetadata=!1,e.fragLoadError=0,e.retryDate=0,e.levels=null,e.fragmentLoader=void 0,e.levelLastLoaded=null,e.startFragRequested=!1,e.decrypter=void 0,e.initPTS=[],e.onvseeking=null,e.onvended=null,e.logPrefix="",e.log=void 0,e.warn=void 0,e.logPrefix=r,e.log=o.b.log.bind(o.b,r+":"),e.warn=o.b.warn.bind(o.b,r+":"),e.hls=i,e.fragmentLoader=new Rt(i.config),e.fragmentTracker=n,e.config=i.config,e.decrypter=new Pt.a(i,i.config),i.on(h.a.KEY_LOADED,e.onKeyLoaded,Bt(e)),i.on(h.a.LEVEL_SWITCHING,e.onLevelSwitching,Bt(e)),e}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,$t(i,n);var e,f,c,l=r.prototype;return l.doTick=function(){this.onTickEnd()},l.onTickEnd=function(){},l.startLoad=function(t){},l.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Gt},l._streamEnded=function(t,i){var n=this.fragCurrent,r=this.fragmentTracker;if(!i.live&&n&&this.media&&n.sn>=i.endSN&&!t.nextStart){var e=i.partList;if(null!=e&&e.length){var s=e[e.length-1];return bt.isBuffered(this.media,s.start+s.duration/2)}var h=r.getState(n);return h===ut.PARTIAL||h===ut.OK}return!1},l.onMediaAttached=function(t,i){var n=this.media=this.mediaBuffer=i.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.state===Gt&&this.startLoad(r.startPosition)},l.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},l.onMediaSeeking=function(){var t=this.config,i=this.fragCurrent,n=this.media,r=this.mediaBuffer,e=this.state,h=n?n.currentTime:0,a=bt.bufferInfo(r||n,h,t.maxBufferHole);if(this.log("media seeking to "+(Object(s.a)(h)?h.toFixed(3):h)+", state: "+e),e===Yt)this.resetLoadingState();else if(i&&!a.len){var o=t.maxFragLookUpTolerance,u=i.start-o,f=h>i.start+i.duration+o;(h<u||f)&&(f&&i.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.loader.abort()),this.resetLoadingState())}n&&(this.lastCurrentTime=h),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=h),this.tickImmediate()},l.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},l.onKeyLoaded=function(t,i){if(this.state===Xt&&i.frag===this.fragCurrent&&this.levels){this.state=Vt;var n=this.levels[i.frag.level].details;n&&this.loadFragment(i.frag,n,i.frag.start)}},l.onLevelSwitching=function(t,i){this.fragLoadError=0},l.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},l.onHandlerDestroyed=function(){this.state=Gt,this.hls.off(h.a.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(h.a.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},l.loadKey=function(t,i){this.log("Loading key for "+t.sn+" of ["+i.startSN+"-"+i.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=Xt,this.fragCurrent=t,this.hls.trigger(h.a.KEY_LOADING,{frag:t})},l.loadFragment=function(t,i,n){this._loadFragForPlayback(t,i,n)},l._loadFragForPlayback=function(t,i,n){var r=this;this._doFragLoad(t,i,n,(function(i){if(r.fragContextChanged(t))return r.warn("Fragment "+t.sn+(i.part?" p: "+i.part.index:"")+" of level "+t.level+" was dropped during download."),void r.fragmentTracker.removeFragment(t);t.stats.chunkCount++,r._handleFragmentLoadProgress(i)})).then((function(i){if(i){r.fragLoadError=0;var n=r.state;r.fragContextChanged(t)?(n===Wt||!r.fragCurrent&&n===zt)&&(r.fragmentTracker.removeFragment(t),r.state=Vt):("payload"in i&&(r.log("Loaded fragment "+t.sn+" of level "+t.level),r.hls.trigger(h.a.FRAG_LOADED,i)),r._handleFragmentLoadComplete(i))}})).catch((function(i){r.state!==Gt&&r.state!==Jt&&(r.warn(i),r.resetFragmentLoading(t))}))},l.flushMainBuffer=function(t,i,n){if(void 0===n&&(n=null),t-i){var r={startOffset:t,endOffset:i,type:n};this.fragLoadError=0,this.hls.trigger(h.a.BUFFER_FLUSHING,r)}},l._loadInitSegment=function(t){var i=this;this._doFragLoad(t).then((function(n){if(!n||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return n})).then((function(n){var r=i.hls,e=n.payload,s=t.decryptdata;if(e&&e.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var a=self.performance.now();return i.decrypter.webCryptoDecrypt(new Uint8Array(e),s.key.buffer,s.iv.buffer).then((function(i){var e=self.performance.now();return r.trigger(h.a.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:a,tdecrypt:e}}),n.payload=i,n}))}return n})).then((function(n){var r=i.fragCurrent,e=i.hls,s=i.levels;if(!s)throw new Error("init load aborted, missing levels");s[t.level].details;var a=t.stats;i.state=Vt,i.fragLoadError=0,t.data=new Uint8Array(n.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),n.frag===r&&e.trigger(h.a.FRAG_BUFFERED,{stats:a,frag:r,part:null,id:t.type}),i.tick()})).catch((function(n){i.state!==Gt&&i.state!==Jt&&(i.warn(n),i.resetFragmentLoading(t))}))},l.fragContextChanged=function(t){var i=this.fragCurrent;return!t||!i||t.level!==i.level||t.sn!==i.sn||t.urlId!==i.urlId},l.fragBufferedComplete=function(t,i){var n=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(i?" part: "+i.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+(n?Ut(bt.getBuffered(n)):"(detached)")),this.state=Vt,n&&(!this.loadedmetadata&&n.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},l.seekToStartPos=function(){},l._handleFragmentLoadComplete=function(t){var i=this.transmuxer;if(i){var n=t.frag,r=t.part,e=t.partsLoaded,s=!e||0===e.length||e.some((function(t){return!t})),h=new gt(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!s);i.flush(h)}},l._handleFragmentLoadProgress=function(t){},l._doFragLoad=function(t,i,n,r){var e=this;if(void 0===n&&(n=null),!this.levels)throw new Error("frag load aborted, missing levels");if(n=Math.max(t.start,n||0),this.config.lowLatencyMode&&i){var a=i.partList;if(a&&r){n>t.end&&i.fragmentHint&&(t=i.fragmentHint);var o=this.getNextPart(a,t,n);if(o>-1){var u=a[o];return this.log("Loading part sn: "+t.sn+" p: "+u.index+" cc: "+t.cc+" of playlist ["+i.startSN+"-"+i.endSN+"] parts [0-"+o+"-"+(a.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=Wt,this.hls.trigger(h.a.FRAG_LOADING,{frag:t,part:a[o],targetBufferTime:n}),this.doFragPartsLoad(t,a,o,r).catch((function(t){return e.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(a,n))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(i?"of ["+i.startSN+"-"+i.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),Object(s.a)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=Wt,this.hls.trigger(h.a.FRAG_LOADING,{frag:t,targetBufferTime:n}),this.fragmentLoader.load(t,r).catch((function(t){return e.handleFragLoadError(t)}))},l.doFragPartsLoad=function(t,i,n,r){var e=this;return new Promise((function(s,a){var o=[];!function n(u){var f=i[u];e.fragmentLoader.loadPart(t,f,r).then((function(r){o[f.index]=r;var a=r.part;e.hls.trigger(h.a.FRAG_LOADED,r);var c=i[u+1];if(!c||c.fragment!==t)return s({frag:t,part:a,partsLoaded:o});n(u+1)})).catch(a)}(n)}))},l.handleFragLoadError=function(t){var i=t.data;return i&&i.details===a.a.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(h.a.ERROR,i),null},l._handleTransmuxerFlush=function(t){var i=this.getCurrentContext(t);if(i&&this.state===zt){var n=i.frag,r=i.part,e=i.level,s=self.performance.now();n.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(n,r,e,t.partial)}else this.fragCurrent||(this.state=Vt)},l.getCurrentContext=function(t){var i=this.levels,n=t.level,r=t.sn,e=t.part;if(!i||!i[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var s=i[n],h=e>-1?function(t,i,n){if(!t||!t.details)return null;var r=t.details.partList;if(r)for(var e=r.length;e--;){var s=r[e];if(s.index===n&&s.fragment.sn===i)return s}return null}(s,r,e):null,a=h?h.fragment:function(t,i,n){if(!t||!t.details)return null;var r=t.details,e=r.fragments[i-r.startSN];return e||((e=r.fragmentHint)&&e.sn===i?e:i<r.startSN&&n&&n.sn===i?n:null)}(s,r,this.fragCurrent);return a?{frag:a,part:h,level:s}:null},l.bufferFragmentData=function(t,i,n,r){if(t&&this.state===zt){var e=t.data1,s=t.data2,a=e;if(e&&s&&(a=Object(u.b)(e,s)),a&&a.length){var o={type:t.type,frag:i,part:n,chunkMeta:r,parent:i.type,data:a};this.hls.trigger(h.a.BUFFER_APPENDING,o),t.dropped&&t.independent&&!n&&this.flushBufferGap(i)}}},l.flushBufferGap=function(t){var i=this.media;if(i)if(bt.isBuffered(i,i.currentTime)){var n=i.currentTime,r=bt.bufferInfo(i,n,0),e=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*e),h=Math.max(Math.min(t.start-s,r.end-s),n+s);t.start-h>s&&this.flushMainBuffer(h,t.start)}else this.flushMainBuffer(0,t.start)},l.getFwdBufferInfo=function(t,i){var n=this.config,r=this.getLoadPosition();if(!Object(s.a)(r))return null;var e=bt.bufferInfo(t,r,n.maxBufferHole);if(0===e.len&&void 0!==e.nextStart){var h=this.fragmentTracker.getBufferedFrag(r,i);if(h&&e.nextStart<h.end)return bt.bufferInfo(t,r,Math.max(e.nextStart,n.maxBufferHole))}return e},l.getMaxBufferLength=function(t){var i,n=this.config;return i=t?Math.max(8*n.maxBufferSize/t,n.maxBufferLength):n.maxBufferLength,Math.min(i,n.maxMaxBufferLength)},l.reduceMaxBufferLength=function(t){var i=this.config,n=t||i.maxBufferLength;return i.maxMaxBufferLength>=n&&(i.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+i.maxMaxBufferLength+"s"),!0)},l.getNextFragment=function(t,i){var n=i.fragments,r=n.length;if(!r)return null;var e,s=this.config,h=n[0].start;if(i.live){var a=s.initialLiveManifestSize;if(r<a)return this.warn("Not enough fragments to start playback (have: "+r+", need: "+a+")"),null;i.PTSKnown||this.startFragRequested||-1!==this.startPosition||(e=this.getInitialLiveFragment(i,n),this.startPosition=e?this.hls.liveSyncPosition||e.start:t)}else t<=h&&(e=n[0]);if(!e){var o=s.lowLatencyMode?i.partEnd:i.fragmentEnd;e=this.getFragmentAtPosition(t,o,i)}return this.mapToInitFragWhenRequired(e)},l.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},l.getNextPart=function(t,i,n){for(var r=-1,e=!1,s=!0,h=0,a=t.length;h<a;h++){var o=t[h];if(s=s&&!o.independent,r>-1&&n<o.start)break;var u=o.loaded;!u&&(e||o.independent||s)&&o.fragment===i&&(r=h),e=u}return r},l.loadedEndOfParts=function(t,i){var n=t[t.length-1];return n&&i>n.start&&n.loaded},l.getInitialLiveFragment=function(t,i){var n=this.fragPrevious,r=null;if(n){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),r=function(t,i,n){if(null===i||!Array.isArray(t)||!t.length||!Object(s.a)(i))return null;if(i<(t[0].programDateTime||0))return null;if(i>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<t.length;++r){var e=t[r];if(Mt(i,n,e))return e}return null}(i,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){var e=n.sn+1;if(e>=t.startSN&&e<=t.endSN){var h=i[e-t.startSN];n.cc===h.cc&&(r=h,this.log("Live playlist, switching playlist, load frag with next SN: "+r.sn))}r||(r=function(t,i){return Et(t,(function(t){return t.cc<i?1:t.cc>i?-1:0}))}(i,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+r.sn)}}else{var a=this.hls.liveSyncPosition;null!==a&&(r=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r},l.getFragmentAtPosition=function(t,i,n){var r,e=this.config,s=this.fragPrevious,h=n.fragments,a=n.endSN,o=n.fragmentHint,u=e.maxFragLookUpTolerance,f=!!(e.lowLatencyMode&&n.partList&&o);if(f&&o&&!this.bitrateTest&&(h=h.concat(o),a=o.sn),r=t<i?St(s,h,t,t>i-u?0:u):h[h.length-1]){var c=r.sn-n.startSN;if(s&&r.sn===s.sn&&!f&&s&&r.level===s.level){var l=h[c+1];r.sn<a&&this.fragmentTracker.getState(l)!==ut.OK?(this.log("SN "+r.sn+" just loaded, load next one: "+l.sn),r=l):r=null}}return r},l.synchronizeToLiveEdge=function(t){var i=this.config,n=this.media;if(n){var r=this.hls.liveSyncPosition,e=n.currentTime,s=t.fragments[0].start,h=t.edge,a=e>=s-i.maxFragLookUpTolerance&&e<=h;if(null!==r&&n.duration>r&&(e<r||!a)){var o=void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*t.targetduration;(!a&&n.readyState<4||e<h-o)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn("Playback: "+e.toFixed(3)+" is located too far from the end of live sliding playlist: "+h+", reset currentTime to : "+r.toFixed(3)),n.currentTime=r))}}},l.alignPlaylists=function(t,i){var n=this.levels,r=this.levelLastLoaded,e=this.fragPrevious,h=null!==r?n[r]:null,a=t.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var o=t.fragments[0].start,u=!i,f=t.alignedSliding&&Object(s.a)(o);if(u||!f&&!o){kt(e,h,t);var c=t.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(i?i.startSN:"na")+"->"+t.startSN+" prev-sn: "+(e?e.sn:"na")+" fragments: "+a),c}return o},l.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},l.setStartPosition=function(t,i){var n=this.startPosition;if(n<i&&(n=-1),-1===n||-1===this.lastCurrentTime){var r=t.startTimeOffset;Object(s.a)(r)?(n=i+r,r<0&&(n+=t.totalduration),n=Math.min(Math.max(i,n),i+t.totalduration),this.log("Start time offset "+r+" found in playlist, adjust startPosition to "+n),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||i:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},l.getLoadPosition=function(){var t=this.media,i=0;return this.loadedmetadata&&t?i=t.currentTime:this.nextLoadPosition&&(i=this.nextLoadPosition),i},l.handleFragLoadAborted=function(t,i){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(i?" part"+i.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},l.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===qt)||(this.state=Vt)},l.onFragmentOrKeyLoadError=function(t,i){if(!i.fatal){var n=i.frag;if(n&&n.type===t){this.fragCurrent;var r=this.config;if(this.fragLoadError+1<=r.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var e=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" failed to load, retrying in "+e+"ms"),this.retryDate=self.performance.now()+e,this.fragLoadError++,this.state=qt}else i.levelRetry?(t===I.b.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Vt):(o.b.error(i.details+" reaches max retry, redispatch as fatal ..."),i.fatal=!0,this.hls.stopLoad(),this.state=Jt)}}},l.afterBufferFlushed=function(t,i,n){if(t){var r=bt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(i,r,n),this.state===Yt&&this.resetLoadingState()}},l.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=Vt},l.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var i=this.levels?this.levels[t].details:null;null!=i&&i.live?(this.startPosition=-1,this.setStartPosition(i,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},l.updateLevelTiming=function(t,i,n,r){var e=this,s=n.details;Object.keys(t.elementaryStreams).reduce((function(i,a){var o=t.elementaryStreams[a];if(o){var u=o.endPTS-o.startPTS;if(u<=0)return e.warn("Could not parse fragment "+t.sn+" "+a+" duration reliably ("+u+")"),i||!1;var f=r?0:it(s,t,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return e.hls.trigger(h.a.LEVEL_PTS_UPDATED,{details:s,level:n,drift:f,type:a,frag:t,start:o.startPTS,end:o.endPTS}),!0}return i}),!1)||(this.warn("Found no media in fragment "+t.sn+" of level "+n.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Ht,this.hls.trigger(h.a.FRAG_PARSED,{frag:t,part:i})},l.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e=r,(f=[{key:"state",get:function(){return this._state},set:function(t){var i=this._state;i!==t&&(this._state=t,this.log(i+"->"+t))}}])&&Ft(e.prototype,f),Object.defineProperty(e,"prototype",{writable:!1}),r}(pt);function ii(){return self.MediaSource||self.WebKitMediaSource}function ni(){return self.SourceBuffer||self.WebKitSourceBuffer}var ri=n(18),ei=n(10),si=n(15),hi=ii()||{isTypeSupported:function(){return!1}},ai=function(){function t(t,i,n,r){var e=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=i,this.onTransmuxComplete=n,this.onFlush=r;var s=t.config,u=function(i,n){(n=n||{}).frag=e.frag,n.id=e.id,t.trigger(i,n)};this.observer=new si.EventEmitter,this.observer.on(h.a.FRAG_DECRYPTED,u),this.observer.on(h.a.ERROR,u);var f={mp4:hi.isTypeSupported("video/mp4"),mpeg:hi.isTypeSupported("audio/mpeg"),mp3:hi.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){var l;o.b.log("demuxing in webworker");try{l=this.worker=ri(19),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(i){t.trigger(h.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(i.message+"  ("+i.filename+":"+i.lineno+")")})},l.postMessage({cmd:"init",typeSupported:f,vendor:c,id:i,config:JSON.stringify(s)})}catch(t){o.b.warn("Error in worker:",t),o.b.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new ei.c(this.observer,f,s,c,i),this.worker=null}}else this.transmuxer=new ei.c(this.observer,f,s,c,i)}var i=t.prototype;return i.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0;else{var i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},i.push=function(t,i,n,r,e,s,h,a,u,f){var c,l,v=this;u.transmuxing.start=self.performance.now();var d=this.transmuxer,p=this.worker,m=s?s.start:e.start,b=e.decryptdata,g=this.frag,y=!(g&&e.cc===g.cc),w=!(g&&u.level===g.level),k=g?u.sn-g.sn:-1,O=this.part?u.part-this.part.index:-1,T=0===k&&u.id>1&&u.id===(null==g?void 0:g.stats.chunkCount),E=!w&&(1===k||0===k&&(1===O||T&&O<=0)),S=self.performance.now();(w||k||0===e.stats.parsing.start)&&(e.stats.parsing.start=S),!s||!O&&E||(s.stats.parsing.start=S);var A=!(g&&(null===(c=e.initSegment)||void 0===c?void 0:c.url)===(null===(l=g.initSegment)||void 0===l?void 0:l.url)),M=new ei.b(y,E,a,w,m,A);if(!E||y||A){o.b.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+y+"\n        trackSwitch: "+w+"\n        contiguous: "+E+"\n        accurateTimeOffset: "+a+"\n        timeOffset: "+m+"\n        initSegmentChange: "+A);var j=new ei.a(n,r,i,h,f);this.configureTransmuxer(j)}if(this.frag=e,this.part=s,p)p.postMessage({cmd:"demux",data:t,decryptdata:b,chunkMeta:u,state:M},t instanceof ArrayBuffer?[t]:[]);else if(d){var D=d.push(t,b,u,M);Object(ei.d)(D)?D.then((function(t){v.handleTransmuxComplete(t)})):this.handleTransmuxComplete(D)}},i.flush=function(t){var i=this;t.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:t});else if(n){var e=n.flush(t);Object(ei.d)(e)?e.then((function(n){i.handleFlushResult(n,t)})):this.handleFlushResult(e,t)}},i.handleFlushResult=function(t,i){var n=this;t.forEach((function(t){n.handleTransmuxComplete(t)})),this.onFlush(i)},i.onWorkerMessage=function(t){var i=t.data,n=this.hls;switch(i.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(i.data);break;case"flush":this.onFlush(i.data);break;case"workerLog":o.b[i.data.logType]&&o.b[i.data.logType](i.data.message);break;default:i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,n.trigger(i.event,i.data)}},i.configureTransmuxer=function(t){var i=this.worker,n=this.transmuxer;i?i.postMessage({cmd:"configure",config:t}):n&&n.configure(t)},i.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}(),oi=function(){function t(t,i,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=i,this.fragmentTracker=n,this.hls=r}var i=t.prototype;return i.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},i.poll=function(t,i){var n=this.config,r=this.media,e=this.stalled;if(null!==r){var s=r.currentTime,h=r.seeking,a=this.seeking&&!h,u=!this.seeking&&h;if(this.seeking=h,s===t){if((u||a)&&(this.stalled=null),!(r.paused&&!h||r.ended||0===r.playbackRate)&&bt.getBuffered(r).length){var f=bt.bufferInfo(r,s,0),c=f.len>0,l=f.nextStart||0;if(c||l){if(h){var v=f.len>2,d=!l||i&&i.start<=s||l-s>2&&!this.fragmentTracker.getPartialFragment(s);if(v||d)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var p,m=Math.max(l,f.start||0)-s,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,g=(null==b||null===(p=b.details)||void 0===p?void 0:p.live)?2*b.details.targetduration:2;if(m>0&&m<=g)return void this._trySkipBufferHole(null)}var y=self.performance.now();if(null!==e){var w=y-e;if(h||!(w>=250)||(this._reportStall(f),this.media)){var k=bt.bufferInfo(r,s,n.maxBufferHole);this._tryFixBufferStall(k,w)}}else this.stalled=y}}}else if(this.moved=!0,null!==e){if(this.stallReported){var O=self.performance.now()-e;o.b.warn("playback not stuck anymore @"+s+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},i._tryFixBufferStall=function(t,i){var n=this.config,r=this.fragmentTracker,e=this.media;if(null!==e){var s=e.currentTime,h=r.getPartialFragment(s);if(h&&(this._trySkipBufferHole(h)||!this.media))return;t.len>n.maxBufferHole&&i>1e3*n.highBufferWatchdogPeriod&&(o.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},i._reportStall=function(t){var i=this.hls,n=this.media;!this.stallReported&&n&&(this.stallReported=!0,o.b.warn("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),i.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t.len}))},i._trySkipBufferHole=function(t){var i=this.config,n=this.hls,r=this.media;if(null===r)return 0;for(var e=r.currentTime,s=0,u=bt.getBuffered(r),f=0;f<u.length;f++){var c=u.start(f);if(e+i.maxBufferHole>=s&&e<c){var l=Math.max(c+.05,r.currentTime+.1);return o.b.warn("skipping hole, adjusting currentTime from "+e+" to "+l),this.moved=!0,this.stalled=null,r.currentTime=l,t&&n.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+l,frag:t}),l}s=u.end(f)}return 0},i._tryNudgeBuffer=function(){var t=this.config,i=this.hls,n=this.media,r=this.nudgeRetry;if(null!==n){var e=n.currentTime;if(this.nudgeRetry++,r<t.nudgeMaxRetry){var s=e+(r+1)*t.nudgeOffset;o.b.warn("Nudging 'currentTime' from "+e+" to "+s),n.currentTime=s,i.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else o.b.error("Playhead still not moving while enough data buffered @"+e+" after "+t.nudgeMaxRetry+" nudges"),i.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!0})}},t}();function ui(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function fi(t,i){return(fi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var ci=function(t){var i,n;function r(i,n){var r;return(r=t.call(this,i,n,"[stream-controller]")||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,fi(i,n);var e,o,u,f=r.prototype;return f._registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(h.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(h.a.ERROR,this.onError,this),t.on(h.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(h.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(h.a.BUFFER_CREATED,this.onBufferCreated,this),t.on(h.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(h.a.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(h.a.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(h.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(h.a.ERROR,this.onError,this),t.off(h.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(h.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(h.a.BUFFER_CREATED,this.onBufferCreated,this),t.off(h.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(h.a.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(h.a.FRAG_BUFFERED,this.onFragBuffered,this)},f.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},f.startLoad=function(t){if(this.levels){var i=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}i>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i),this.state=Vt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=Gt},f.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},f.doTick=function(){switch(this.state){case Vt:this.doTickIdle();break;case Zt:var t,i=this.levels,n=this.level,r=null==i||null===(t=i[n])||void 0===t?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=Vt;break}break;case qt:var e,s=self.performance.now(),h=this.retryDate;(!h||s>=h||null!==(e=this.media)&&void 0!==e&&e.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=Vt)}this.onTickEnd()},f.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},f.doTickIdle=function(){var t,i,n=this.hls,r=this.levelLastLoaded,e=this.levels,s=this.media,a=n.config,o=n.nextLoadLevel;if(null!==r&&(s||!this.startFragRequested&&a.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&e&&e[o]){var u=e[o];this.level=n.nextLoadLevel=o;var f=u.details;if(!f||this.state===Zt||f.live&&this.levelLastLoaded!==o)this.state=Zt;else{var c=this.getMainFwdBufferInfo();if(null!==c&&!(c.len>=this.getMaxBufferLength(u.maxBitrate))){if(this._streamEnded(c,f)){var l={};return this.altAudio&&(l.type="video"),this.hls.trigger(h.a.BUFFER_EOS,l),void(this.state=Yt)}this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);var v=this.backtrackFragment?this.backtrackFragment.start:c.end,d=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&d&&"initSegment"!==d.sn&&this.fragmentTracker.getState(d)!==ut.OK){var p,b=(null!=(p=this.backtrackFragment)?p:d).sn-f.startSN,g=f.fragments[b-1];g&&d.cc===g.cc&&(d=g,this.fragmentTracker.removeFragment(g))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(d&&this.fragmentTracker.getState(d)===ut.OK&&this.nextLoadPosition>v){var y=this.audioOnly&&!this.altAudio?m.a.AUDIO:m.a.VIDEO;s&&this.afterBufferFlushed(s,y,I.b.MAIN),d=this.getNextFragment(this.nextLoadPosition,f)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),"identity"!==(null===(t=d.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(i=d.decryptdata)&&void 0!==i&&i.key?this.loadFragment(d,f,v):this.loadKey(d,f))}}}},f.loadFragment=function(i,n,r){var e,s=this.fragmentTracker.getState(i);this.fragCurrent=i,s===ut.NOT_LOADED?"initSegment"===i.sn?this._loadInitSegment(i):this.bitrateTest?(this.log("Fragment "+i.sn+" of level "+i.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(i)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,i,n,r)):s===ut.APPENDING?this.reduceMaxBufferLength(i.duration)&&this.fragmentTracker.removeFragment(i):0===(null===(e=this.media)||void 0===e?void 0:e.buffered.length)&&this.fragmentTracker.removeAllFragments()},f.getAppendedFrag=function(t){var i=this.fragmentTracker.getAppendedFrag(t,I.b.MAIN);return i&&"fragment"in i?i.fragment:i},f.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,I.b.MAIN)},f.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},f.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},f.nextLevelSwitch=function(){var t=this.levels,i=this.media;if(null!=i&&i.readyState){var n,r=this.getAppendedFrag(i.currentTime);if(r&&r.start>1&&this.flushMainBuffer(0,r.start-1),!i.paused&&t){var e=t[this.hls.nextLoadLevel],s=this.fragLastKbps;n=s&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*s)+1:0}else n=0;var h=this.getBufferedFrag(i.currentTime+n);if(h){var a=this.followingBufferedFrag(h);if(a){this.abortCurrentFrag();var o=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,f=Math.max(h.end,o+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,.5*u),.75*u));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}},f.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,null!=t&&t.loader&&t.loader.abort(),this.state){case Xt:case Wt:case qt:case zt:case Ht:this.state=Vt}this.nextLoadPosition=this.getLoadPosition()},f.flushMainBuffer=function(i,n){t.prototype.flushMainBuffer.call(this,i,n,this.altAudio?"video":null)},f.onMediaAttached=function(i,n){t.prototype.onMediaAttached.call(this,i,n);var r=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new oi(this.config,r,this.fragmentTracker,this.hls)},f.onMediaDetaching=function(){var i=this.media;i&&this.onvplaying&&this.onvseeked&&(i.removeEventListener("playing",this.onvplaying),i.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},f.onMediaPlaying=function(){this.tick()},f.onMediaSeeked=function(){var t=this.media,i=t?t.currentTime:null;Object(s.a)(i)&&this.log("Media seeked to "+i.toFixed(3)),this.tick()},f.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(h.a.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},f.onManifestParsed=function(t,i){var n,r,e,s=!1,h=!1;i.levels.forEach((function(t){(n=t.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(s=!0),-1!==n.indexOf("mp4a.40.5")&&(h=!0))})),this.audioCodecSwitch=s&&h&&!("function"==typeof(null==(e=ni())||null===(r=e.prototype)||void 0===r?void 0:r.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},f.onLevelLoading=function(t,i){var n=this.levels;if(n&&this.state===Vt){var r=n[i.level];(!r.details||r.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(r.details))&&(this.state=Zt)}},f.onLevelLoaded=function(t,i){var n,r=this.levels,e=i.level,s=i.details,a=s.totalduration;if(r){this.log("Level "+e+" loaded ["+s.startSN+","+s.endSN+"], cc ["+s.startCC+", "+s.endCC+"] duration:"+a);var o=this.fragCurrent;!o||this.state!==Wt&&this.state!==qt||o.level!==i.level&&o.loader&&(this.state=Vt,this.backtrackFragment=null,o.loader.abort());var u=r[e],f=0;if(s.live||null!==(n=u.details)&&void 0!==n&&n.live){if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed)return;f=this.alignPlaylists(s,u.details)}if(u.details=s,this.levelLastLoaded=e,this.hls.trigger(h.a.LEVEL_UPDATED,{details:s,level:e}),this.state===Zt){if(this.waitForCdnTuneIn(s))return;this.state=Vt}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,f),this.tick()}else this.warn("Levels were reset while loading level "+e)},f._handleFragmentLoadProgress=function(t){var i,n=t.frag,r=t.part,e=t.payload,s=this.levels;if(s){var h=s[n.level],a=h.details;if(a){var o=h.videoCodec,u=a.PTSKnown||!a.live,f=null===(i=n.initSegment)||void 0===i?void 0:i.data,c=this._getAudioCodec(h),l=this.transmuxer=this.transmuxer||new ai(this.hls,I.b.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=r?r.index:-1,d=-1!==v,p=new gt(n.level,n.sn,n.stats.chunkCount,e.byteLength,v,d),m=this.initPTS[n.cc];l.push(e,f,c,o,n,r,a.totalduration,u,p,m)}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},f.onAudioTrackSwitching=function(t,i){var n=this.altAudio,r=!!i.url,e=i.id;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;null!=s&&s.loader&&(this.log("Switching to main audio track, cancel main fragment load"),s.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;n&&a.trigger(h.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:e})}},f.onAudioTrackSwitched=function(t,i){var n=i.id,r=!!this.hls.audioTracks[n].url;if(r){var e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r,this.tick()},f.onBufferCreated=function(t,i){var n,r,e=i.tracks,s=!1;for(var h in e){var a=e[h];if("main"===a.id){if(r=h,n=a,"video"===h){var o=e[h];o&&(this.videoBuffer=o.buffer)}}else s=!0}s&&n?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},f.onFragBuffered=function(t,i){var n=i.frag,r=i.part;if(!n||n.type===I.b.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Ht&&(this.state=Vt));var e=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}},f.onError=function(t,i){switch(i.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.b.MAIN,i);break;case a.a.LEVEL_LOAD_ERROR:case a.a.LEVEL_LOAD_TIMEOUT:this.state!==Jt&&(i.fatal?(this.warn(""+i.details),this.state=Jt):i.levelRetry||this.state!==Zt||(this.state=Vt));break;case a.a.BUFFER_FULL_ERROR:if("main"===i.parent&&(this.state===zt||this.state===Ht)){var n=!0,r=this.getFwdBufferInfo(this.media,I.b.MAIN);r&&r.len>.5&&(n=!this.reduceMaxBufferLength(r.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},f.checkBuffer=function(){var t=this.media,i=this.gapController;if(t&&i&&t.readyState){if(this.loadedmetadata||!bt.getBuffered(t).length){var n=this.state!==Vt?this.fragCurrent:null;i.poll(this.lastCurrentTime,n)}this.lastCurrentTime=t.currentTime}},f.onFragLoadEmergencyAborted=function(){this.state=Vt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},f.onBufferFlushed=function(t,i){var n=i.type;if(n!==m.a.AUDIO||this.audioOnly&&!this.altAudio){var r=(n===m.a.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,n,I.b.MAIN)}},f.onLevelsUpdated=function(t,i){this.levels=i.levels},f.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},f.seekToStartPos=function(){var t=this.media;if(t){var i=t.currentTime,n=this.startPosition;if(n>=0&&i<n){if(t.seeking)return void this.log("could not seek to "+n+", already seeking at "+i);var r=bt.getBuffered(t),e=(r.length?r.start(0):0)-n;e>0&&(e<this.config.maxBufferHole||e<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+e+" to match buffer start"),n+=e,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+i),t.currentTime=n}}},f._getAudioCodec=function(t){var i=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),i},f._loadBitrateTestFrag=function(t){var i=this;t.bitrateTest=!0,this._doFragLoad(t).then((function(n){var r=i.hls;if(n&&!r.nextLoadLevel&&!i.fragContextChanged(t)){i.fragLoadError=0,i.state=Vt,i.startFragRequested=!1,i.bitrateTest=!1;var e=t.stats;e.parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),r.trigger(h.a.FRAG_LOADED,n),t.bitrateTest=!1}}))},f._handleTransmuxComplete=function(t){var i,n="main",r=this.hls,e=t.remuxResult,a=t.chunkMeta,o=this.getCurrentContext(a);if(!o)return this.warn("The loading context changed while buffering fragment "+a.sn+" of level "+a.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(a.level);var u=o.frag,f=o.part,c=o.level,l=e.video,v=e.text,d=e.id3,p=e.initSegment,b=c.details,g=this.altAudio?void 0:e.audio;if(!this.fragContextChanged(u)){if(this.state=zt,p){p.tracks&&(this._bufferInitSegment(c,p.tracks,u,a),r.trigger(h.a.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:n,tracks:p.tracks}));var y=p.initPTS,w=p.timescale;Object(s.a)(y)&&(this.initPTS[u.cc]=y,r.trigger(h.a.INIT_PTS_FOUND,{frag:u,id:n,initPTS:y,timescale:w}))}if(l&&!1!==e.independent){if(b){var k=l.startPTS,O=l.endPTS,T=l.startDTS,E=l.endDTS;if(f)f.elementaryStreams[l.type]={startPTS:k,endPTS:O,startDTS:T,endDTS:E};else if(l.firstKeyFrame&&l.independent&&(this.couldBacktrack=!0),l.dropped&&l.independent){var S=this.getMainFwdBufferInfo();if((S?S.end:this.getLoadPosition())+this.config.maxBufferHole<(l.firstKeyFramePTS?l.firstKeyFramePTS:k)-this.config.maxBufferHole)return void this.backtrack(u);u.setElementaryStreamInfo(l.type,u.start,O,u.start,E,!0)}u.setElementaryStreamInfo(l.type,k,O,T,E),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(l,u,f,a)}}else if(!1===e.independent)return void this.backtrack(u);if(g){var A=g.startPTS,M=g.endPTS,j=g.startDTS,D=g.endDTS;f&&(f.elementaryStreams[m.a.AUDIO]={startPTS:A,endPTS:M,startDTS:j,endDTS:D}),u.setElementaryStreamInfo(m.a.AUDIO,A,M,j,D),this.bufferFragmentData(g,u,f,a)}if(b&&null!=d&&null!==(i=d.samples)&&void 0!==i&&i.length){var x={id:n,frag:u,details:b,samples:d.samples};r.trigger(h.a.FRAG_PARSING_METADATA,x)}if(b&&v){var L={id:n,frag:u,details:b,samples:v.samples};r.trigger(h.a.FRAG_PARSING_USERDATA,L)}}},f._bufferInitSegment=function(t,i,n,r){var e=this;if(this.state===zt){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var s=i.audio,a=i.video,o=i.audiovideo;if(s){var u=t.audioCodec,f=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===f.indexOf("firefox")&&(u="mp4a.40.5")),-1!==f.indexOf("android")&&"audio/mpeg"!==s.container&&(u="mp4a.40.2",this.log("Android: force audio codec to "+u)),t.audioCodec&&t.audioCodec!==u&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+u+'"'),s.levelCodec=u,s.id="main",this.log("Init audio buffer, container:"+s.container+", codecs[selected/level/parsed]=["+(u||"")+"/"+(t.audioCodec||"")+"/"+s.codec+"]")}a&&(a.levelCodec=t.videoCodec,a.id="main",this.log("Init video buffer, container:"+a.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+a.codec+"]")),o&&this.log("Init audiovideo buffer, container:"+o.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+o.codec+"]"),this.hls.trigger(h.a.BUFFER_CODECS,i),Object.keys(i).forEach((function(t){var s=i[t].initSegment;null!=s&&s.byteLength&&e.hls.trigger(h.a.BUFFER_APPENDING,{type:t,data:s,frag:n,part:null,chunkMeta:r,parent:n.type})})),this.tick()}},f.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,I.b.MAIN)},f.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Vt},f.checkFragmentChanged=function(){var t=this.media,i=null;if(t&&t.readyState>1&&!1===t.seeking){var n=t.currentTime;if(bt.isBuffered(t,n)?i=this.getAppendedFrag(n):bt.isBuffered(t,n+.1)&&(i=this.getAppendedFrag(n+.1)),i){this.backtrackFragment=null;var r=this.fragPlaying,e=i.level;r&&i.sn===r.sn&&r.level===e&&i.urlId===r.urlId||(this.hls.trigger(h.a.FRAG_CHANGED,{frag:i}),r&&r.level===e||this.hls.trigger(h.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=i)}}},e=r,(o=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var i=t.currentTime,n=this.currentFrag;if(n&&Object(s.a)(i)&&Object(s.a)(n.programDateTime)){var r=n.programDateTime+1e3*(i-n.start);return new Date(r)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&ui(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),r}(ti),li=function(){function t(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=i,this.totalWeight_=n}var i=t.prototype;return i.sample=function(t,i){var n=Math.pow(this.alpha_,t);this.estimate_=i*(1-n)+n*this.estimate_,this.totalWeight_+=t},i.getTotalWeight=function(){return this.totalWeight_},i.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}(),vi=function(){function t(t,i,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new li(t),this.fast_=new li(i)}var i=t.prototype;return i.update=function(t,i){var n=this.slow_,r=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new li(t,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==i&&(this.fast_=new li(i,r.getEstimate(),r.getTotalWeight()))},i.sample=function(t,i){var n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*i/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},i.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},i.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},i.destroy=function(){},t}();function di(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pi=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var i=t.config;this.bwEstimator=new vi(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var i,n,r,e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(h.a.FRAG_LOADING,this.onFragLoading,this),t.on(h.a.FRAG_LOADED,this.onFragLoaded,this),t.on(h.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(h.a.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(h.a.FRAG_LOADING,this.onFragLoading,this),t.off(h.a.FRAG_LOADED,this.onFragLoaded,this),t.off(h.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(h.a.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},e.onFragLoading=function(t,i){var n,r=i.frag;r.type===I.b.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(n=i.part)?n:null,this.timer=self.setInterval(this.onCheck,100)))},e.onLevelLoaded=function(t,i){var n=this.hls.config;i.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},e._abandonRulesCheck=function(){var t=this.fragCurrent,i=this.partCurrent,n=this.hls,r=n.autoLevelEnabled,e=n.config,a=n.media;if(t&&a){var u=i?i.stats:t.stats,f=i?i.duration:t.duration;if(u.aborted)return o.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!a.paused&&a.playbackRate&&a.readyState){var c=performance.now()-u.loading.start,l=Math.abs(a.playbackRate);if(!(c<=500*f/l)){var v=n.levels,d=n.minAutoLevel,p=v[t.level],m=u.total||Math.max(u.loaded,Math.round(f*p.maxBitrate/8)),b=Math.max(1,u.bwEstimate?u.bwEstimate/8:1e3*u.loaded/c),g=(m-u.loaded)/b,y=a.currentTime,w=(bt.bufferInfo(a,y,e.maxBufferHole).end-y)/l;if(!(w>=2*f/l||g<=w)){var k,O=Number.POSITIVE_INFINITY;for(k=t.level-1;k>d&&!((O=f*v[k].maxBitrate/(6.4*b))<w);k--);if(!(O>=g)){var T=this.bwEstimator.getEstimate();o.b.warn("Fragment "+t.sn+(i?" part "+i.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+k+"\n      Current BW estimate: "+(Object(s.a)(T)?(T/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+g.toFixed(3)+" s\n      Estimated load time for the next fragment: "+O.toFixed(3)+" s\n      Time to underbuffer: "+w.toFixed(3)+" s"),n.nextLoadLevel=k,this.bwEstimator.sample(c,u.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),n.trigger(h.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:u})}}}}}},e.onFragLoaded=function(t,i){var n=i.frag,r=i.part;if(n.type===I.b.MAIN&&Object(s.a)(n.sn)){var e=r?r.stats:n.stats,a=r?r.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[n.level],u=(o.loaded?o.loaded.bytes:0)+e.loaded,f=(o.loaded?o.loaded.duration:0)+a;o.loaded={bytes:u,duration:f},o.realBitrate=Math.round(8*u/f)}if(n.bitrateTest){var c={stats:e,frag:n,part:r,id:n.type};this.onFragBuffered(h.a.FRAG_BUFFERED,c)}}},e.onFragBuffered=function(t,i){var n=i.frag,r=i.part,e=r?r.stats:n.stats;if(!e.aborted&&n.type===I.b.MAIN&&"initSegment"!==n.sn){var s=e.parsing.end-e.loading.start;this.bwEstimator.sample(s,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},e.onError=function(t,i){switch(i.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},e.getNextABRAutoLevel=function(){var t=this.fragCurrent,i=this.partCurrent,n=this.hls,r=n.maxAutoLevel,e=n.config,s=n.minAutoLevel,h=n.media,a=i?i.duration:t?t.duration:0,u=h?h.currentTime:0,f=h&&0!==h.playbackRate?Math.abs(h.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,l=(bt.bufferInfo(h,u,e.maxBufferHole).end-u)/f,v=this.findBestLevel(c,s,r,l,e.abrBandWidthFactor,e.abrBandWidthUpFactor);if(v>=0)return v;o.b.trace((l?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=a?Math.min(a,e.maxStarvationDelay):e.maxStarvationDelay,p=e.abrBandWidthFactor,m=e.abrBandWidthUpFactor;if(!l){var b=this.bitrateTestDelay;b&&(d=(a?Math.min(a,e.maxLoadingDelay):e.maxLoadingDelay)-b,o.b.trace("bitrate test took "+Math.round(1e3*b)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),p=m=1)}return v=this.findBestLevel(c,s,r,l+d,p,m),Math.max(v,0)},e.findBestLevel=function(t,i,n,r,e,s){for(var h,a=this.fragCurrent,u=this.partCurrent,f=this.lastLoadedFragLevel,c=this.hls.levels,l=c[f],v=!(null==l||null===(h=l.details)||void 0===h||!h.live),d=null==l?void 0:l.codecSet,p=u?u.duration:a?a.duration:0,m=n;m>=i;m--){var b=c[m];if(b&&(!d||b.codecSet===d)){var g=b.details,y=(u?null==g?void 0:g.partTarget:null==g?void 0:g.averagetargetduration)||p,w=void 0;w=m<=f?e*t:s*t;var k=c[m].maxBitrate,O=k*y/w;if(o.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(w)+"/"+k+"/"+y+"/"+r+"/"+O),w>k&&(!O||v&&!this.bitrateTestDelay||O<r))return m}}return-1},i=t,(n=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,i=this.bwEstimator;if(-1!==t&&!i.canEstimate())return t;var n=this.getNextABRAutoLevel();return-1!==t&&this.hls.levels[n].loadError?t:(-1!==t&&(n=Math.min(t,n)),n)},set:function(t){this._nextAutoLevel=t}}])&&di(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(),mi=function(){function t(){this.chunks=[],this.dataLength=0}var i=t.prototype;return i.push=function(t){this.chunks.push(t),this.dataLength+=t.length},i.flush=function(){var t,i=this.chunks,n=this.dataLength;return i.length?(t=1===i.length?i[0]:function(t,i){for(var n=new Uint8Array(i),r=0,e=0;e<t.length;e++){var s=t[e];n.set(s,r),r+=s.length}return n}(i,n),this.reset(),t):new Uint8Array(0)},i.reset=function(){this.chunks.length=0,this.dataLength=0},t}();function bi(){return(bi=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function gi(t,i){return(gi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var yi=function(t){var i,n;function r(i,n){var r;return(r=t.call(this,i,n,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,gi(i,n);var e=r.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(h.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(h.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(h.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(h.a.ERROR,this.onError,this),t.on(h.a.BUFFER_RESET,this.onBufferReset,this),t.on(h.a.BUFFER_CREATED,this.onBufferCreated,this),t.on(h.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(h.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(h.a.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(h.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(h.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(h.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(h.a.ERROR,this.onError,this),t.off(h.a.BUFFER_RESET,this.onBufferReset,this),t.off(h.a.BUFFER_CREATED,this.onBufferCreated,this),t.off(h.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(h.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(h.a.FRAG_BUFFERED,this.onFragBuffered,this)},e.onInitPtsFound=function(t,i){var n=i.frag,r=i.id,e=i.initPTS;if("main"===r){var s=n.cc;this.initPTS[n.cc]=e,this.log("InitPTS for cc: "+s+" found from main: "+e),this.videoTrackCC=s,this.state===Qt&&this.tick()}},e.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=Gt);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i,this.state=Vt):(this.loadedmetadata=!1,this.state=Kt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.doTick=function(){switch(this.state){case Vt:this.doTickIdle();break;case Kt:var i,n=this.levels,r=this.trackId,e=null==n||null===(i=n[r])||void 0===i?void 0:i.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=Qt}break;case qt:var s,h=performance.now(),a=this.retryDate;(!a||h>=a||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Vt);break;case Qt:var o=this.waitingData;if(o){var u=o.frag,f=o.part,c=o.cache,l=o.complete;if(void 0!==this.initPTS[u.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Wt;var v={frag:u,part:f,payload:c.flush(),networkDetails:null};this._handleFragmentLoadProgress(v),l&&t.prototype._handleFragmentLoadComplete.call(this,v)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+u.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var d=this.getLoadPosition(),p=bt.bufferInfo(this.mediaBuffer,d,this.config.maxBufferHole);At(p.end,this.config.maxFragLookUpTolerance,u)<0&&(this.log("Waiting fragment cc ("+u.cc+") @ "+u.start+" cancelled because another fragment at "+p.end+" is needed"),this.clearWaitingFragment())}}else this.state=Vt}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Vt)},e.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;if(t&&t.readyState){var i=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&i.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime}},e.doTickIdle=function(){var t,i,n=this.hls,r=this.levels,e=this.media,s=this.trackId,a=n.config;if(r&&r[s]&&(e||!this.startFragRequested&&a.startFragPrefetch)){var o=r[s].details;if(!o||o.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(o))this.state=Kt;else{var u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,m.a.AUDIO,I.b.AUDIO));var f=this.getFwdBufferInfo(u,I.b.AUDIO);if(null!==f){var c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,I.b.MAIN),l=f.len,v=this.getMaxBufferLength(null==c?void 0:c.len),d=this.audioSwitch;if(!(l>=v)||d){if(!d&&this._streamEnded(f,o))return n.trigger(h.a.BUFFER_EOS,{type:"audio"}),void(this.state=Yt);var p=o.fragments[0].start,b=f.end;if(d&&e){var g=this.getLoadPosition();b=g,o.PTSKnown&&g<p&&(f.end>p||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=p+.05)}if(!(c&&b>c.end+o.targetduration)&&(c&&c.len||!f.len)){var y=this.getNextFragment(b,o);y?"identity"!==(null===(t=y.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(i=y.decryptdata)&&void 0!==i&&i.key?this.loadFragment(y,o,b):this.loadKey(y,o):this.bufferFlushed=!0}}}}}},e.getMaxBufferLength=function(i){var n=t.prototype.getMaxBufferLength.call(this);return i?Math.max(n,i):n},e.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},e.onAudioTracksUpdated=function(t,i){var n=i.audioTracks;this.resetTransmuxer(),this.levels=n.map((function(t){return new Y(t)}))},e.onAudioTrackSwitching=function(t,i){var n=!!i.url;this.trackId=i.id;var r=this.fragCurrent;null!=r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=Vt):this.state=Gt,this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},e.onLevelLoaded=function(t,i){this.mainDetails=i.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(h.a.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},e.onAudioTrackLoaded=function(t,i){var n;if(null!=this.mainDetails){var r=this.levels,e=i.details,s=i.id;if(r){this.log("Track "+s+" loaded ["+e.startSN+","+e.endSN+"],duration:"+e.totalduration);var h=r[s],a=0;if(e.live||null!==(n=h.details)&&void 0!==n&&n.live){var o=this.mainDetails;if(e.fragments[0]||(e.deltaUpdateFailed=!0),e.deltaUpdateFailed||!o)return;!h.details&&e.hasProgramDateTime&&o.hasProgramDateTime?(Tt(e,o),a=e.fragments[0].start):a=this.alignPlaylists(e,h.details)}h.details=e,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&e.live||this.setStartPosition(h.details,a),this.state!==Kt||this.waitForCdnTuneIn(e)||(this.state=Vt),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)}else this.cachedTrackLoadedData=i},e._handleFragmentLoadProgress=function(t){var i,n=t.frag,r=t.part,e=t.payload,s=this.config,h=this.trackId,a=this.levels;if(a){var o=a[h],u=o.details,f=s.defaultAudioCodec||o.audioCodec||"mp4a.40.2",c=this.transmuxer;c||(c=this.transmuxer=new ai(this.hls,I.b.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var l=this.initPTS[n.cc],v=null===(i=n.initSegment)||void 0===i?void 0:i.data;if(void 0!==l){var d=r?r.index:-1,p=-1!==d,m=new gt(n.level,n.sn,n.stats.chunkCount,e.byteLength,d,p);c.push(e,v,f,"",n,r,u.totalduration,!1,m,l)}else this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+u.startSN+" ,"+u.endSN+"],track "+h),(this.waitingData=this.waitingData||{frag:n,part:r,cache:new mi,complete:!1}).cache.push(new Uint8Array(e)),this.waitingVideoCC=this.videoTrackCC,this.state=Qt}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},e._handleFragmentLoadComplete=function(i){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,i)},e.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.onBufferCreated=function(t,i){var n=i.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer||null)},e.onFragBuffered=function(t,i){var n=i.frag,r=i.part;n.type===I.b.AUDIO&&(this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,r)))},e.onError=function(i,n){switch(n.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.b.AUDIO,n);break;case a.a.AUDIO_TRACK_LOAD_ERROR:case a.a.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Jt&&this.state!==Gt&&(this.state=n.fatal?Jt:Vt,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case a.a.BUFFER_FULL_ERROR:if("audio"===n.parent&&(this.state===zt||this.state===Ht)){var r=!0,e=this.getFwdBufferInfo(this.mediaBuffer,I.b.AUDIO);e&&e.len>.5&&(r=!this.reduceMaxBufferLength(e.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},e.onBufferFlushed=function(t,i){i.type===m.a.AUDIO&&(this.bufferFlushed=!0)},e._handleTransmuxComplete=function(t){var i,n="audio",r=this.hls,e=t.remuxResult,s=t.chunkMeta,a=this.getCurrentContext(s);if(!a)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(s.level);var o=a.frag,u=a.part,f=a.level.details,c=e.audio,l=e.text,v=e.id3,d=e.initSegment;if(!this.fragContextChanged(o)&&f){if(this.state=zt,this.audioSwitch&&c&&this.completeAudioSwitch(),null!=d&&d.tracks&&(this._bufferInitSegment(d.tracks,o,s),r.trigger(h.a.FRAG_PARSING_INIT_SEGMENT,{frag:o,id:n,tracks:d.tracks})),c){var p=c.startPTS,b=c.endPTS,g=c.startDTS,y=c.endDTS;u&&(u.elementaryStreams[m.a.AUDIO]={startPTS:p,endPTS:b,startDTS:g,endDTS:y}),o.setElementaryStreamInfo(m.a.AUDIO,p,b,g,y),this.bufferFragmentData(c,o,u,s)}if(null!=v&&null!==(i=v.samples)&&void 0!==i&&i.length){var w=bi({id:n,frag:o,details:f},v);r.trigger(h.a.FRAG_PARSING_METADATA,w)}if(l){var k=bi({id:n,frag:o,details:f},l);r.trigger(h.a.FRAG_PARSING_USERDATA,k)}}},e._bufferInitSegment=function(t,i,n){if(this.state===zt){t.video&&delete t.video;var r=t.audio;if(r){r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(h.a.BUFFER_CODECS,t);var e=r.initSegment;if(null!=e&&e.byteLength){var s={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:e};this.hls.trigger(h.a.BUFFER_APPENDING,s)}this.tick()}}},e.loadFragment=function(i,n,r){var e=this.fragmentTracker.getState(i);this.fragCurrent=i,(this.audioSwitch||e===ut.NOT_LOADED||e===ut.PARTIAL)&&("initSegment"===i.sn?this._loadInitSegment(i):n.live&&!Object(s.a)(this.initPTS[i.cc])?(this.log("Waiting for video PTS in continuity counter "+i.cc+" of live stream before loading audio fragment "+i.sn+" of level "+this.trackId),this.state=Qt):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,i,n,r)))},e.completeAudioSwitch=function(){var i=this.hls,n=this.media,r=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,i.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:r})},r}(ti);function wi(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ki(t,i){return(ki=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var Oi=function(t){var i,n;function r(i){var n;return(n=t.call(this,i,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,ki(i,n);var e,s,o,u=r.prototype;return u.registerListeners=function(){var t=this.hls;t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(h.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(h.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(h.a.ERROR,this.onError,this)},u.unregisterListeners=function(){var t=this.hls;t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(h.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(h.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(h.a.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},u.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},u.onManifestParsed=function(t,i){this.tracks=i.audioTracks||[]},u.onAudioTrackLoaded=function(t,i){var n=i.id,r=i.details,e=this.tracksInGroup[n];if(e){var s=e.details;e.details=i.details,this.log("audioTrack "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,i,s))}else this.warn("Invalid audio track id "+n)},u.onLevelLoading=function(t,i){this.switchLevel(i.level)},u.onLevelSwitching=function(t,i){this.switchLevel(i.level)},u.switchLevel=function(t){var i=this.hls.levels[t];if(null!=i&&i.audioGroupIds){var n=i.audioGroupIds[i.urlId];if(this.groupId!==n){this.groupId=n;var r=this.tracks.filter((function(t){return!n||t.groupId===n}));this.selectDefaultTrack&&!r.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var e={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(h.a.AUDIO_TRACKS_UPDATED,e),this.selectInitialTrack()}}},u.onError=function(i,n){t.prototype.onError.call(this,i,n),!n.fatal&&n.context&&n.context.type===I.a.AUDIO_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},u.setAudioTrack=function(t){var i=this.tracksInGroup;if(t<0||t>=i.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=i[this.trackId];this.log("Now switching to audio-track index "+t);var r=i[t],e=r.id,s=r.groupId,a=void 0===s?"":s,o=r.name,u=r.type,f=r.url;if(this.trackId=t,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(h.a.AUDIO_TRACK_SWITCHING,{id:e,groupId:a,name:o,type:u,url:f}),!r.details||r.details.live){var c=this.switchParams(r.url,null==n?void 0:n.details);this.loadPlaylist(c)}}},u.selectInitialTrack=function(){this.tracksInGroup;var t=this.trackName,i=this.findTrackId(t)||this.findTrackId();-1!==i?this.setAudioTrack(i):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},u.findTrackId=function(t){for(var i=this.tracksInGroup,n=0;n<i.length;n++){var r=i[n];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},u.loadPlaylist=function(t){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var n=i.id,r=i.groupId,e=i.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(h.a.AUDIO_TRACK_LOADING,{url:e,id:n,groupId:r,deliveryDirectives:t||null})}},e=r,(s=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&wi(e.prototype,s),Object.defineProperty(e,"prototype",{writable:!1}),r}(st);function Ti(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ei(t,i){return(Ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var Si=function(t){var i,n;function r(i,n){var r;return(r=t.call(this,i,n,"[subtitle-stream-controller]")||this).levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,Ei(i,n);var e,s,a,o=r.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(h.a.ERROR,this.onError,this),t.on(h.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(h.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(h.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(h.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},o._unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(h.a.ERROR,this.onError,this),t.off(h.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(h.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(h.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(h.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},o.startLoad=function(){this.stopLoad(),this.state=Vt,this.setInterval(500),this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(t,i){this.mainDetails=i.details},o.onSubtitleFragProcessed=function(t,i){var n=i.frag,r=i.success;if(this.fragPrevious=n,this.state=Vt,r){var e=this.tracksBuffered[this.currentTrackId];if(e){for(var s,h=n.start,a=0;a<e.length;a++)if(h>=e[a].start&&h<=e[a].end){s=e[a];break}var o=n.start+n.duration;s?s.end=o:(s={start:h,end:o},e.push(s)),this.fragmentTracker.fragBuffered(n)}}},o.onBufferFlushing=function(t,i){var n=i.startOffset,r=i.endOffset;if(0===n&&r!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,s=this.levels;if(!s.length||!s[e]||!s[e].details)return;var h=r-s[e].details.targetduration;if(h<=0)return;i.endOffsetSubtitles=Math.max(0,h),this.tracksBuffered.forEach((function(t){for(var i=0;i<t.length;)if(t[i].end<=h)t.shift();else{if(!(t[i].start<h))break;t[i].start=h,i++}})),this.fragmentTracker.removeFragmentsInRange(n,h,I.b.SUBTITLE)}},o.onError=function(t,i){var n,r=i.frag;r&&r.type===I.b.SUBTITLE&&(null!==(n=this.fragCurrent)&&void 0!==n&&n.loader&&this.fragCurrent.loader.abort(),this.state=Vt)},o.onSubtitleTracksUpdated=function(t,i){var n=this,r=i.subtitleTracks;this.tracksBuffered=[],this.levels=r.map((function(t){return new Y(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){n.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(t,i){if(this.currentTrackId=i.id,this.levels.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}else this.clearInterval()},o.onSubtitleTrackLoaded=function(t,i){var n,r=i.details,e=i.id,s=this.currentTrackId,h=this.levels;if(h.length){var a=h[s];if(!(e>=h.length||e!==s)&&a){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||null!==(n=a.details)&&void 0!==n&&n.live){var o=this.mainDetails;if(r.deltaUpdateFailed||!o)return;var u=o.fragments[0];a.details?0===this.alignPlaylists(r,a.details)&&u&&et(r,u.start):r.hasProgramDateTime&&o.hasProgramDateTime?Tt(r,o):u&&et(r,u.start)}a.details=r,this.levelLastLoaded=e,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===Vt&&(St(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0))}}},o._handleFragmentLoadComplete=function(t){var i=t.frag,n=t.payload,r=i.decryptdata,e=this.hls;if(!this.fragContextChanged(i)&&n&&n.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).then((function(t){var n=performance.now();e.trigger(h.a.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:s,tdecrypt:n}})}))}},o.doTick=function(){if(this.media){if(this.state===Vt){var t=this.currentTrackId,i=this.levels;if(!i.length||!i[t]||!i[t].details)return;var n=i[t].details,r=n.targetduration,e=this.config,s=this.media,h=bt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s.currentTime-r,e.maxBufferHole),a=h.end;if(h.len>this.getMaxBufferLength()+r)return;var o,u=n.fragments,f=u.length,c=n.edge,l=this.fragPrevious;if(a<c){var v=e.maxFragLookUpTolerance;!(o=St(l,u,Math.max(u[0].start,a),v))&&l&&l.start<u[0].start&&(o=u[0])}else o=u[f-1];if(!(o=this.mapToInitFragWhenRequired(o)))return;if(this.fragmentTracker.getState(o)!==ut.NOT_LOADED)return;o.encrypted?this.loadKey(o,n):this.loadFragment(o,n,a)}}else this.state=Vt},o.loadFragment=function(i,n,r){this.fragCurrent=i,"initSegment"===i.sn?this._loadInitSegment(i):t.prototype.loadFragment.call(this,i,n,r)},e=r,(s=[{key:"mediaBufferTimeRanges",get:function(){return new Ai(this.tracksBuffered[this.currentTrackId]||[])}}])&&Ti(e.prototype,s),Object.defineProperty(e,"prototype",{writable:!1}),r}(ti),Ai=function(t){this.buffered=void 0;var i=function(i,n,r){if((n>>>=0)>r-1)throw new DOMException("Failed to execute '"+i+"' on 'TimeRanges': The index provided ("+n+") is greater than the maximum bound ("+r+")");return t[n][i]};this.buffered={get length(){return t.length},end:function(n){return i("end",n,t.length)},start:function(n){return i("start",n,t.length)}}};function Mi(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ji(t,i){return(ji=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function Di(t){for(var i=[],n=0;n<t.length;n++){var r=t[n];"subtitles"===r.kind&&r.label&&i.push(t[n])}return i}var xi,Li=function(t){var i,n;function r(i){var n;return(n=t.call(this,i,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n._subtitleDisplay=!0,n.registerListeners(),n}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,ji(i,n);var e,s,a,o=r.prototype;return o.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},o.registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(h.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(h.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(h.a.ERROR,this.onError,this)},o.unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(h.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(h.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(h.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(h.a.ERROR,this.onError,this)},o.onMediaAttached=function(t,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},o.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},o.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Di(this.media.textTracks).forEach((function(t){U(t)})),this.subtitleTrack=-1,this.media=null)},o.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},o.onManifestParsed=function(t,i){this.tracks=i.subtitleTracks},o.onSubtitleTrackLoaded=function(t,i){var n=i.id,r=i.details,e=this.trackId,s=this.tracksInGroup[e];if(s){var h=s.details;s.details=i.details,this.log("subtitle track "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,i,h))}else this.warn("Invalid subtitle track id "+n)},o.onLevelLoading=function(t,i){this.switchLevel(i.level)},o.onLevelSwitching=function(t,i){this.switchLevel(i.level)},o.switchLevel=function(t){var i=this.hls.levels[t];if(null!=i&&i.textGroupIds){var n=i.textGroupIds[i.urlId];if(this.groupId!==n){var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,e=this.tracks.filter((function(t){return!n||t.groupId===n}));this.tracksInGroup=e;var s=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=n;var a={subtitleTracks:e};this.log("Updating subtitle tracks, "+e.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(h.a.SUBTITLE_TRACKS_UPDATED,a),-1!==s&&this.setSubtitleTrack(s,r)}}},o.findTrackId=function(t){for(var i=this.tracksInGroup,n=0;n<i.length;n++){var r=i[n];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},o.onError=function(i,n){t.prototype.onError.call(this,i,n),!n.fatal&&n.context&&n.context.type===I.a.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},o.loadPlaylist=function(t){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var n=i.id,r=i.groupId,e=i.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+n),this.hls.trigger(h.a.SUBTITLE_TRACK_LOADING,{url:e,id:n,groupId:r,deliveryDirectives:t||null})}},o.toggleTrackModes=function(t){var i=this,n=this.media,r=this.trackId;if(n){var e=Di(n.textTracks),s=e.filter((function(t){return t.groupId===i.groupId}));if(-1===t)[].slice.call(e).forEach((function(t){t.mode="disabled"}));else{var h=s[r];h&&(h.mode="disabled")}var a=s[t];a&&(a.mode=this.subtitleDisplay?"showing":"hidden")}},o.setSubtitleTrack=function(t,i){var n,r=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(n=r[t])&&void 0!==n&&n.details)||t<-1||t>=r.length)){this.clearTimer();var e=r[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,e){var s=e.id,a=e.groupId,o=void 0===a?"":a,u=e.name,f=e.type,c=e.url;this.hls.trigger(h.a.SUBTITLE_TRACK_SWITCH,{id:s,groupId:o,name:u,type:f,url:c});var l=this.switchParams(e.url,null==i?void 0:i.details);this.loadPlaylist(l)}else this.hls.trigger(h.a.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},o.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,i=Di(this.media.textTracks),n=0;n<i.length;n++)if("hidden"===i[n].mode)t=n;else if("showing"===i[n].mode){t=n;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},e=r,(s=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,i)}}])&&Mi(e.prototype,s),Object.defineProperty(e,"prototype",{writable:!1}),r}(st),Ii=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var i=t.prototype;return i.append=function(t,i){var n=this.queues[i];n.push(t),1===n.length&&this.buffers[i]&&this.executeNext(i)},i.insertAbort=function(t,i){this.queues[i].unshift(t),this.executeNext(i)},i.appendBlocker=function(t){var i,n=new Promise((function(t){i=t})),r={execute:i,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,t),n},i.executeNext=function(t){var i=this.buffers,n=this.queues,r=i[t],e=n[t];if(e.length){var s=e[0];try{s.execute()}catch(i){o.b.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(i),r&&r.updating||(e.shift(),this.executeNext(t))}}},i.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},i.current=function(t){return this.queues[t][0]},t}(),_i=ii(),Ri=/([ha]vc.)(?:\.[^.,]+)+/,Ci=function(){function t(t){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,n=i.media,r=i.mediaSource;o.b.log("[buffer-controller]: Media source opened"),n&&(i.updateMediaElementDuration(),t.trigger(h.a.MEDIA_ATTACHED,{media:n})),r&&r.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){o.b.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){o.b.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var i=t.prototype;return i.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},i.destroy=function(){this.unregisterListeners(),this.details=null},i.registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(h.a.BUFFER_RESET,this.onBufferReset,this),t.on(h.a.BUFFER_APPENDING,this.onBufferAppending,this),t.on(h.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(h.a.BUFFER_EOS,this.onBufferEos,this),t.on(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(h.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(h.a.FRAG_PARSED,this.onFragParsed,this),t.on(h.a.FRAG_CHANGED,this.onFragChanged,this)},i.unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(h.a.BUFFER_RESET,this.onBufferReset,this),t.off(h.a.BUFFER_APPENDING,this.onBufferAppending,this),t.off(h.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(h.a.BUFFER_EOS,this.onBufferEos,this),t.off(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(h.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(h.a.FRAG_PARSED,this.onFragParsed,this),t.off(h.a.FRAG_CHANGED,this.onFragChanged,this)},i._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Ii(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},i.onManifestParsed=function(t,i){var n=2;(i.audio&&!i.video||!i.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,o.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(t,i){var n=this.media=i.media;if(n&&_i){var r=this.mediaSource=new _i;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src}},i.onMediaDetaching=function(){var t=this.media,i=this.mediaSource,n=this._objectUrl;if(i){if(o.b.log("[buffer-controller]: media source detaching"),"open"===i.readyState)try{i.endOfStream()}catch(t){o.b.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(n&&self.URL.revokeObjectURL(n),t.src===n?(t.removeAttribute("src"),t.load()):o.b.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(h.a.MEDIA_DETACHED,void 0)},i.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(i){var n=t.sourceBuffer[i];try{n&&(t.removeBufferListeners(i),t.mediaSource&&t.mediaSource.removeSourceBuffer(n),t.sourceBuffer[i]=void 0)}catch(t){o.b.warn("[buffer-controller]: Failed to reset the "+i+" buffer",t)}})),this._initSourceBuffer()},i.onBufferCodecs=function(t,i){var n=this,r=this.getSourceBufferTypes().length;Object.keys(i).forEach((function(t){if(r){var e=n.tracks[t];if(e&&"function"==typeof e.buffer.changeType){var s=i[t],h=s.id,a=s.codec,u=s.levelCodec,f=s.container,c=s.metadata,l=(e.levelCodec||e.codec).replace(Ri,"$1"),v=(u||a).replace(Ri,"$1");if(l!==v){var d=f+";codecs="+(u||a);n.appendChangeType(t,d),o.b.log("[buffer-controller]: switching codec "+l+" to "+v),n.tracks[t]={buffer:e.buffer,codec:a,container:f,levelCodec:u,metadata:c,id:h}}}}else n.pendingTracks[t]=i[t]})),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.appendChangeType=function(t,i){var n=this,r=this.operationQueue,e={execute:function(){var e=n.sourceBuffer[t];e&&(o.b.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+i),e.changeType(i)),r.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(i){o.b.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",i)}};r.append(e,t)},i.onBufferAppending=function(t,i){var n=this,r=this.hls,e=this.operationQueue,s=this.tracks,u=i.data,f=i.type,c=i.frag,l=i.part,v=i.chunkMeta,d=v.buffering[f],p=self.performance.now();d.start=p;var m=c.stats.buffering,b=l?l.stats.buffering:null;0===m.start&&(m.start=p),b&&0===b.start&&(b.start=p);var g=s.audio,y="audio"===f&&1===v.id&&"audio/mpeg"===(null==g?void 0:g.container),w={execute:function(){if(d.executeStart=self.performance.now(),y){var t=n.sourceBuffer[f];if(t){var i=c.start-t.timestampOffset;Math.abs(i)>=.1&&(o.b.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+c.start+" (delta: "+i+") sn: "+c.sn+")"),t.timestampOffset=c.start)}}n.appendExecutor(u,f)},onStart:function(){},onComplete:function(){var t=self.performance.now();d.executeEnd=d.end=t,0===m.first&&(m.first=t),b&&0===b.first&&(b.first=t);var i=n.sourceBuffer,r={};for(var e in i)r[e]=bt.getBuffered(i[e]);n.appendError=0,n.hls.trigger(h.a.BUFFER_APPENDED,{type:f,frag:c,part:l,chunkMeta:v,parent:c.type,timeRanges:r})},onError:function(t){o.b.error("[buffer-controller]: Error encountered while trying to append to the "+f+" SourceBuffer",t);var i={type:a.b.MEDIA_ERROR,parent:c.type,details:a.a.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?i.details=a.a.BUFFER_FULL_ERROR:(n.appendError++,i.details=a.a.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(o.b.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i.fatal=!0,r.stopLoad())),r.trigger(h.a.ERROR,i)}};e.append(w,f)},i.onBufferFlushing=function(t,i){var n=this,r=this.operationQueue,e=function(t){return{execute:n.removeExecutor.bind(n,t,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(h.a.BUFFER_FLUSHED,{type:t})},onError:function(i){o.b.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",i)}}};i.type?r.append(e(i.type),i.type):this.getSourceBufferTypes().forEach((function(t){r.append(e(t),t)}))},i.onFragParsed=function(t,i){var n=this,r=i.frag,e=i.part,s=[],a=e?e.elementaryStreams:r.elementaryStreams;a[m.a.AUDIOVIDEO]?s.push("audiovideo"):(a[m.a.AUDIO]&&s.push("audio"),a[m.a.VIDEO]&&s.push("video")),0===s.length&&o.b.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers((function(){var t=self.performance.now();r.stats.buffering.end=t,e&&(e.stats.buffering.end=t);var i=e?e.stats:r.stats;n.hls.trigger(h.a.FRAG_BUFFERED,{frag:r,part:e,stats:i,id:r.type})}),s)},i.onFragChanged=function(t,i){this.flushBackBuffer()},i.onBufferEos=function(t,i){var n=this;this.getSourceBufferTypes().reduce((function(t,r){var e=n.sourceBuffer[r];return i.type&&i.type!==r||e&&!e.ended&&(e.ended=!0,o.b.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),t&&!(e&&!e.ended)}),!0)&&this.blockBuffers((function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},i.onLevelUpdated=function(t,i){var n=i.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},i.flushBackBuffer=function(){var t=this.hls,i=this.details,n=this.media,r=this.sourceBuffer;if(n&&null!==i){var e=this.getSourceBufferTypes();if(e.length){var a=i.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(s.a)(a)&&!(a<0)){var o=n.currentTime,u=i.levelTargetDuration,f=Math.max(a,u),c=Math.floor(o/u)*u-f;e.forEach((function(n){var e=r[n];if(e){var s=bt.getBuffered(e);s.length>0&&c>s.start(0)&&(t.trigger(h.a.BACK_BUFFER_REACHED,{bufferEnd:c}),i.live&&t.trigger(h.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c}),t.trigger(h.a.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:n}))}}))}}}},i.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,i=this.hls,n=this.media,r=this.mediaSource,e=t.fragments[0].start+t.totalduration,h=n.duration,a=Object(s.a)(r.duration)?r.duration:0;t.live&&i.config.liveDurationInfinity?(o.b.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(e>a&&e>h||!Object(s.a)(h))&&(o.b.log("[buffer-controller]: Updating Media Source duration to "+e.toFixed(3)),r.duration=e)}},i.updateSeekableRange=function(t){var i=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=i&&i.setLiveSeekableRange){var r=Math.max(0,n[0].start),e=Math.max(r,r+t.totalduration);i.setLiveSeekableRange(r,e)}},i.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,i=this.operationQueue,n=this.pendingTracks,r=Object.keys(n).length;if(r&&!t||2===r){this.createSourceBuffers(n),this.pendingTracks={};var e=this.getSourceBufferTypes();if(0===e.length)return void this.hls.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});e.forEach((function(t){i.executeNext(t)}))}},i.createSourceBuffers=function(t){var i=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var e in t)if(!i[e]){var s=t[e];if(!s)throw Error("source buffer exists for track "+e+", however track does not");var u=s.levelCodec||s.codec,f=s.container+";codecs="+u;o.b.log("[buffer-controller]: creating sourceBuffer("+f+")");try{var c=i[e]=n.addSourceBuffer(f),l=e;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[e]={buffer:c,codec:u,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},r++}catch(t){o.b.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:f})}}r&&this.hls.trigger(h.a.BUFFER_CREATED,{tracks:this.tracks})},i._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},i._onSBUpdateEnd=function(t){var i=this.operationQueue;i.current(t).onComplete(),i.shiftAndExecuteNext(t)},i._onSBUpdateError=function(t,i){o.b.error("[buffer-controller]: "+t+" SourceBuffer error",i),this.hls.trigger(h.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(t);n&&n.onError(i)},i.removeExecutor=function(t,i,n){var r=this.media,e=this.mediaSource,h=this.operationQueue,a=this.sourceBuffer[t];if(!r||!e||!a)return o.b.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void h.shiftAndExecuteNext(t);var u=Object(s.a)(r.duration)?r.duration:1/0,f=Object(s.a)(e.duration)?e.duration:1/0,c=Math.max(0,i),l=Math.min(n,u,f);l>c?(o.b.log("[buffer-controller]: Removing ["+c+","+l+"] from the "+t+" SourceBuffer"),a.remove(c,l)):h.shiftAndExecuteNext(t)},i.appendExecutor=function(t,i){var n=this.operationQueue,r=this.sourceBuffer[i];if(!r)return o.b.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(i);r.ended=!1,r.appendBuffer(t)},i.blockBuffers=function(t,i){var n=this;if(void 0===i&&(i=this.getSourceBufferTypes()),!i.length)return o.b.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var r=this.operationQueue,e=i.map((function(t){return r.appendBlocker(t)}));Promise.all(e).then((function(){t(),i.forEach((function(t){var i=n.sourceBuffer[t];i&&i.updating||r.shiftAndExecuteNext(t)}))}))},i.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},i.addBufferListener=function(t,i,n){var r=this.sourceBuffer[t];if(r){var e=n.bind(this,t);this.listeners[t].push({event:i,listener:e}),r.addEventListener(i,e)}},i.removeBufferListeners=function(t){var i=this.sourceBuffer[t];i&&this.listeners[t].forEach((function(t){i.removeEventListener(t.event,t.listener)}))},t}(),Ni={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Pi=function(t){var i=t;return Ni.hasOwnProperty(t)&&(i=Ni[t]),String.fromCharCode(i)},Ui={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Fi={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Bi={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$i={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Gi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(xi||(xi={}));var Vi=function(){function t(){this.time=null,this.verboseLevel=xi.ERROR}return t.prototype.log=function(t,i){this.verboseLevel>=t&&o.b.log(this.time+" ["+t+"] "+i)},t}(),Xi=function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].toString(16));return i},Wi=function(){function t(t,i,n,r,e){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=i||!1,this.italics=n||!1,this.background=r||"black",this.flash=e||!1}var i=t.prototype;return i.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},i.setStyles=function(t){for(var i=["foreground","underline","italics","background","flash"],n=0;n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&(this[r]=t[r])}},i.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},i.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},i.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},i.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),qi=function(){function t(t,i,n,r,e,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Wi(i,n,r,e,s)}var i=t.prototype;return i.reset=function(){this.uchar=" ",this.penState.reset()},i.setChar=function(t,i){this.uchar=t,this.penState.copy(i)},i.setPenState=function(t){this.penState.copy(t)},i.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},i.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},i.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),Ki=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<100;i++)this.chars.push(new qi);this.logger=t,this.pos=0,this.currPenState=new Wi}var i=t.prototype;return i.equals=function(t){for(var i=!0,n=0;n<100;n++)if(!this.chars[n].equals(t.chars[n])){i=!1;break}return i},i.copy=function(t){for(var i=0;i<100;i++)this.chars[i].copy(t.chars[i])},i.isEmpty=function(){for(var t=!0,i=0;i<100;i++)if(!this.chars[i].isEmpty()){t=!1;break}return t},i.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(xi.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(xi.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},i.moveCursor=function(t){var i=this.pos+t;if(t>1)for(var n=this.pos+1;n<i+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(i)},i.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},i.insertChar=function(t){t>=144&&this.backSpace();var i=Pi(t);this.pos>=100?this.logger.log(xi.ERROR,"Cannot insert "+t.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1))},i.clearFromPos=function(t){var i;for(i=t;i<100;i++)this.chars[i].reset()},i.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},i.clearToEndOfRow=function(){this.clearFromPos(this.pos)},i.getTextString=function(){for(var t=[],i=!0,n=0;n<100;n++){var r=this.chars[n].uchar;" "!==r&&(i=!1),t.push(r)}return i?"":t.join("")},i.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),zi=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<15;i++)this.rows.push(new Ki(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var i=t.prototype;return i.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},i.equals=function(t){for(var i=!0,n=0;n<15;n++)if(!this.rows[n].equals(t.rows[n])){i=!1;break}return i},i.copy=function(t){for(var i=0;i<15;i++)this.rows[i].copy(t.rows[i])},i.isEmpty=function(){for(var t=!0,i=0;i<15;i++)if(!this.rows[i].isEmpty()){t=!1;break}return t},i.backSpace=function(){this.rows[this.currRow].backSpace()},i.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},i.insertChar=function(t){this.rows[this.currRow].insertChar(t)},i.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},i.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},i.setCursor=function(t){this.logger.log(xi.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},i.setPAC=function(t){this.logger.log(xi.INFO,"pacData = "+JSON.stringify(t));var i=t.row-1;if(this.nrRollUpRows&&i<this.nrRollUpRows-1&&(i=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==i){for(var n=0;n<15;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var s=e.rows[r].cueStartTime,h=this.logger.time;if(s&&null!==h&&s<h)for(var a=0;a<this.nrRollUpRows;a++)this.rows[i-this.nrRollUpRows+a+1].copy(e.rows[r+a])}}this.currRow=i;var o=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,f=Math.max(u-1,0);o.setCursor(t.indent),t.color=o.chars[f].penState.foreground}var c={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(c)},i.setBkgData=function(t){this.logger.log(xi.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},i.setRollUpRows=function(t){this.nrRollUpRows=t},i.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(xi.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(t,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(xi.INFO,"Rolling up")}else this.logger.log(xi.DEBUG,"roll_up but nrRollUpRows not set yet")},i.getDisplayText=function(t){t=t||!1;for(var i=[],n="",r=-1,e=0;e<15;e++){var s=this.rows[e].getTextString();s&&(r=e+1,t?i.push("Row "+r+": '"+s+"'"):i.push(s.trim()))}return i.length>0&&(n=t?"["+i.join(" | ")+"]":i.join("\n")),n},i.getTextAndFormat=function(){return this.rows},t}(),Hi=function(){function t(t,i,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new zi(n),this.nonDisplayedMemory=new zi(n),this.lastOutputScreen=new zi(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var i=t.prototype;return i.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},i.getHandler=function(){return this.outputFilter},i.setHandler=function(t){this.outputFilter=t},i.setPAC=function(t){this.writeScreen.setPAC(t)},i.setBkgData=function(t){this.writeScreen.setBkgData(t)},i.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(xi.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},i.insertChars=function(t){for(var i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(xi.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(xi.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},i.ccRCL=function(){this.logger.log(xi.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},i.ccBS=function(){this.logger.log(xi.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},i.ccAOF=function(){},i.ccAON=function(){},i.ccDER=function(){this.logger.log(xi.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},i.ccRU=function(t){this.logger.log(xi.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},i.ccFON=function(){this.logger.log(xi.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},i.ccRDC=function(){this.logger.log(xi.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},i.ccTR=function(){this.logger.log(xi.INFO,"TR"),this.setMode("MODE_TEXT")},i.ccRTD=function(){this.logger.log(xi.INFO,"RTD"),this.setMode("MODE_TEXT")},i.ccEDM=function(){this.logger.log(xi.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},i.ccCR=function(){this.logger.log(xi.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},i.ccENM=function(){this.logger.log(xi.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},i.ccEOC=function(){if(this.logger.log(xi.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(xi.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},i.ccTO=function(t){this.logger.log(xi.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},i.ccMIDROW=function(t){var i={flash:!1};if(i.underline=t%2==1,i.italics=t>=46,i.italics)i.foreground="white";else{var n=Math.floor(t/2)-16;i.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(xi.INFO,"MIDROW: "+JSON.stringify(i)),this.writeScreen.setPen(i)},i.outputDataUpdate=function(t){void 0===t&&(t=!1);var i=this.logger.time;null!==i&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,i,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:i):this.cueStartTime=i,this.lastOutputScreen.copy(this.displayedMemory))},i.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}();function Yi(t,i,n){n.a=t,n.b=i}function Ji(t,i,n){return n.a===t&&n.b===i}var Qi=function(){function t(t,i,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Vi;this.channels=[null,new Hi(t,i,r),new Hi(t+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var i=t.prototype;return i.getHandler=function(t){return this.channels[t].getHandler()},i.setHandler=function(t,i){this.channels[t].setHandler(i)},i.addData=function(t,i){var n,r,e,s=!1;this.logger.time=t;for(var h=0;h<i.length;h+=2)if(r=127&i[h],e=127&i[h+1],0!==r||0!==e){if(this.logger.log(xi.DATA,"["+Xi([i[h],i[h+1]])+"] -> ("+Xi([r,e])+")"),(n=this.parseCmd(r,e))||(n=this.parseMidrow(r,e)),n||(n=this.parsePAC(r,e)),n||(n=this.parseBackgroundAttributes(r,e)),!n&&(s=this.parseChars(r,e))){var a=this.currentChannel;a&&a>0?this.channels[a].insertChars(s):this.logger.log(xi.WARNING,"No channel found yet. TEXT-MODE?")}n||s||this.logger.log(xi.WARNING,"Couldn't parse cleaned data "+Xi([r,e])+" orig: "+Xi([i[h],i[h+1]]))}},i.parseCmd=function(t,i){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&i>=32&&i<=47||(23===t||31===t)&&i>=33&&i<=35))return!1;if(Ji(t,i,n))return Yi(null,null,n),this.logger.log(xi.DEBUG,"Repeated command ("+Xi([t,i])+") is dropped"),!0;var r=20===t||21===t||23===t?1:2,e=this.channels[r];return 20===t||21===t||28===t||29===t?32===i?e.ccRCL():33===i?e.ccBS():34===i?e.ccAOF():35===i?e.ccAON():36===i?e.ccDER():37===i?e.ccRU(2):38===i?e.ccRU(3):39===i?e.ccRU(4):40===i?e.ccFON():41===i?e.ccRDC():42===i?e.ccTR():43===i?e.ccRTD():44===i?e.ccEDM():45===i?e.ccCR():46===i?e.ccENM():47===i&&e.ccEOC():e.ccTO(i-32),Yi(t,i,n),this.currentChannel=r,!0},i.parseMidrow=function(t,i){var n=0;if((17===t||25===t)&&i>=32&&i<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(xi.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(i),this.logger.log(xi.DEBUG,"MIDROW ("+Xi([t,i])+")"),!0)}return!1},i.parsePAC=function(t,i){var n,r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&i>=64&&i<=127||(16===t||24===t)&&i>=64&&i<=95))return!1;if(Ji(t,i,r))return Yi(null,null,r),!0;var e=t<=23?1:2;n=i>=64&&i<=95?1===e?Ui[t]:Bi[t]:1===e?Fi[t]:$i[t];var s=this.channels[e];return!!s&&(s.setPAC(this.interpretPAC(n,i)),Yi(t,i,r),this.currentChannel=e,!0)},i.interpretPAC=function(t,i){var n,r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=i>95?i-96:i-64,r.underline=!(1&~n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},i.parseChars=function(t,i){var n,r,e=null,s=null;if(t>=25?(n=2,s=t-8):(n=1,s=t),s>=17&&s<=19?(r=17===s?i+80:18===s?i+112:i+144,this.logger.log(xi.INFO,"Special char '"+Pi(r)+"' in channel "+n),e=[r]):t>=32&&t<=127&&(e=0===i?[t]:[t,i]),e){var h=Xi(e);this.logger.log(xi.DEBUG,"Char codes =  "+h.join(",")),Yi(t,i,this.cmdHistory)}return e},i.parseBackgroundAttributes=function(t,i){var n;if(!((16===t||24===t)&&i>=32&&i<=47||(23===t||31===t)&&i>=45&&i<=47))return!1;var r={};16===t||24===t?(n=Math.floor((i-32)/2),r.background=Gi[n],i%2==1&&(r.background=r.background+"_semi")):45===i?r.background="transparent":(r.foreground="black",47===i&&(r.underline=!0));var e=t<=23?1:2;return this.channels[e].setBkgData(r),Yi(t,i,this.cmdHistory),!0},i.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var i=this.channels[t];i&&i.reset()}this.cmdHistory={a:null,b:null}},i.cueSplitAtTime=function(t){for(var i=0;i<this.channels.length;i++){var n=this.channels[i];n&&n.cueSplitAtTime(t)}},t}(),Zi=function(){function t(t,i){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=i}var i=t.prototype;return i.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},i.newCue=function(t,i,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=i,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},i.reset=function(){this.cueRanges=[],this.startTime=null},t}(),tn=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],i=["start","middle","end","left","right"];function n(t,i){if("string"!=typeof i)return!1;if(!Array.isArray(t))return!1;var n=i.toLowerCase();return!!~t.indexOf(n)&&n}function r(t){return n(i,t)}function e(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var h in s)t[h]=s[h]}return t}function s(i,s,h){var a=this,o={enumerable:!0};a.hasBeenReset=!1;var u="",f=!1,c=i,l=s,v=h,d=null,p="",m=!0,b="auto",g="start",y=50,w="middle",k=50,O="middle";Object.defineProperty(a,"id",e({},o,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(a,"pauseOnExit",e({},o,{get:function(){return f},set:function(t){f=!!t}})),Object.defineProperty(a,"startTime",e({},o,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",e({},o,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",e({},o,{get:function(){return v},set:function(t){v=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",e({},o,{get:function(){return d},set:function(t){d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",e({},o,{get:function(){return p},set:function(i){var r=function(i){return n(t,i)}(i);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");p=r,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",e({},o,{get:function(){return m},set:function(t){m=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",e({},o,{get:function(){return b},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",e({},o,{get:function(){return g},set:function(t){var i=r(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",e({},o,{get:function(){return y},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",e({},o,{get:function(){return w},set:function(t){var i=r(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");w=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",e({},o,{get:function(){return k},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");k=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",e({},o,{get:function(){return O},set:function(t){var i=r(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");O=i,this.hasBeenReset=!0}})),a.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}(),nn=function(){function t(){}return t.prototype.decode=function(t,i){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function rn(t){function i(t,i,n,r){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(r||0)}var n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?i(n[2],n[3],0,n[4]):i(n[1],n[2],n[3],n[4]):null}var en=function(){function t(){this.values=Object.create(null)}var i=t.prototype;return i.set=function(t,i){this.get(t)||""===i||(this.values[t]=i)},i.get=function(t,i,n){return n?this.has(t)?this.values[t]:i[n]:this.has(t)?this.values[t]:i},i.has=function(t){return t in this.values},i.alt=function(t,i,n){for(var r=0;r<n.length;++r)if(i===n[r]){this.set(t,i);break}},i.integer=function(t,i){/^-?\d+$/.test(i)&&this.set(t,parseInt(i,10))},i.percent=function(t,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){var n=parseFloat(i);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},t}();function sn(t,i,n,r){var e=r?t.split(r):[t];for(var s in e)if("string"==typeof e[s]){var h=e[s].split(n);2===h.length&&i(h[0],h[1])}}var hn=new tn(0,0,""),an="middle"===hn.align?"middle":"center";function on(t,i,n){var r=t;function e(){var i=rn(t);if(null===i)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),i}function s(){t=t.replace(/^\s+/,"")}if(s(),i.startTime=e(),s(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.slice(3),s(),i.endTime=e(),s(),function(t,i){var r=new en;sn(t,(function(t,i){var e;switch(t){case"region":for(var s=n.length-1;s>=0;s--)if(n[s].id===i){r.set(t,n[s].region);break}break;case"vertical":r.alt(t,i,["rl","lr"]);break;case"line":e=i.split(","),r.integer(t,e[0]),r.percent(t,e[0])&&r.set("snapToLines",!1),r.alt(t,e[0],["auto"]),2===e.length&&r.alt("lineAlign",e[1],["start",an,"end"]);break;case"position":e=i.split(","),r.percent(t,e[0]),2===e.length&&r.alt("positionAlign",e[1],["start",an,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,i);break;case"align":r.alt(t,i,["start",an,"end","left","right"])}}),/:/,/\s/),i.region=r.get("region",null),i.vertical=r.get("vertical","");var e=r.get("line","auto");"auto"===e&&-1===hn.line&&(e=-1),i.line=e,i.lineAlign=r.get("lineAlign","start"),i.snapToLines=r.get("snapToLines",!0),i.size=r.get("size",100),i.align=r.get("align",an);var s=r.get("position","auto");"auto"===s&&50===hn.position&&(s="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=s}(t,i)}function un(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var fn=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new nn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var i=t.prototype;return i.parse=function(t){var i=this;function n(){var t=i.buffer,n=0;for(t=un(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var r=t.slice(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,i.buffer=t.slice(n),r}t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var e=(r=n()).match(/^()?WEBVTT([ \t].*)?$/);if(!e||!e[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:r=n(),i.state){case"HEADER":/:/.test(r)?sn(r,(function(t,i){}),/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new tn(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{on(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var h=-1!==r.indexOf("--\x3e");if(!r||h&&(s=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(null===i.cue)continue;i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID")}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},i.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){this.onparsingerror&&this.onparsingerror(t)}return this.onflush&&this.onflush(),this},t}(),cn=n(11),ln=n(13),vn=/\r\n|\n\r|\n|\r/g,dn=function(t,i,n){return void 0===n&&(n=0),t.slice(n,n+i.length)===i},pn=function(t){for(var i=5381,n=t.length;n;)i=33*i^t.charCodeAt(--n);return(i>>>0).toString()};function mn(t,i,n){return pn(t.toString())+pn(i.toString())+pn(n)}function bn(t,i,n,r,e,h,a,o){var u,f=new fn,c=Object(B.f)(new Uint8Array(t)).trim().replace(vn,"\n").split("\n"),l=[],v=Object(cn.a)(i,n),d="00:00.000",p=0,m=0,b=!0;f.oncue=function(t){var i=r[e],n=r.ccOffset,s=(p-v)/9e4;null!=i&&i.new&&(void 0!==m?n=r.ccOffset=i.start:function(t,i,n){var r=t[i],e=t[r.prevCC];if(!e||!e.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!==(s=e)&&void 0!==s&&s.new;){var s;t.ccOffset+=r.start-e.start,r.new=!1,e=t[(r=e).prevCC]}t.presentationOffset=n}(r,e,s)),s&&(n=s-r.presentationOffset);var a=t.endTime-t.startTime,o=Object(ln.d)(9e4*(t.startTime+n-m),9e4*h)/9e4;t.startTime=Math.max(o,0),t.endTime=Math.max(o+a,0);var u=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(u)),t.id||(t.id=mn(t.startTime,t.endTime,u)),t.endTime>0&&l.push(t)},f.onparsingerror=function(t){u=t},f.onflush=function(){u?o(u):a(l)},c.forEach((function(t){if(b){if(dn(t,"X-TIMESTAMP-MAP=")){b=!1,t.slice(16).split(",").forEach((function(t){dn(t,"LOCAL:")?d=t.slice(6):dn(t,"MPEGTS:")&&(p=parseInt(t.slice(7)))}));try{m=function(t){var i=parseInt(t.slice(-3)),n=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),e=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(Object(s.a)(i)&&Object(s.a)(n)&&Object(s.a)(r)&&Object(s.a)(e)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return i+=1e3*n,i+=6e4*r,i+=36e5*e}(d)/1e3}catch(t){u=t}return}""===t&&(b=!1)}f.parse(t+"\n")})),f.flush()}function gn(){return(gn=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var yn=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,wn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,kn={left:"start",center:"center",right:"end",start:"start",end:"end"};function On(t,i,n,r,e){var s=Object(u.c)(new Uint8Array(t),["mdat"]);if(0!==s.length){var h=s.map((function(t){return Object(B.f)(t)})),a=Object(cn.c)(i,1,n);try{h.forEach((function(t){return r(function(t,i){var n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},e=Object.keys(r).reduce((function(t,i){return t[i]=n.getAttribute("ttp:"+i)||r[i],t}),{}),s="preserve"!==n.getAttribute("xml:space"),h=En(Tn(n,"styling","style")),a=En(Tn(n,"layout","region")),o=Tn(n,"body","[begin]");return[].map.call(o,(function(t){var n=function t(i,n){return[].slice.call(i.childNodes).reduce((function(i,r,e){var s;return"br"===r.nodeName&&e?i+"\n":null!==(s=r.childNodes)&&void 0!==s&&s.length?t(r,n):n?i+r.textContent.trim().replace(/\s+/g," "):i+r.textContent}),"")}(t,s);if(!n||!t.hasAttribute("begin"))return null;var r=Mn(t.getAttribute("begin"),e),o=Mn(t.getAttribute("dur"),e),u=Mn(t.getAttribute("end"),e);if(null===r)throw An(t);if(null===u){if(null===o)throw An(t);u=r+o}var f=new tn(r-i,u-i,n);f.id=mn(f.startTime,f.endTime,f.text);var c=a[t.getAttribute("region")],l=h[t.getAttribute("style")];f.position=10,f.size=80;var v=function(t,i,n){var r="http://www.w3.org/ns/ttml#styling",e=null,s=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return s&&n.hasOwnProperty(s)&&(e=n[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(n,s){var h=Sn(i,r,s)||Sn(t,r,s)||Sn(e,r,s);return h&&(n[s]=h),n}),{})}(c,l,h),d=v.textAlign;if(d){var p=kn[d];p&&(f.lineAlign=p),f.align=d}return gn(f,v),f})).filter((function(t){return null!==t}))}(t,a))}))}catch(t){e(t)}}else e(new Error("Could not parse IMSC1 mdat"))}function Tn(t,i,n){var r=t.getElementsByTagName(i)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function En(t){return t.reduce((function(t,i){var n=i.getAttribute("xml:id");return n&&(t[n]=i),t}),{})}function Sn(t,i,n){return t&&t.hasAttributeNS(i,n)?t.getAttributeNS(i,n):null}function An(t){return new Error("Could not parse ttml timestamp "+t)}function Mn(t,i){if(!t)return null;var n=rn(t);return null===n&&(yn.test(t)?n=function(t,i){var n=yn.exec(t),r=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/i.frameRate}(t,i):wn.test(t)&&(n=function(t,i){var n=wn.exec(t),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/i.frameRate;case"t":return r/i.tickRate}return r}(t,i))),n}var jn=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new Zi(this,"textTrack1"),n=new Zi(this,"textTrack2"),r=new Zi(this,"textTrack3"),e=new Zi(this,"textTrack4");this.cea608Parser1=new Qi(1,i,n),this.cea608Parser2=new Qi(3,r,e)}t.on(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(h.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(h.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(h.a.FRAG_LOADING,this.onFragLoading,this),t.on(h.a.FRAG_LOADED,this.onFragLoaded,this),t.on(h.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(h.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(h.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(h.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this)}var i=t.prototype;return i.destroy=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(h.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(h.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(h.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(h.a.FRAG_LOADING,this.onFragLoading,this),t.off(h.a.FRAG_LOADED,this.onFragLoaded,this),t.off(h.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(h.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(h.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(h.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(h.a.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},i.addCues=function(t,i,n,r,e){for(var s,a,o,u,f=!1,c=e.length;c--;){var l=e[c],v=(s=l[0],a=l[1],o=i,u=n,Math.min(a,u)-Math.max(s,o));if(v>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],n),f=!0,v/(n-i)>.5))return}if(f||e.push([i,n]),this.config.renderTextTracksNatively){var d=this.captionsTracks[t];this.Cues.newCue(d,i,n,r)}else{var p=this.Cues.newCue(null,i,n,r);this.hls.trigger(h.a.CUES_PARSED,{type:"captions",cues:p,track:t})}},i.onInitPtsFound=function(t,i){var n=this,r=i.frag,e=i.id,s=i.initPTS,a=i.timescale,o=this.unparsedVttFrags;"main"===e&&(this.initPTS[r.cc]=s,this.timescale[r.cc]=a),o.length&&(this.unparsedVttFrags=[],o.forEach((function(t){n.onFragLoaded(h.a.FRAG_LOADED,t)})))},i.getExistingTrack=function(t){var i=this.media;if(i)for(var n=0;n<i.textTracks.length;n++){var r=i.textTracks[n];if(r[t])return r}return null},i.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},i.createNativeTrack=function(t){if(!this.captionsTracks[t]){var i=this.captionsProperties,n=this.captionsTracks,r=this.media,e=i[t],s=e.label,h=e.languageCode,a=this.getExistingTrack(t);if(a)n[t]=a,U(n[t]),N(n[t],r);else{var o=this.createTextTrack("captions",s,h);o&&(o[t]=!0,n[t]=o)}}},i.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var i=this.captionsProperties[t];if(i){var n={_id:t,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(h.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(t,i,n){var r=this.media;if(r)return r.addTextTrack(t,i,n)},i.onMediaAttaching=function(t,i){this.media=i.media,this._cleanTracks()},i.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(i){U(t[i]),delete t[i]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},i._cleanTracks=function(){var t=this.media;if(t){var i=t.textTracks;if(i)for(var n=0;n<i.length;n++)U(i[n])}},i.onSubtitleTracksUpdated=function(t,i){var n=this;this.textTracks=[];var r=i.subtitleTracks||[],e=r.some((function(t){return"stpp.ttml.im1t"===t.textCodec}));if(this.config.enableWebVTT||e&&this.config.enableIMSC1){var s=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,i){var r;if(i<a.length){for(var e=null,s=0;s<a.length;s++)if(Dn(a[s],t)){e=a[s];break}e&&(r=e)}if(r)U(r);else{var h=n._captionsOrSubtitlesFromCharacteristics(t);(r=n.createTextTrack(h,t.name,t.lang))&&(r.mode="disabled")}r&&(r.groupId=t.groupId,n.textTracks.push(r))}))}else if(!s&&this.tracks&&this.tracks.length){var o=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(h.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},i._captionsOrSubtitlesFromCharacteristics=function(t){var i;if(null!==(i=t.attrs)&&void 0!==i&&i.CHARACTERISTICS){var n=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(n&&r)return"captions"}return"subtitles"},i.onManifestLoaded=function(t,i){var n=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach((function(t){var i=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(i){var r="textTrack"+i[1],e=n.captionsProperties[r];e&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t)}}))},i.onFragLoading=function(t,i){var n=this.cea608Parser1,r=this.cea608Parser2,e=this.lastSn,s=this.lastPartIndex;if(this.enabled&&n&&r&&i.frag.type===I.b.MAIN){var h,a,o=i.frag.sn,u=null!=(h=null==i||null===(a=i.part)||void 0===a?void 0:a.index)?h:-1;o===e+1||o===e&&u===s+1||(n.reset(),r.reset()),this.lastSn=o,this.lastPartIndex=u}},i.onFragLoaded=function(t,i){var n=i.frag,r=i.payload,e=this.initPTS,a=this.unparsedVttFrags;if(n.type===I.b.SUBTITLE)if(r.byteLength){if(!Object(s.a)(e[n.cc]))return a.push(i),void(e.length&&this.hls.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var o=n.decryptdata,u="stats"in i;if(null==o||null==o.key||"AES-128"!==o.method||u){var f=this.tracks[n.level],c=this.vttCCs;c[n.cc]||(c[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),f&&"stpp.ttml.im1t"===f.textCodec?this._parseIMSC1(n,r):this._parseVTTs(n,r,c)}}else this.hls.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},i._parseIMSC1=function(t,i){var n=this,r=this.hls;On(i,this.initPTS[t.cc],this.timescale[t.cc],(function(i){n._appendCues(i,t.level),r.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(i){o.b.log("Failed to parse IMSC1: "+i),r.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:i})}))},i._parseVTTs=function(t,i,n){var r,e=this,s=this.hls;bn(null!==(r=t.initSegment)&&void 0!==r&&r.data?Object(u.b)(t.initSegment.data,new Uint8Array(i)):i,this.initPTS[t.cc],this.timescale[t.cc],n,t.cc,t.start,(function(i){e._appendCues(i,t.level),s.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(n){e._fallbackToIMSC1(t,i),o.b.log("Failed to parse VTT cue: "+n),s.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})}))},i._fallbackToIMSC1=function(t,i){var n=this,r=this.tracks[t.level];r.textCodec||On(i,this.initPTS[t.cc],this.timescale[t.cc],(function(){r.textCodec="stpp.ttml.im1t",n._parseIMSC1(t,i)}),(function(){r.textCodec="wvtt"}))},i._appendCues=function(t,i){var n=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[i];if(!r||"disabled"===r.mode)return;t.forEach((function(t){return P(r,t)}))}else{var e=this.tracks[i];if(!e)return;var s=e.default?"default":"subtitles"+i;n.trigger(h.a.CUES_PARSED,{type:"subtitles",cues:t,track:s})}},i.onFragDecrypted=function(t,i){var n=i.frag;if(n.type===I.b.SUBTITLE){if(!Object(s.a)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(h.a.FRAG_LOADED,i)}},i.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},i.onFragParsingUserdata=function(t,i){var n=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&n&&r)for(var e=0;e<i.samples.length;e++){var s=i.samples[e].bytes;if(s){var h=this.extractCea608Data(s);n.addData(i.samples[e].pts,h[0]),r.addData(i.samples[e].pts,h[1])}}},i.onBufferFlushing=function(t,i){var n=i.startOffset,r=i.endOffset,e=i.endOffsetSubtitles,s=i.type,h=this.media;if(h&&!(h.currentTime<r)){if(!s||"video"===s){var a=this.captionsTracks;Object.keys(a).forEach((function(t){return F(a[t],n,r)}))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==e){var o=this.textTracks;Object.keys(o).forEach((function(t){return F(o[t],n,e)}))}}},i.extractCea608Data=function(t){for(var i=[[],[]],n=31&t[0],r=2,e=0;e<n;e++){var s=t[r++],h=127&t[r++],a=127&t[r++];if((0!==h||0!==a)&&4&s){var o=3&s;0!==o&&1!==o||(i[o].push(h),i[o].push(a))}}return i},t}();function Dn(t,i){return t&&t.label===i.name&&!(t.textTrack1||t.textTrack2)}function xn(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ln,In=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var i,n,r,e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},e.registerListeners=function(){var t=this.hls;t.on(h.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(h.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(h.a.MEDIA_DETACHING,this.onMediaDetaching,this)},e.unregisterListener=function(){var t=this.hls;t.off(h.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(h.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(h.a.MEDIA_DETACHING,this.onMediaDetaching,this)},e.onFpsDropLevelCapping=function(i,n){t.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},e.onMediaAttaching=function(t,i){this.media=i.media instanceof HTMLVideoElement?i.media:null},e.onManifestParsed=function(t,i){var n=this.hls;this.restrictedLevels=[],this.firstLevel=i.firstLevel,n.config.capLevelToPlayerSize&&i.video&&this.startCapping()},e.onBufferCodecs=function(t,i){this.hls.config.capLevelToPlayerSize&&i.video&&this.startCapping()},e.onMediaDetaching=function(){this.stopCapping()},e.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var i=this.hls;i.autoLevelCapping=this.getMaxLevel(t.length-1),i.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=i.autoLevelCapping}}},e.getMaxLevel=function(i){var n=this,r=this.hls.levels;if(!r.length)return-1;var e=r.filter((function(r,e){return t.isLevelAllowed(e,n.restrictedLevels)&&e<=i}));return this.clientRect=null,t.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},e.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},e.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,i={width:0,height:0};if(t){var n=t.getBoundingClientRect();i.width=n.width,i.height=n.height,i.width||i.height||(i.width=n.right-n.left||t.width||0,i.height=n.bottom-n.top||t.height||0)}return this.clientRect=i,i},t.isLevelAllowed=function(t,i){return void 0===i&&(i=[]),-1===i.indexOf(t)},t.getMaxLevelByMediaSize=function(t,i,n){if(!t||!t.length)return-1;for(var r,e,s=t.length-1,h=0;h<t.length;h+=1){var a=t[h];if((a.width>=i||a.height>=n)&&(r=a,!(e=t[h+1])||r.width!==e.width||r.height!==e.height)){s=h;break}}return s},i=t,(n=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}])&&xn(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(),_n=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var i=t.prototype;return i.setStreamController=function(t){this.streamController=t},i.registerListeners=function(){this.hls.on(h.a.MEDIA_ATTACHING,this.onMediaAttaching,this)},i.unregisterListeners=function(){this.hls.off(h.a.MEDIA_ATTACHING,this.onMediaAttaching)},i.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},i.onMediaAttaching=function(t,i){var n=this.hls.config;if(n.capLevelOnFPSDrop){var r=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},i.checkFPS=function(t,i,n){var r=performance.now();if(i){if(this.lastTime){var e=r-this.lastTime,s=n-this.lastDroppedFrames,a=i-this.lastDecodedFrames,u=1e3*s/e,f=this.hls;if(f.trigger(h.a.FPS_DROP,{currentDropped:s,currentDecoded:a,totalDroppedFrames:n}),u>0&&s>f.config.fpsDroppedMonitoringThreshold*a){var c=f.currentLevel;o.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===f.autoLevelCapping||f.autoLevelCapping>=c)&&(c-=1,f.trigger(h.a.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:f.currentLevel}),f.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=i}},i.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var i=t.getVideoPlaybackQuality();this.checkFPS(t,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}();!function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(Ln||(Ln={}));var Rn="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Cn(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Nn,Pn,Un,Fn=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var i,n,r,e=t.prototype;return e.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},e._registerListeners=function(){this.hls.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(h.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(h.a.MANIFEST_PARSED,this.onManifestParsed,this)},e._unregisterListeners=function(){this.hls.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(h.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(h.a.MANIFEST_PARSED,this.onManifestParsed,this)},e.getLicenseServerUrl=function(t){switch(t){case Ln.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},e._attemptKeySystemAccess=function(t,i,n){var r=this,e=function(t,i,n,r){switch(t){case Ln.WIDEVINE:return function(t,i,n){var r={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})})),i.forEach((function(t){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})})),[r]}(i,n,r);default:throw new Error("Unknown key-system: "+t)}}(t,i,n,this._drmSystemOptions);o.b.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,e);this.mediaKeysPromise=s.then((function(i){return r._onMediaKeySystemAccessObtained(t,i)})),s.catch((function(i){o.b.error('Failed to obtain key-system "'+t+'" access:',i)}))},e._onMediaKeySystemAccessObtained=function(t,i){var n=this;o.b.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:i,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var e=Promise.resolve().then((function(){return i.createMediaKeys()})).then((function(i){return r.mediaKeys=i,o.b.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),i}));return e.catch((function(t){o.b.error("Failed to create media-keys:",t)})),e},e._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(i){i.mediaKeysSession||(i.mediaKeysSession=i.mediaKeys.createSession(),t._onNewMediaKeySession(i.mediaKeysSession))}))},e._onNewMediaKeySession=function(t){var i=this;o.b.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(n){i._onKeySessionMessage(t,n.message)}),!1)},e._onKeySessionMessage=function(t,i){o.b.log("Got EME message event, creating license request"),this._requestLicense(i,(function(i){o.b.log("Received license data (length: "+(i?i.byteLength:i)+"), updating key-session"),t.update(i).catch((function(t){o.b.warn("Updating key-session failed: "+t)}))}))},e.onMediaEncrypted=function(t){var i=this;if(o.b.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return o.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var n=function(n){i._media&&(i._attemptSetMediaKeys(n),i._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(n).catch(n)},e._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var i=this._mediaKeysList[0];if(!i||!i.mediaKeys)return o.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_KEYS,fatal:!0});o.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(i.mediaKeys),this._hasSetMediaKeys=!0}},e._generateRequestWithPreferredKeySession=function(t,i){var n=this,r=this._mediaKeysList[0];if(!r)return o.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)o.b.warn("Key-Session already initialized but requested again");else{var e=r.mediaKeysSession;if(!e)return o.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!i)return o.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});o.b.log('Generating key-session request for "'+t+'" init data type'),r.mediaKeysSessionInitialized=!0,e.generateRequest(t,i).then((function(){o.b.debug("Key-session generation succeeded")})).catch((function(t){o.b.error("Error generating key-session request:",t),n.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},e._createLicenseXhr=function(t,i,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,i,n);var e=this._licenseXhrSetup;if(e)try{e.call(this.hls,r,t),e=void 0}catch(t){o.b.error(t)}try{r.readyState||r.open("POST",t,!0),e&&e.call(this.hls,r,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return r},e._onLicenseRequestReadyStageChange=function(t,i,n,r){switch(t.readyState){case 4:if(200===t.status){this._requestLicenseFailureCount=0,o.b.log("License request succeeded");var e=t.response,s=this._licenseResponseCallback;if(s)try{e=s.call(this.hls,t,i)}catch(t){o.b.error(t)}r(e)}else{if(o.b.error("License Request XHR failed ("+i+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var u=3-this._requestLicenseFailureCount+1;o.b.warn("Retrying license request, "+u+" attempts left"),this._requestLicense(n,r)}}},e._generateLicenseRequestChallenge=function(t,i){switch(t.mediaKeySystemDomain){case Ln.WIDEVINE:return i}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},e._requestLicense=function(t,i){o.b.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return o.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),e=this._createLicenseXhr(r,t,i);o.b.log("Sending license request to URL: "+r);var s=this._generateLicenseRequestChallenge(n,t);e.send(s)}catch(t){o.b.error("Failure requesting DRM license: "+t),this.hls.trigger(h.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},e.onMediaAttached=function(t,i){if(this._emeEnabled){var n=i.media;this._media=n,n.addEventListener("encrypted",this._onMediaEncrypted)}},e.onMediaDetached=function(){var t=this._media,i=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(i.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},e.onManifestParsed=function(t,i){if(this._emeEnabled){var n=i.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),r=i.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(Ln.WIDEVINE,n,r)}},i=t,(n=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Cn(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function Bn(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $n(t,i,n){return i&&Bn(t.prototype,i),n&&Bn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gn(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,i){if(t){if("string"==typeof t)return Vn(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vn(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Vn(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,r=new Array(i);n<i;n++)r[n]=t[n];return r}function Xn(){return(Xn=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(Nn||(Nn={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(Pn||(Pn={})),function(t){t.VOD="v",t.LIVE="l"}(Un||(Un={}));var Wn=function(){function t(i){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(t){try{n.apply(t,{ot:Nn.MANIFEST,su:!n.initialized})}catch(t){o.b.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var i=t.frag,r=n.hls.levels[i.level],e=n.getObjectType(i),s={d:1e3*i.duration,ot:e};e!==Nn.VIDEO&&e!==Nn.AUDIO&&e!=Nn.MUXED||(s.br=r.bitrate/1e3,s.tb=n.getTopBandwidth(e)/1e3,s.bl=n.getBufferLength(e)),n.apply(t,s)}catch(t){o.b.warn("Could not generate segment CMCD data.",t)}},this.hls=i;var r=this.config=i.config,e=r.cmcd;null!=e&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=e.sessionId||t.uuid(),this.cid=e.contentId,this.useHeaders=!0===e.useHeaders,this.registerListeners())}var i=t.prototype;return i.registerListeners=function(){var t=this.hls;t.on(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(h.a.MEDIA_DETACHED,this.onMediaDetached,this),t.on(h.a.BUFFER_CREATED,this.onBufferCreated,this)},i.unregisterListeners=function(){var t=this.hls;t.off(h.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(h.a.MEDIA_DETACHED,this.onMediaDetached,this),t.off(h.a.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},i.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},i.onMediaAttached=function(t,i){this.media=i.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},i.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},i.onBufferCreated=function(t,i){var n,r;this.audioBuffer=null===(n=i.tracks.audio)||void 0===n?void 0:n.buffer,this.videoBuffer=null===(r=i.tracks.video)||void 0===r?void 0:r.buffer},i.createData=function(){var t;return{v:1,sf:Pn.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},i.apply=function(i,n){void 0===n&&(n={}),Xn(n,this.createData());var r=n.ot===Nn.INIT||n.ot===Nn.VIDEO||n.ot===Nn.MUXED;if(this.starved&&r&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering),this.useHeaders){var e=t.toHeaders(n);if(!Object.keys(e).length)return;i.headers||(i.headers={}),Xn(i.headers,e)}else{var s=t.toQuery(n);if(!s)return;i.url=t.appendQueryToUri(i.url,s)}},i.getObjectType=function(t){var i=t.type;return"subtitle"===i?Nn.TIMED_TEXT:"initSegment"===t.sn?Nn.INIT:"audio"===i?Nn.AUDIO:"main"===i?this.hls.audioTracks.length?Nn.VIDEO:Nn.MUXED:void 0},i.getTopBandwidth=function(t){var i,n=0,r=this.hls;if(t===Nn.AUDIO)i=r.audioTracks;else{var e=r.maxAutoLevel,s=e>-1?e+1:r.levels.length;i=r.levels.slice(0,s)}for(var h,a=Gn(i);!(h=a()).done;){var o=h.value;o.bitrate>n&&(n=o.bitrate)}return n>0?n:NaN},i.getBufferLength=function(t){var i=this.hls.media,n=t===Nn.AUDIO?this.audioBuffer:this.videoBuffer;return n&&i?1e3*bt.bufferInfo(n,i.currentTime,this.config.maxBufferHole).len:NaN},i.createPlaylistLoader=function(){var t=this.config.pLoader,i=this.applyPlaylistData,n=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new n(t)}var r=t.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(t,n,r){i(t),this.loader.load(t,n,r)},$n(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},i.createFragmentLoader=function(){var t=this.config.fLoader,i=this.applyFragmentData,n=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new n(t)}var r=t.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(t,n,r){i(t),this.loader.load(t,n,r)},$n(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),i=t.toString();return URL.revokeObjectURL(t),i.slice(i.lastIndexOf("/")+1)},t.serialize=function(t){for(var i,n=[],r=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},e=function(t){return Math.round(t)},s=function(t){return 100*e(t/100)},h={br:e,d:e,bl:s,dl:s,mtp:s,nor:function(t){return encodeURIComponent(t)},rtp:s,tb:e},a=Gn(Object.keys(t||{}).sort());!(i=a()).done;){var o=i.value,u=t[o];if(r(u)&&!("v"===o&&1===u||"pr"==o&&1===u)){var f=h[o];f&&(u=f(u));var c=typeof u,l=void 0;l="ot"===o||"sf"===o||"st"===o?o+"="+u:"boolean"===c?o:"number"===c?o+"="+u:o+"="+JSON.stringify(u),n.push(l)}}return n.join(",")},t.toHeaders=function(i){for(var n={},r=["Object","Request","Session","Status"],e=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},h=0,a=Object.keys(i);h<a.length;h++){var o=a[h];e[null!=s[o]?s[o]:1][o]=i[o]}for(var u=0;u<e.length;u++){var f=t.serialize(e[u]);f&&(n["CMCD-"+r[u]]=f)}return n},t.toQuery=function(i){return"CMCD="+encodeURIComponent(t.serialize(i))},t.appendQueryToUri=function(t,i){if(!i)return t;var n=t.includes("?")?"&":"?";return""+t+n+i},t}(),qn=n(14),Kn=/^age:\s*[\d.]+\s*$/m,zn=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new qn.a,this.retryDelay=0}var i=t.prototype;return i.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},i.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},i.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},i.load=function(t,i,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=i,this.callbacks=n,this.retryDelay=i.retryDelay,this.loadInternal()},i.loadInternal=function(){var t=this.config,i=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var e=this.xhrSetup;try{if(e)try{e(n,i.url)}catch(t){n.open("GET",i.url,!0),e(n,i.url)}n.readyState||n.open("GET",i.url,!0);var s=this.context.headers;if(s)for(var h in s)n.setRequestHeader(h,s[h])}catch(t){return void this.callbacks.onError({code:n.status,text:t.message},i,n)}i.rangeEnd&&n.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=i.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),n.send()}},i.readystatechange=function(){var t=this.context,i=this.loader,n=this.stats;if(t&&i){var r=i.readyState,e=this.config;if(!n.aborted&&r>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===r){i.onreadystatechange=null,i.onprogress=null;var s=i.status;if(s>=200&&s<300){var h,a;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),a="arraybuffer"===t.responseType?(h=i.response).byteLength:(h=i.responseText).length,n.loaded=n.total=a,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(n,t,h,i),!this.callbacks)return;var f={url:i.responseURL,data:h};this.callbacks.onSuccess(f,n,t,i)}else n.retry>=e.maxRetry||s>=400&&s<499?(o.b.error(s+" while loading "+t.url),this.callbacks.onError({code:s,text:i.statusText},t,i)):(o.b.warn(s+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,e.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout)}},i.loadtimeout=function(){o.b.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},i.loadprogress=function(t){var i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total)},i.getCacheAge=function(){var t=null;if(this.loader&&Kn.test(this.loader.getAllResponseHeaders())){var i=this.loader.getResponseHeader("age");t=i?parseFloat(i):null}return t},t}();function Hn(t){var i="function"==typeof Map?new Map:void 0;return(Hn=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return Yn(t,arguments,Zn(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Qn(r,t)})(t)}function Yn(t,i,n){return(Yn=Jn()?Reflect.construct.bind():function(t,i,n){var r=[null];r.push.apply(r,i);var e=new(Function.bind.apply(t,r));return n&&Qn(e,n.prototype),e}).apply(null,arguments)}function Jn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Qn(t,i){return(Qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function Zn(t){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tr(){return(tr=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ir=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||nr,this.controller=new self.AbortController,this.stats=new qn.a}var i=t.prototype;return i.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},i.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},i.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},i.load=function(t,i,n){var r=this,e=this.stats;if(e.loading.start)throw new Error("Loader can only be used once.");e.loading.start=self.performance.now();var h=function(t,i){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:i,headers:new self.Headers(tr({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}(t,this.controller.signal),a=n.onProgress,o="arraybuffer"===t.responseType,u=o?"byteLength":"length";this.context=t,this.config=i,this.callbacks=n,this.request=this.fetchSetup(t,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){r.abortInternal(),n.onTimeout(e,t,r.response)}),i.timeout),self.fetch(this.request).then((function(n){if(r.response=r.loader=n,!n.ok){var h=n.status,u=n.statusText;throw new rr(u||"fetch, bad network response",h,n)}return e.loading.first=Math.max(self.performance.now(),e.loading.start),e.total=parseInt(n.headers.get("Content-Length")||"0"),a&&Object(s.a)(i.highWaterMark)?r.loadProgressively(n,e,t,i.highWaterMark,a):o?n.arrayBuffer():n.text()})).then((function(h){var o=r.response;self.clearTimeout(r.requestTimeout),e.loading.end=Math.max(self.performance.now(),e.loading.first),e.loaded=e.total=h[u];var f={url:o.url,data:h};a&&!Object(s.a)(i.highWaterMark)&&a(e,t,h,o),n.onSuccess(f,e,t,o)})).catch((function(i){if(self.clearTimeout(r.requestTimeout),!e.aborted){var s=i&&i.code||0,h=i?i.message:null;n.onError({code:s,text:h},t,i?i.details:null)}}))},i.getCacheAge=function(){var t=null;if(this.response){var i=this.response.headers.get("age");t=i?parseFloat(i):null}return t},i.loadProgressively=function(t,i,n,r,e){void 0===r&&(r=0);var s=new mi,h=t.body.getReader();return function a(){return h.read().then((function(h){if(h.done)return s.dataLength&&e(i,n,s.flush(),t),Promise.resolve(new ArrayBuffer(0));var o=h.value,u=o.length;return i.loaded+=u,u<r||s.dataLength?(s.push(o),s.dataLength>=r&&e(i,n,s.flush(),t)):e(i,n,o,t),a()})).catch((function(){return Promise.reject()}))}()},t}();function nr(t,i){return new self.Request(t.url,i)}var rr=function(t){var i,n;function r(i,n,r){var e;return(e=t.call(this,i)||this).code=void 0,e.details=void 0,e.code=n,e.details=r,e}return n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,Qn(i,n),r}(Hn(Error)),er=ir,sr=/\s/;function hr(){return(hr=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function ar(t,i){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);i&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,r)}return n}function or(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?ar(Object(n),!0).forEach((function(i){ur(t,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ar(Object(n)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}function ur(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}var fr=or(or({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:zn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:pi,bufferController:Ci,capLevelController:In,fpsController:_n,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Rn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(t,i,n,r){for(var e,s,h,a,o,u=[],f=self.VTTCue||self.TextTrackCue,c=0;c<r.rows.length;c++)if(h=!0,a=0,o="",!(e=r.rows[c]).isEmpty()){for(var l=0;l<e.chars.length;l++)sr.test(e.chars[l].uchar)&&h?a++:(o+=e.chars[l].uchar,h=!1);e.cueStartTime=i,i===n&&(n+=1e-4),a>=16?a--:a++;var v=un(o.trim()),d=mn(i,n,v);t&&t.cues&&t.cues.getCueById(d)||((s=new f(i,n,v)).id=d,s.line=c+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*a/32)),u.push(s))}return t&&u.length&&(u.sort((function(t,i){return"auto"===t.line||"auto"===i.line?0:t.line>8&&i.line>8?i.line-t.line:t.line-i.line})),u.forEach((function(i){return P(t,i)}))),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Si,subtitleTrackController:Li,timelineController:jn,audioStreamController:yi,audioTrackController:Oi,emeController:Fn,cmcdController:Wn});function cr(t){var i=t.loader;i!==er&&i!==zn?(o.b.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}()&&(t.loader=er,t.progressive=!0,t.enableSoftwareAES=!0,o.b.log("[config]: Progressive streaming enabled, using FetchLoader"))}function lr(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var vr=function(){function t(i){void 0===i&&(i={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new si.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=function(t,i){if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==i.liveMaxLatencyDurationCount&&(void 0===i.liveSyncDurationCount||i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(void 0===i.liveSyncDuration||i.liveMaxLatencyDuration<=i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return hr({},t,i)}(t.DefaultConfig,i);this.userConfig=i,Object(o.a)(n.debug),this._autoLevelCapping=-1,n.progressive&&cr(n);var r=n.abrController,e=n.bufferController,s=n.capLevelController,h=n.fpsController,a=this.abrController=new r(this),u=this.bufferController=new e(this),f=this.capLevelController=new s(this),c=new h(this),l=new R(this),v=new C(this),d=new X(this),p=this.levelController=new ct(this),m=new lt(this),b=this.streamController=new ci(this,m);f.setStreamController(b),c.setStreamController(b);var g=[l,v,p,b];this.networkControllers=g;var y=[a,u,f,c,d,m];this.audioTrackController=this.createController(n.audioTrackController,null,g),this.createController(n.audioStreamController,m,g),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,g),this.createController(n.subtitleStreamController,m,g),this.createController(n.timelineController,null,y),this.emeController=this.createController(n.emeController,null,y),this.cmcdController=this.createController(n.cmcdController,null,y),this.latencyController=this.createController(K,null,y),this.coreComponents=y}t.isSupported=function(){return function(){var t=ii();if(!t)return!1;var i=ni(),n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!i||i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove;return!!n&&!!r}()};var i,n,r,s=t.prototype;return s.createController=function(t,i,n){if(t){var r=i?new t(this,i):new t(this);return n&&n.push(r),r}return null},s.on=function(t,i,n){void 0===n&&(n=this),this._emitter.on(t,i,n)},s.once=function(t,i,n){void 0===n&&(n=this),this._emitter.once(t,i,n)},s.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},s.off=function(t,i,n,r){void 0===n&&(n=this),this._emitter.off(t,i,n,r)},s.listeners=function(t){return this._emitter.listeners(t)},s.emit=function(t,i,n){return this._emitter.emit(t,i,n)},s.trigger=function(t,i){if(this.config.debug)return this.emit(t,t,i);try{return this.emit(t,t,i)}catch(i){o.b.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(h.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1},s.listenerCount=function(t){return this._emitter.listenerCount(t)},s.destroy=function(){o.b.log("destroy"),this.trigger(h.a.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},s.attachMedia=function(t){o.b.log("attachMedia"),this._media=t,this.trigger(h.a.MEDIA_ATTACHING,{media:t})},s.detachMedia=function(){o.b.log("detachMedia"),this.trigger(h.a.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(t){this.stopLoad();var i=this.media,n=this.url,r=this.url=e.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});o.b.log("loadSource:"+r),i&&n&&n!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(i)),this.trigger(h.a.MANIFEST_LOADING,{url:t})},s.startLoad=function(t){void 0===t&&(t=-1),o.b.log("startLoad("+t+")"),this.networkControllers.forEach((function(i){i.startLoad(t)}))},s.stopLoad=function(){o.b.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},s.swapAudioCodec=function(){o.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){o.b.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},s.removeLevel=function(t,i){void 0===i&&(i=0),this.levelController.removeLevel(t,i)},i=t,r=[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return h.a}},{key:"ErrorTypes",get:function(){return a.b}},{key:"ErrorDetails",get:function(){return a.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:fr},set:function(i){t.defaultConfig=i}}],(n=[{key:"levels",get:function(){var t;return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){o.b.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){o.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){o.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){o.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){o.b.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var i=!!t;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(o.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,i=this.config.minAutoBitrate;if(!t)return 0;for(var n=t.length,r=0;r<n;r++)if(t[r].maxBitrate>=i)return r;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,i=this.autoLevelCapping;return-1===i&&t&&t.length?t.length-1:i}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var i=this.audioTrackController;i&&(i.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var i=this.subtitleTrackController;i&&(i.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var i=this.subtitleTrackController;i&&(i.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&lr(i.prototype,n),r&&lr(i,r),Object.defineProperty(i,"prototype",{writable:!1}),t}();vr.defaultConfig=void 0}]).default}))},406:(t,i,n)=>{const r=n(319),e=n(243),s=n(68);t.exports=function(){return{nt(t,i){const n=document.querySelector(".grid");if(!n)return;if(n.querySelector(".video-item")){let t=this.rt();n.append(t)}const r=this.et(t,i);if(t.isDownload){let t=r.querySelector(".download-button")||null;t&&t.setAttribute("downloading",!0)}n.append(r)},rt(){let t=document.createElement("hr");return t.className="split-line",t},et(t,i){const n=this,r=document.createElement("div");r.innerHTML=`\n            <div class="video-item">\n               <div class="video-player-wrapper">\n                  <video controls playsinline></video>\n               </div>\n               <div class="info">\n            \t\t<div class="down">\n\t\t\t\t\t\t<div class="quality-root">\n\t\t\t\t\t\t\t<div class="video">\n\t\t\t\t\t\t\t\t<span class="icon"></span>  \n\t\t\t\t\t\t\t\t<span class="text"></span>  \n\t\t\t\t\t\t\t\t<span class="dd-arrow"></span>  \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="plus">+</span>\n\t\t\t\t\t\t\t<div class="audio">\n\t\t\t\t\t\t\t\t<span class="icon"></span>  \n\t\t\t\t\t\t\t\t<span class="text">${chrome.i18n.getMessage("defaultAudioTitle")}</span>  \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="file-size"></span>                  \n\t\t\t\t\t</div>\n              \t</div>\n              \t<div class="controls">\n               \t<button class="download-button">\n\t\t\t\t\t<span class="logo"></span> \n\t\t\t\t\t<span class="text">${chrome.i18n.getMessage("dwBtnTitle")}</span> \n                </button>\n                </div>\n            </div>`;const h=r.firstElementChild,a=h.querySelector(".video-player-wrapper video"),o=h.querySelector(".quality-root .video");let u=h.querySelector(".file-size");const f=h.querySelector(".download-button"),c=t.qualities;if(!c||0===c.length)return h;const l=c[0],v=void 0;if(null!==l.m3u){let t=l.m3u.masterUrl||null;t||(t=Array.isArray(l.m3u.videoLinks)?l.m3u.videoLinks[0]:l.m3u.videoLinks);const r=void 0;n.ht(t,a)&&o.addEventListener("click",(t=>n.ft.ut(c,o,i,n.lt.ct))),o.querySelector(".text").textContent=l.quality&&String(l.quality).includes("p")?l.quality:l.quality+"p",f.onclick=t=>{f.setAttribute("downloading",!0),e.vt(l,i,n.lt.ct)}}else a.src=l.fileUrl,u.textContent=s.K(l.fileSize),o.style.display="none",a.addEventListener("loadedmetadata",(()=>{o.style.display="flex",c[0].quality=a.videoWidth.toString(),o.querySelector(".text").textContent=`${a.videoWidth}p`,o.addEventListener("click",(t=>n.ft.ut(c,o,i,n.lt.ct)))})),f.onclick=t=>{f.setAttribute("downloading",!0),e.dt.call(c[0],i,n.lt.ct)};return h},ht(t,i){if(r.isSupported()){const n=new r({startLevel:-1});return n.loadSource(t),n.attachMedia(i),n.on(r.Events.MANIFEST_PARSED,(function(t,i){i.levels.forEach(((t,i)=>{}))})),n}return i.canPlayType("application/vnd.apple.mpegurl")&&(i.src=t),null},ft:{bt(t){const i=document.querySelector(".dropdown");if(!i)return;const n=void 0;t.target&&t.target.closest(".quality-root")||(document.removeEventListener("click",this.bt,!0),i.remove())},ut(t,i,n,r){document.addEventListener("click",this.bt.bind(this));let e=document.createElement("div");e.className="dropdown";for(const[i,s]of Object.entries(t))this.gt(s,e,n,r);i.append(e)},gt(t,i,n,r){let h=document.createElement("div");h.className="item";let a=document.createElement("span");a.className="logo";let o=document.createElement("label");o.className="q-title";let u=t.quality;o.textContent=u&&"string"==typeof u?u.includes("p")?u:u+"p":"";let f=document.createElement("label");f.className="size",f.textContent=t.fileSize?s.K(t.fileSize):"",h.append(a),h.append(o),h.append(f),h.onclick=h=>{let a=h.target.closest(".video-item");i.remove();let o=a.querySelector(".quality-root .text"),u=t.quality;o.textContent=u&&"string"==typeof u?u.includes("p")?u:u+"p":"";let f=a.querySelector(".file-size");f&&(f.textContent=t.fileSize?s.K(t.fileSize):"");let c=a.querySelector(".download-button"),l=null!==t.m3u;c.onclick=i=>{c.setAttribute("downloading",!0),l?e.vt(t,n,r):e.dt.call(t,n,r)}},i.append(h)}},lt:{ct:{yt(){const t=document.querySelector(".root");t&&t.querySelectorAll(".download-button").forEach((t=>{t.disabled=!0,t.hasAttribute("downloading");{let i=t.querySelector(".logo");i&&(i.style.display="none")}})),this.wt()},kt(){const t=document.querySelector(".root");t&&t.querySelectorAll(".download-button").forEach((t=>{t.hasAttribute("downloading")&&t.removeAttribute("downloading"),t.hasAttribute("disabled")&&t.removeAttribute("disabled"),t.querySelector(".text").textContent=chrome.i18n.getMessage("dwBtnTitle");let i=t.querySelector(".logo");i&&(i.style.display="flex")})),this.Ot()},wt(){let t=document.querySelector(".controls .download-button[downloading]");if(!t)return;if(t=t.closest(".control"),!t)return;let i=document.createElement("div");i.innerHTML=`<button class="cancel-button">\n\t\t\t\t\t<span class="text">${chrome.i18n.getMessage("cancelDownload")}</span> \n                </button>`,i.firstElementChild.onclick=e.Tt,t.append(i.firstElementChild)},Ot(){let t=document.querySelector(".controls .cancel-button");t&&t.remove()},Et(t){const i=document.querySelector(".root");i&&i.querySelectorAll(".download-button[downloading] .text").forEach((i=>{i.textContent=`${chrome.i18n.getMessage("downloading")} ${t}%`}))}},St(){let t=document.querySelector(".root"),i=document.createElement("div");i.innerHTML=`<div class="agreement">\n\t\t\t\t\t<span class="icon"></span>\n\t\t\t\t\t<span class="text">${chrome.i18n.getMessage("agreementText")}</span>\n\t\t\t\t\t<a class="pp">${chrome.i18n.getMessage("pp")} \n\t\t\t\t\t\t<span class="logo"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<button class="accept">${chrome.i18n.getMessage("accept")}</button>\t\t\n\t\t\t\t</div>`,i.querySelector(".accept").addEventListener("click",e.At),i.querySelector(".pp").addEventListener("click",e.Mt),t.append(i.firstElementChild)},jt(){let t=document.querySelector(".root"),i=document.createElement("div");i.innerHTML=`<div class="downloading-another-tab">\n\t\t\t\t\t<span class="logo"></span>\n\t\t\t\t\t<p class="txt">${chrome.i18n.getMessage("downloadNotFinished")}</p>\t\t\n\t\t\t\t</div>`,t.append(i.firstElementChild)},Dt(){let t=document.querySelector(".root"),i=document.createElement("div");i.innerHTML=`<div class="play-video-2-detect-root">\n\t\t\t\t\t<span class="logo"></span>\n\t\t\t\t\t<p class="txt">${chrome.i18n.getMessage("playVideo2Detect")}</p>\n\t\t\t\t</div>`,t.append(i.firstElementChild)},xt(){let t=document.querySelector(".root"),i=document.createElement("div");i.innerHTML=`<div class="protected-video-root">\n\t\t\t\t\t<span class="logo"></span>\n\t\t\t\t\t<p class="txt">${chrome.i18n.getMessage("protectedText")}</p>\t\t\n\t\t\t\t</div>`,t.append(i.firstElementChild)},Lt(){let t=document.querySelector(".root"),i=document.createElement("div");i.innerHTML=`<div class="no-video">\n\t\t\t\t\t<span class="logo"></span>\n\t\t\t\t\t<p class="txt">${chrome.i18n.getMessage("noVideos")}</p>\t\t\n\t\t\t\t</div>`,t.append(i.firstElementChild)}},It:{_t(){const t=document.querySelector(".root");if(!t)return;if(document.querySelector(".skeleton-root"))return;const i=document.createElement("div");i.innerHTML=`\n\t\t\t\t  <div class="skeleton-root">\n\t\t\t\t\t<div class="sk-card">\n\t\t\t\t\t  <div class="sk-video">\n\t\t\t\t\t\t<span class="sk-icon"></span>\n\t\t\t\t\t\t<span class="sk-text">${chrome.i18n.getMessage("loading")}</span>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\x3c!--\t\t\t\t\t<div class="sk-line sk-line-lg"></div>--\x3e\n\t\t\t\t\t<div class="sk-line sk-line-md"></div>\n\t\t\t\t\t<div class="sk-line sk-line-sm"></div>\n\t\t\t\t  </div>\n\t\t\t\t`,t.appendChild(i.firstElementChild)},Rt(){const t=document.querySelector(".skeleton-root");t&&t.remove()}}}}()},243:(t,i,n)=>{const r=n(68),e=n(119);t.exports=function(){return{dt(t,i){const n=this,{tabId:r,title:s}=t;let h={title:e.G,url:n.fileUrl,filename:(n.title||s||"video")+".mp4"};n.fileAUrl&&n.fileAUrl.length&&(h={title:e.D,data:{headers:n.headers,video_url:n.fileUrl,audio_url:n.fileAUrl,src:n.fileUrl,filename:(n.title||s||"video")+".mp4"},tabId:r}),chrome.runtime.sendMessage(h)},vt(t,i,n){n.yt();const{tabId:s}=i;r.Y({title:"check_m3u_playlist",url:t.fileUrl}).then((h=>{let a=h&&h.parsedInfo&&h.parsedInfo.length&&h.parsedInfo[0].m3u||null;if(!a)return"error";if(!a.videoLinks||!a.videoLinks.length)return"error";const o={video_list:a.videoLinks,audio_list:a.audioLinks,src:t.fileUrl,filename:(t.title||i.title||"video")+".mp4"};r.Y({title:e.D,tabId:s,data:o}).then((t=>{n.kt()}))}))},Tt(t){r.Y({title:e.R})},At(t){chrome.storage.sync.set({affiliate_redirect_allowed_by_user:!0}),location.reload()},Mt(t){window.open(e.M)}}}()}},i={};function n(r){var e=i[r];if(void 0!==e)return e.exports;var s=i[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}const r=n(119),e=n(68),s=n(406);function h(t,i,n){t&&t.target===r.N&&(t.title===r.O?s.lt.ct.Et(t.progress):t.title===r._&&s.lt.ct.kt())}function a(){return chrome.runtime.onMessage.addListener(h),chrome.storage.sync.get(null).then((t=>{let i;if(!t||!t.affiliate_redirect_allowed_by_user)return s.lt.St();e.Y({title:"isDownload"}).then((t=>{e.it().then((i=>i?t&&t.isDownload&&t.tabIdDw!==i?s.lt.jt():void chrome.storage.local.get(null,(n=>{s.It._t();let r=n&&n[i]||{};r={...r,tabId:i},e.Y({title:"get_all_video_cache",tabInfo:r}).then((async n=>{s.It.Rt();let e=[];if(e=n&&n.videoEntries||null,!e||!e.length)return chrome.tabs.sendMessage(i,{action:"isVideoOnPage"}).then((t=>t&&t.isVideoOnPage?s.lt.Dt():s.lt.Lt())).catch(s.lt.Lt);e.reverse().forEach((t=>{s.nt(t,r)})),t&&t.isDownload&&s.lt.ct.yt()}))})):(s.It.Rt(),void s.lt.Dt())))}))})),!0}a()})();